
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>jjmodel.funcs &#8212; jjmodel 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for jjmodel.funcs</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Feb  4 12:14:54 2016</span>
<span class="sd">@author: Skevja</span>

<span class="sd">This file contains definitions of the JJ model input functions: </span>
<span class="sd">    - Age-metllicity relation (AMR)</span>
<span class="sd">    - Age-velocity dispersion relation (AVR)</span>
<span class="sd">    - Star formation rate (SFR)</span>
<span class="sd">    - Initial mass function (IMF)</span>
<span class="sd">    - Radial density profiles of the different Galactic components. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">sgn</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erf</span><span class="p">,</span> <span class="n">kv</span><span class="p">,</span> <span class="n">iv</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">dblquad</span><span class="p">,</span> <span class="n">quad</span>
<span class="kn">from</span> <span class="nn">.iof</span> <span class="kn">import</span> <span class="n">tab_reader</span><span class="p">,</span> <span class="n">dir_tree</span>
<span class="kn">from</span> <span class="nn">.tools</span> <span class="kn">import</span> <span class="n">_transition_2curves_</span><span class="p">,</span> <span class="n">ConvertAxes</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">tp</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">GA</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">GYR</span><span class="p">,</span> <span class="n">PC</span><span class="p">,</span> <span class="n">SIGMA_E</span><span class="p">,</span> <span class="n">KM</span><span class="p">,</span> <span class="n">M_SUN</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">localpath</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># Functions</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="hgr"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.hgr">[docs]</a><span class="k">def</span> <span class="nf">hgr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scale heights of the atomic and molecular gas components as </span>
<span class="sd">    functions of Galactocentric distance. Data are taken from Nakanishi and Sofue (2016). </span>
<span class="sd">    </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">        </span>
<span class="sd">    :return: *((hg1,hg10),(hg2,hg20))*, indices 1 and 2 correspond to molecular and atomic gas, </span>
<span class="sd">        respectively. Gas scale heights (pc) at Galactocentric distances ``a.R`` and at the Solar </span>
<span class="sd">        radius ``p.Rsun``. </span>
<span class="sd">    :rtype: ((1d-array,float),(1d-array,float))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">T</span> <span class="o">=</span> <span class="n">dir_tree</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">H2</span><span class="p">,</span><span class="n">HI</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;H2&#39;</span><span class="p">,</span><span class="s1">&#39;HI&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
    
    <span class="n">exp_law</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
    <span class="n">popt1</span><span class="p">,</span><span class="n">pcov1</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">exp_law</span><span class="p">,</span><span class="n">H2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">H2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">popt2</span><span class="p">,</span><span class="n">pcov2</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">exp_law</span><span class="p">,</span><span class="n">HI</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">HI</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">hg10</span><span class="p">,</span> <span class="n">hg20</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">exp_law</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="o">*</span><span class="n">popt1</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">exp_law</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="o">*</span><span class="n">popt2</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">run_mode</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">hg1</span><span class="p">,</span> <span class="n">hg2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">exp_law</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="o">*</span><span class="n">popt1</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">exp_law</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="o">*</span><span class="n">popt2</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">hg1</span><span class="p">,</span><span class="n">hg10</span><span class="p">),(</span><span class="n">hg2</span><span class="p">,</span><span class="n">hg20</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">hg10</span><span class="p">,</span> <span class="n">hg20</span><span class="p">)</span></div>


<div class="viewcode-block" id="heffr"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.heffr">[docs]</a><span class="k">def</span> <span class="nf">heffr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">heffd0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thin-disk half-thickness as a function of Galactocentric distance. </span>

<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param heffd0: Thin-disk half-thickness at the Solar radius ``p.Rsun``.</span>
<span class="sd">    :type heffd0: scalar</span>
<span class="sd">    </span>
<span class="sd">    :return: Thin-disk half-thickness calculated at Galactocentric distances ``a.R``, pc. </span>
<span class="sd">    :rtype: 1d-array        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">Rf</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">Rmax</span><span class="p">:</span>
        <span class="n">indR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rf</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rf</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">Rf</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">hdeff_rf</span> <span class="o">=</span> <span class="n">heffd0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">Rf</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rdf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hdeff_rf</span> <span class="o">=</span> <span class="n">heffd0</span>
        <span class="n">hdeff_r1</span> <span class="o">=</span> <span class="p">[</span><span class="n">hdeff_rf</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[:</span><span class="n">indR</span><span class="p">]]</span>
        <span class="n">hdeff_r2</span> <span class="o">=</span> <span class="p">[</span><span class="n">hdeff_rf</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rf</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rdf</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">indR</span><span class="p">:]]</span> 
        <span class="n">hdeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">hdeff_r1</span><span class="p">,</span><span class="n">hdeff_r2</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">epsilon_R</span> <span class="o">=</span> <span class="mf">0.5</span>     <span class="c1"># kpc</span>
        <span class="n">hdeff</span> <span class="o">=</span> <span class="n">_transition_2curves_</span><span class="p">(</span><span class="n">epsilon_R</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rf</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="n">hdeff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hdeff</span> <span class="o">=</span> <span class="p">[</span><span class="n">heffd0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hdeff</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_surface_gravity"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.log_surface_gravity">[docs]</a><span class="k">def</span> <span class="nf">log_surface_gravity</span><span class="p">(</span><span class="n">Mf</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">Teff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for calculation of surface gravity. </span>
<span class="sd">    </span>
<span class="sd">    :param Mf: Stellar mass (present-day mass in isochrones), :math:`\mathrm{M}_\odot`.</span>
<span class="sd">    :type Mf: scalar or array-like</span>
<span class="sd">    :param L: Stellar luminosity, :math:`\mathrm{L}_\odot`.</span>
<span class="sd">    :type L: scalar or array-like</span>
<span class="sd">    :param Teff: Effective temperature, K.</span>
<span class="sd">    :type Teff: scalar or array-like</span>
<span class="sd">    </span>
<span class="sd">    :return: Log surface gravity, :math:`\mathrm{log(cm \ s^{-2})}`.</span>
<span class="sd">    :rtype: scalar or array-like</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">G</span> <span class="o">=</span> <span class="mf">6.67</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">)</span>      <span class="c1"># Gravitational constant, m3*kg-1*s-2</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mf">5.67</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span>   <span class="c1"># Stefan-Boltzmann constant, W*m−2*K−4</span>
    <span class="n">L_sun</span> <span class="o">=</span> <span class="mf">3.828</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">26</span>    <span class="c1"># Solar luminosity, W</span>
    <span class="n">M_sun</span> <span class="o">=</span> <span class="mf">1.988</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">30</span>    <span class="c1"># Solar mass, kg</span>
    <span class="n">Teff_sun</span> <span class="o">=</span> <span class="mi">5778</span>         <span class="c1"># Solar temperature, K</span>

    <span class="n">L_W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">L_sun</span><span class="p">)</span>
    <span class="n">M_kg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Mf</span><span class="p">,</span><span class="n">M_sun</span><span class="p">)</span>
    
    <span class="c1"># g_sun = 4*np.pi*sigma*Teff_sun**4*G*M_sun/L_sun</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span><span class="n">Teff</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">M_kg</span><span class="o">/</span><span class="n">L_W</span>  <span class="c1"># Surface gravity, m*s-2</span>
    <span class="n">g_sgs</span> <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="mf">1e2</span>                         <span class="c1"># In cm*s-2</span>
        
    <span class="n">logg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">g_sgs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logg</span></div>
    

<span class="c1"># =============================================================================</span>
<span class="c1"># Classes</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="RadialPotential"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialPotential">[docs]</a><span class="k">class</span> <span class="nc">RadialPotential</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Galactic potential in the midplane. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="RadialPotential.__init__"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialPotential.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rsun</span><span class="p">,</span><span class="n">R</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class instance is initialized by two parameters.</span>
<span class="sd">        </span>
<span class="sd">        :param Rsun: Solar Galactocentric distance, kpc.</span>
<span class="sd">        :type Rsun: float</span>
<span class="sd">        :param R: Galactocentric distance(s) where potential has to be calculated, kpc.  </span>
<span class="sd">        :type R: float or array-like          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">Rsun</span></div>
        
        
<div class="viewcode-block" id="RadialPotential.exp_disk"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialPotential.exp_disk">[docs]</a>    <span class="k">def</span> <span class="nf">exp_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma0</span><span class="p">,</span><span class="n">Rd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Potential of a razor-thin exponential disk (via Bessel functions). </span>
<span class="sd">        </span>
<span class="sd">        :param sigma0: Local surface density, :math:`\mathrm{M_\odot \ pc^{-2}}`.    </span>
<span class="sd">        :type sigma0: scalar</span>
<span class="sd">        :param Rd: Radial scale length of the disk, kpc. </span>
<span class="sd">        :type Rd: scalar</span>
<span class="sd">               </span>
<span class="sd">        :return: Potential of the disk at the given Galactocentric distance(s) **R**, </span>
<span class="sd">            :math:`\mathrm{m^2 \ s^{-2}}`.             </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Rd</span>
        <span class="n">Fi</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">sigma0</span><span class="o">*</span><span class="n">M_SUN</span><span class="o">/</span><span class="n">PC</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="mf">1e3</span><span class="o">*</span><span class="n">PC</span><span class="o">*</span>\
            <span class="p">(</span><span class="n">iv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">kv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">iv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">kv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">))</span> 
        <span class="k">return</span> <span class="n">Fi</span></div>
    
    
<div class="viewcode-block" id="RadialPotential.pow_law"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialPotential.pow_law">[docs]</a>    <span class="k">def</span> <span class="nf">pow_law</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rho0</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Potential of a MW component with a power-law radial density profile, </span>
<span class="sd">        :math:`{\\rho}(R) \propto (R_\odot/R)^{\\alpha}`. </span>
<span class="sd">        </span>
<span class="sd">        :param rho0: Local mass density, :math:`\mathrm{M_\odot \ pc^{-3}}`. </span>
<span class="sd">        :type rho0: scalar</span>
<span class="sd">        :param alpha: Power-law slope.</span>
<span class="sd">        :type alpha: scalar</span>
<span class="sd">               </span>
<span class="sd">        :return: Potential at the given Galactocentric distance(s) **R**, :math:`\mathrm{m^2 \ s^{-2}}`.             </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">Fi</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">rho0</span><span class="o">*</span><span class="n">M_SUN</span><span class="o">/</span><span class="n">PC</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span>\
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="mf">1e3</span><span class="o">*</span><span class="n">PC</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> 
        <span class="k">return</span> <span class="n">Fi</span></div>
        
    
<div class="viewcode-block" id="RadialPotential.cored_iso_sphere"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialPotential.cored_iso_sphere">[docs]</a>    <span class="k">def</span> <span class="nf">cored_iso_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rho0</span><span class="p">,</span><span class="n">ah</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Potential of a cored isothermal sphere. </span>

<span class="sd">        :param rho0: Local mass density, :math:`\mathrm{M_\odot \ pc^{-3}}`. </span>
<span class="sd">        :type rho0: scalar</span>
<span class="sd">        :param ah: Scaling parameter, kpc. </span>
<span class="sd">        :type ah: scalar</span>
<span class="sd">        </span>
<span class="sd">        :return: Potential the given Galactocentric distance(s) **R**, :math:`\mathrm{m^2 \ s^{-2}}`. </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">Fi</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">rho0</span><span class="o">*</span><span class="n">C</span><span class="o">*</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">ah</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="n">ah</span><span class="p">)</span> <span class="o">+</span>\
                                     <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="n">ah</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">M_SUN</span><span class="o">/</span><span class="n">PC</span>
        <span class="k">return</span> <span class="n">Fi</span></div></div>



<div class="viewcode-block" id="RadialDensity"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialDensity">[docs]</a><span class="k">class</span> <span class="nc">RadialDensity</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Radial density profiles of the different Galactic components.     </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="RadialDensity.__init__"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialDensity.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rsun</span><span class="p">,</span><span class="n">zsun</span><span class="p">,</span><span class="n">R</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class instance is initialized by three parameters.</span>
<span class="sd">        </span>
<span class="sd">        :param Rsun: Solar Galactocentric distance, kpc.</span>
<span class="sd">        :type Rsun: float</span>
<span class="sd">        :param zsun: Height of the Sun above the Galactic plane, pc.</span>
<span class="sd">        :type zsun: float</span>
<span class="sd">        :param R: Galactocentric distance(s) where density has to be calculated, kpc.  </span>
<span class="sd">        :type R: float or array-like       </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">=</span> <span class="n">Rsun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zsun</span> <span class="o">=</span> <span class="n">zsun</span><span class="o">*</span><span class="mf">1e-3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rsun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Rsun</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zsun</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span></div>
        
        
<div class="viewcode-block" id="RadialDensity.rho_disk"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialDensity.rho_disk">[docs]</a>    <span class="k">def</span> <span class="nf">rho_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rho0</span><span class="p">,</span><span class="n">Rd</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Midplane mass density of an exponential disk.</span>
<span class="sd">    </span>
<span class="sd">        :param rho0: Local mass density, :math:`\mathrm{M_\odot \ pc^{-3}}`. </span>
<span class="sd">        :type rho0: scalar</span>
<span class="sd">        :param Rd: Radial scale length of the disk, kpc. </span>
<span class="sd">        :type Rd: scalar</span>
<span class="sd">        :param R0: Opional. Radius of the inner hole, kpc. </span>
<span class="sd">        :type R0: scalar</span>
<span class="sd">        </span>
<span class="sd">        :return: Mass density of the disk calculated at the given Galactocentric distance(s) **R**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-3}}`.             </span>
<span class="sd">        :rtype: float or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">rho0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="p">))</span><span class="o">/</span><span class="n">Rd</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;R0&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R0&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">indr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R0&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rho</span><span class="p">[</span><span class="n">indr0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="k">return</span> <span class="n">rho</span></div>
    
    
<div class="viewcode-block" id="RadialDensity.sigma_disk"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialDensity.sigma_disk">[docs]</a>    <span class="k">def</span> <span class="nf">sigma_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma0</span><span class="p">,</span><span class="n">Rd</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Surface density of an exponential disk.</span>
<span class="sd">    </span>
<span class="sd">        :param sigma0: Local surface density, :math:`\mathrm{M_\odot \ pc^{-2}}`. </span>
<span class="sd">        :type sigma0: scalar</span>
<span class="sd">        :param Rd: Radial scale length of the disk, kpc. </span>
<span class="sd">        :type Rd: scalar</span>
<span class="sd">        :param R0: Opional. Radius of the inner hole, kpc. </span>
<span class="sd">        :type R0: scalar</span>
<span class="sd">        </span>
<span class="sd">        :return: Surface density of the disk calculated at the given Galactocentric distance(s) **R**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2}}`. </span>
<span class="sd">        :rtype: float or array-like </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="p">))</span><span class="o">/</span><span class="n">Rd</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;R0&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R0&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">indr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R0&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sigma</span><span class="p">[</span><span class="n">indr0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="k">return</span> <span class="n">sigma</span></div>
        
    
<div class="viewcode-block" id="RadialDensity.rho_dm_halo"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialDensity.rho_dm_halo">[docs]</a>    <span class="k">def</span> <span class="nf">rho_dm_halo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">rho0</span><span class="p">,</span><span class="n">ah</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        3d mass density of an isothermal dark matter (DM) sphere.</span>
<span class="sd">    </span>
<span class="sd">        :param z: Height above the Galactic plane, kpc.</span>
<span class="sd">        :type z: scalar</span>
<span class="sd">        :param rho0: Local mass density of the DM halo, :math:`\mathrm{M_\odot \ pc^{-3}}`.</span>
<span class="sd">        :type rho0: scalar</span>
<span class="sd">        :param ah: DM scaling parameter, kpc. </span>
<span class="sd">        :type ah: scalar</span>
<span class="sd">        </span>
<span class="sd">        :return: DM halo mass density at the given **z** and **R**, :math:`\mathrm{M_\odot \ pc^{-3}}`.</span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        #rho = rho0*(np.divide(self.Rsun,self.R))**2</span>
<span class="sd">        C = (ah**2 + self.Rsun**2)/ah**2</span>
<span class="sd">        rho = rho0*C*ah**2/(ah**2 + self.R**2)   </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">rhoc</span> <span class="o">=</span> <span class="n">rho0</span><span class="o">*</span><span class="p">(</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">rhoc</span><span class="o">*</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>   
    
        <span class="k">return</span> <span class="n">rho</span></div>
    
    
<div class="viewcode-block" id="RadialDensity.sigma_dm_halo"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialDensity.sigma_dm_halo">[docs]</a>    <span class="k">def</span> <span class="nf">sigma_dm_halo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">zmax</span><span class="p">,</span><span class="n">sigma0</span><span class="p">,</span><span class="n">ah</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Surface density of an isothermal dark matter (DM) sphere.</span>
<span class="sd">        </span>
<span class="sd">        :param zmax: Maximal height above the Galactic plane, kpc. Up to this height DM mass </span>
<span class="sd">            density law will be integrated.</span>
<span class="sd">        :type zmax: scalar</span>
<span class="sd">        :param sigma0: Local surface density, :math:`\mathrm{M_\odot \ pc^{-2}}`. </span>
<span class="sd">        :type sigma0: scalar </span>
<span class="sd">        :param ah: DM scaling parameter, kpc. </span>
<span class="sd">        :type ah: scalar </span>
<span class="sd">      </span>
<span class="sd">        :return: DM halo surface density at Galactocentric distance(s) **R** </span>
<span class="sd">                 (up to the height **zmax**), :math:`\mathrm{M_\odot \ pc^{-2}}`.   </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tan_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">zmax</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">zmax</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tan_term</span>    
        <span class="k">return</span> <span class="n">sigma</span></div>

    
<div class="viewcode-block" id="RadialDensity.rho_stellar_halo"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialDensity.rho_stellar_halo">[docs]</a>    <span class="k">def</span> <span class="nf">rho_stellar_halo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">rho0</span><span class="p">,</span><span class="n">a_sh</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        3d mass density of a spherical stellar halo.</span>
<span class="sd">        Flattening is ignored, profile is a power law, :math:`{\\rho}(R) \propto (R_\odot/R)^{-\\alpha}`. </span>
<span class="sd">        </span>
<span class="sd">        :param z: Height above the Galactic plane, kpc. </span>
<span class="sd">        :type z: scalar</span>
<span class="sd">        :param rho0: Local mass density of the halo, :math:`\mathrm{M_\odot \ pc^{-3}}`. </span>
<span class="sd">        :type rho0: scalar</span>
<span class="sd">        :param a_sh: Slope of the halo profile (about -2.5, see Bland-Hawthorn 2016). </span>
<span class="sd">        :type a_sh: scalar</span>
<span class="sd">                     </span>
<span class="sd">        :return: Halo mass density at the given **z** and **R**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-3}}`.    </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="c1">#rho = rho0*(np.divide(self.Rsun,self.R))**(-a_sh)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">rho0</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rsun</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a_sh</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rho</span></div>
    
    
<div class="viewcode-block" id="RadialDensity.sigma_stellar_halo"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RadialDensity.sigma_stellar_halo">[docs]</a>    <span class="k">def</span> <span class="nf">sigma_stellar_halo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">zmax</span><span class="p">,</span><span class="n">sigma0</span><span class="p">,</span><span class="n">a_sh</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Surface density of a spherical stellar halo.</span>
<span class="sd">        Flattening is ignored, profile is a power law (see :meth:`jjmodel.RadialDensity.rho_stellar_halo`). </span>
<span class="sd">        </span>
<span class="sd">        :param zmax: Maximal height above the Galactic plane, kpc. </span>
<span class="sd">            Up to this height halo mass density law will be integrated.</span>
<span class="sd">        :type zmax: scalar</span>
<span class="sd">        :param sigma0: Local surface density, :math:`\mathrm{M_\odot \ pc^{-2}}`.   </span>
<span class="sd">        :type sigma0: scalar</span>
<span class="sd">        :param a_sh: Slope of the halo profile (about -2.5, see Bland-Hawthorn 2016). </span>
<span class="sd">        :type a_sh: scalar</span>
<span class="sd">             </span>
<span class="sd">        :return:  Halo surface density at the given Galactocentric distance(s) **R** </span>
<span class="sd">            (up to the height **zmax**), :math:`\mathrm{M_\odot \ pc^{-2}}`.       </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">rho0</span> <span class="o">=</span> <span class="n">sigma0</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a_sh</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">zmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">Rbins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Rbins</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">rho0</span><span class="o">*</span>\
                              <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a_sh</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">zmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sigma</span></div></div>

    

<div class="viewcode-block" id="RotCurve"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RotCurve">[docs]</a><span class="k">class</span> <span class="nc">RotCurve</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circular velocity as a function of Galactocentric distance </span>
<span class="sd">    as follows from the assumed density laws for the MW components.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="RotCurve.__init__"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RotCurve.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rsun</span><span class="p">,</span><span class="n">R</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class instance is initialized by two parameters. </span>
<span class="sd">        </span>
<span class="sd">        :param Rsun: Solar Galactocentric distance, kpc.</span>
<span class="sd">        :type Rsun: float</span>
<span class="sd">        :param R: Galactocentric distance(s) where circular velocity has to be calculated, kpc.  </span>
<span class="sd">        :type R: float or array-like       </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">=</span> <span class="n">Rsun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_r</span> <span class="o">=</span> <span class="n">M_SUN</span><span class="o">/</span><span class="n">PC</span><span class="o">/</span><span class="mf">1e3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho_r2</span> <span class="o">=</span> <span class="n">M_SUN</span><span class="o">/</span><span class="n">PC</span><span class="o">*</span><span class="mf">1e6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_r</span> <span class="o">=</span> <span class="n">M_SUN</span><span class="o">/</span><span class="n">PC</span><span class="o">*</span><span class="mf">1e3</span></div>
        
<div class="viewcode-block" id="RotCurve.vc_bulge"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RotCurve.vc_bulge">[docs]</a>    <span class="k">def</span> <span class="nf">vc_bulge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Mb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotation curve of a point-mass bulge. </span>
<span class="sd">        </span>
<span class="sd">        :param Mb: Mass of the bulge, :math:`\mathrm{M_\odot}`. </span>
<span class="sd">        :type Mb: scalar</span>

<span class="sd">        :return: Circular velocity corresponding to **R**, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">        :rtype: scalar or array-like        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">vc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">Mb</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_r</span><span class="p">)</span><span class="o">/</span><span class="mf">1e3</span>
        <span class="k">return</span> <span class="n">vc</span></div>

<div class="viewcode-block" id="RotCurve.vc_disk"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RotCurve.vc_disk">[docs]</a>    <span class="k">def</span> <span class="nf">vc_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sigma0</span><span class="p">,</span><span class="n">Rd</span><span class="p">,</span><span class="n">R0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotation curve of an infinitely thin exponential disk </span>
<span class="sd">        (Eq. 2-169 in Binney and Tremaine).</span>
<span class="sd">        </span>
<span class="sd">        :param sigma0: Local surface density, :math:`\mathrm{M_\odot \ pc^{-2}}`.   </span>
<span class="sd">        :type sigma0: scalar</span>
<span class="sd">        :param Rd: Radial scale length of the disk, kpc.</span>
<span class="sd">        :type Rd: scalar</span>
<span class="sd">        :param R0: Radius of the inner hole in the disk density profile, kpc. </span>
<span class="sd">        :type R0: scalar  </span>
<span class="sd">        </span>
<span class="sd">        :return: Circular velocity corresponding to **R**, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">        :rtype: scalar or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">-</span> <span class="n">R0</span><span class="p">)</span><span class="o">/</span><span class="n">Rd</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">-</span> <span class="n">R0</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Rd</span><span class="o">*</span>\
                     <span class="p">(</span><span class="n">iv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Rd</span><span class="p">)</span><span class="o">*</span><span class="n">kv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Rd</span><span class="p">)</span><span class="o">-</span><span class="n">iv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Rd</span><span class="p">)</span><span class="o">*</span><span class="n">kv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">R</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Rd</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_r</span><span class="p">)</span><span class="o">/</span><span class="mf">1e3</span>
        <span class="n">vc</span><span class="p">[</span><span class="n">vc</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">return</span> <span class="n">vc</span></div>

<div class="viewcode-block" id="RotCurve.vc_halo_nfw"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RotCurve.vc_halo_nfw">[docs]</a>    <span class="k">def</span> <span class="nf">vc_halo_nfw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rho0</span><span class="p">,</span><span class="n">ah</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotation curve of dark matter (DM) halo with NWF profile.</span>
<span class="sd">        </span>
<span class="sd">        :param rho0: Local DM mass density, :math:`\mathrm{M_\odot \ pc^{-3}}`. </span>
<span class="sd">        :type rho0: scalar</span>
<span class="sd">        :param ah: Scaling parameter, kpc.</span>
<span class="sd">        :type ah: scalar</span>
<span class="sd">        </span>
<span class="sd">        :return: Circular velocity corresponding to **R**, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">        :rtype: scalar or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">/</span><span class="n">ah</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">/</span><span class="n">ah</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1">#vc = np.sqrt(4*np.pi*G*rho0*C*ah**3/self.R*\</span>
        <span class="c1">#             (np.log(1+self.R/ah)-self.R/ah/(1+self.R/ah))*self.rho_r2)/1e3</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">rho0</span><span class="o">*</span><span class="n">C</span><span class="o">*</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span>\
                     <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="n">ah</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">ah</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="n">ah</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_r2</span><span class="p">)</span><span class="o">/</span><span class="mf">1e3</span>
        <span class="k">return</span> <span class="n">vc</span></div>

<div class="viewcode-block" id="RotCurve.vc_halo_cored_iso_sphere"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RotCurve.vc_halo_cored_iso_sphere">[docs]</a>    <span class="k">def</span> <span class="nf">vc_halo_cored_iso_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rho0</span><span class="p">,</span><span class="n">ah</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotation curve of dark matter (DM) halo, which is a cored isothermal sphere.</span>
<span class="sd">        </span>
<span class="sd">        :param rho0: Local DM mass density, :math:`\mathrm{M_\odot \ pc^{-3}}`. </span>
<span class="sd">        :type rho0: scalar</span>
<span class="sd">        :param ah: Scaling parameter, kpc.</span>
<span class="sd">        :type ah: scalar </span>
<span class="sd">            </span>
<span class="sd">        :return: Circular velocity corresponding to **R**, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">        :rtype: scalar or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">rho0</span><span class="o">*</span><span class="n">C</span><span class="o">*</span><span class="n">ah</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ah</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="n">ah</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_r2</span><span class="p">)</span><span class="o">/</span><span class="mf">1e3</span>
        
        <span class="k">return</span> <span class="n">vc</span></div>
    
    <span class="k">def</span> <span class="nf">_vc_halo_power_law_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rho0</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotation velocity for stellar halo with a power-law profile.</span>
<span class="sd">        Not physical, gives too large enclosed halo mass. Must be </span>
<span class="sd">        truncated at some R near GC, or core has to be added. </span>
<span class="sd">        </span>
<span class="sd">        :param rho0: Halo density at Rsun, :math:`\mathrm{M_\odot \ pc^{-3}}`. </span>
<span class="sd">        :type rho0: scalar</span>
<span class="sd">        :param alpha: Power-law slope (rho ~ 1/R^alpha, make sure that you give alpha &gt; 0).</span>
<span class="sd">        :type alpha: scalar</span>
<span class="sd">            </span>
<span class="sd">        :return: Circular velocity corresponding to **R**, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">        :rtype: scalar or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">vc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">rho0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">**</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_r2</span><span class="p">)</span><span class="o">/</span><span class="mf">1e3</span>
        <span class="k">return</span> <span class="n">vc</span>
            
    
<div class="viewcode-block" id="RotCurve.vc_tot"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RotCurve.vc_tot">[docs]</a>    <span class="k">def</span> <span class="nf">vc_tot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vc_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Total rotation curve as quadratic sum of all velocity components.         </span>
<span class="sd">        </span>
<span class="sd">        :param vc_array: :math:`{\\upsilon}_\mathrm{c}` components at distance(s) **R**. </span>
<span class="sd">            Output units are the same as for the input velocities. </span>
<span class="sd">        :type vc_array: array-like (list or list[list])</span>
<span class="sd">            </span>
<span class="sd">        :return: Circular velocity corresponding to **R**, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">        :rtype: scalar or array-like </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">vc_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vc_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vc_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">vc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vc_array</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">vc_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">vc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vc_array</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">vc</span></div>
    
    
<div class="viewcode-block" id="RotCurve.vc0"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.RotCurve.vc0">[docs]</a>    <span class="k">def</span> <span class="nf">vc0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vc_tot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates total circular velocity :math:`{\\upsilon}_\mathrm{c}` at the Solar radius, ``p.Rsun``.  </span>
<span class="sd">        </span>
<span class="sd">        :param vc_tot: Total circular velocity at the given Galactocentric distance(s) **R**. </span>
<span class="sd">            Note that this method is only useful when **R** is an array and covers Solar neighbourhood </span>
<span class="sd">            with a decent resolution. </span>
<span class="sd">        :type vc_tot: array-like</span>
<span class="sd">            </span>
<span class="sd">        :return: Local circular velocity corresponding to **R**, :math:`\mathrm{km \ s^{-1}}`.</span>
<span class="sd">        :rtype: scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ind_r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vc0</span> <span class="o">=</span> <span class="n">vc_tot</span><span class="p">[</span><span class="n">ind_r0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vc0</span></div></div>



<div class="viewcode-block" id="AMR"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR">[docs]</a><span class="k">class</span> <span class="nc">AMR</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of methods which are used to define age-metallicity relation (AMR) </span>
<span class="sd">    and work with metallicities in the model and data.  </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
<div class="viewcode-block" id="AMR.amrd_jj10"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrd_jj10">[docs]</a>    <span class="k">def</span> <span class="nf">amrd_jj10</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AMR from Just and Jahreiss (2010), Eq.(31).</span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param tp: Present-day age of the MW disk (present-day Galactic time), Gyr.</span>
<span class="sd">        :type tp: scalar</span>
<span class="sd">        :param q: AMR parameter.</span>
<span class="sd">        :type q: scalar</span>
<span class="sd">        :param r: AMR power index.</span>
<span class="sd">        :type r: scalar</span>
<span class="sd">        :param FeH_0: Initial metallicity of the thin disk in the Solar neighbourhood. </span>
<span class="sd">        :type FeH_0: scalar</span>
<span class="sd">        :param FeH_p: Present-day metallicity of the thin disk in the Solar neighbourhood. </span>
<span class="sd">        :type FeH_p: scalar</span>

<span class="sd">        :return: Metallicities of the local thin-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like             </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">a</span> <span class="o">=</span> <span class="mf">2.67</span>
        <span class="n">OH_0</span><span class="p">,</span> <span class="n">OH_p</span> <span class="o">=</span> <span class="n">FeH_0</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="n">FeH_p</span><span class="o">/</span><span class="n">a</span>
        <span class="n">ZO_0</span><span class="p">,</span> <span class="n">ZO_p</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">OH_0</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="n">OH_p</span>
        <span class="n">ZO</span> <span class="o">=</span> <span class="n">ZO_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">ZO_p</span><span class="o">-</span><span class="n">ZO_0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tp</span><span class="p">)</span><span class="o">**</span><span class="n">r</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="p">)</span>
        <span class="n">FeH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ZO</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
        
        <span class="k">return</span> <span class="n">FeH</span></div>
    

<div class="viewcode-block" id="AMR.amrd_jj10_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrd_jj10_default">[docs]</a>    <span class="k">def</span> <span class="nf">amrd_jj10_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AMR from Just and Jahreiss (2010), Eq.(31), calculated with </span>
<span class="sd">        the best parameters (model A). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param stretch: Optional. If True, an extended (relative to model A) </span>
<span class="sd">                time scale is used - a present-day MW disk age is set to **tp** = 13 Gyr. </span>
<span class="sd">                By default is False, **tp** = 12 Gyr, as in Just and Jahreiss (2010).</span>
<span class="sd">        :type stretch: boolean</span>
<span class="sd">                                </span>
<span class="sd">        :return: Metallicities of the local thin-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.55</span>
        <span class="n">FeH_0</span><span class="p">,</span> <span class="n">FeH_p</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.02</span>
        
        <span class="k">if</span> <span class="s1">&#39;stretch&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;stretch&#39;</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">tp_</span> <span class="o">=</span> <span class="n">tp</span> 
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">tp_</span> <span class="o">=</span> <span class="mi">12</span> 

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrd_jj10</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tp_</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="AMR.amrd_sj21"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrd_sj21">[docs]</a>    <span class="k">def</span> <span class="nf">amrd_sj21</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AMR from Sysoliatina and Just (2021), Eq. (21) and (22).</span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param tp: Present-day age of the MW disk (present-day Galactic time), Gyr.</span>
<span class="sd">        :type tp: scalar</span>
<span class="sd">        :param q: AMR parameter (impacts the function shape).</span>
<span class="sd">        :type q: scalar</span>
<span class="sd">        :param r: AMR power index.</span>
<span class="sd">        :type r: scalar</span>
<span class="sd">        :param FeH_0: Initial metallicity of the thin disk in the Solar neighbourhood. </span>
<span class="sd">        :type FeH_0: scalar</span>
<span class="sd">        :param FeH_p: Present-day metallicity of the thin disk in the Solar neighbourhood. </span>
<span class="sd">        :type FeH_p: scalar</span>
<span class="sd">            </span>
<span class="sd">        :return: Metallicities of the local thin-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">FeH</span> <span class="o">=</span> <span class="n">FeH_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">FeH_p</span> <span class="o">-</span> <span class="n">FeH_0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tp</span><span class="p">)</span><span class="o">**</span><span class="n">r</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FeH</span></div>
    
    
<div class="viewcode-block" id="AMR.amrd_sj21_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrd_sj21_default">[docs]</a>    <span class="k">def</span> <span class="nf">amrd_sj21_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AMR from Sysoliatina and Just (2021), Eq. (21) and (22), </span>
<span class="sd">        calculated with the best parameters (Table 3).</span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">           </span>
<span class="sd">        :return: Metallicities of the local thin-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">tp_</span> <span class="o">=</span> <span class="n">tp</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.72</span><span class="p">,</span> <span class="mf">0.34</span>
        <span class="n">FeH_0</span><span class="p">,</span> <span class="n">FeH_p</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.29</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrd_sj21</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tp_</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="AMR.amrd_global_sj22"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrd_global_sj22">[docs]</a>    <span class="k">def</span> <span class="nf">amrd_global_sj22</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t01</span><span class="p">,</span><span class="n">t02</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">alpha_w</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AMR from Sysoliatina and Just (2022), Eq. (22) and (23). </span>
<span class="sd">        All parameters must correspond to the same Galactocentric distance (but not necessarily to </span>
<span class="sd">        the Solar radius ``p.Rsun``). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param t01: Time-scale parameter of the first *tanh* term, Gyr.</span>
<span class="sd">        :type t01: scalar</span>
<span class="sd">        :param t02: Time-scale parameter of the second *tanh* term, Gyr.</span>
<span class="sd">        :type t02: scalar</span>
<span class="sd">        :param r1: Power index of the first *tanh* term. </span>
<span class="sd">        :type r1: scalar</span>
<span class="sd">        :param r2: Power index of the second *tanh* term. </span>
<span class="sd">        :type r2: scalar</span>
<span class="sd">        :param FeH_0: Initial metallicity of the thin disk. </span>
<span class="sd">        :type FeH_0: scalar</span>
<span class="sd">        :param FeH_p: Present-day metallicity of the thin disk. </span>
<span class="sd">        :type FeH_p: scalar</span>
<span class="sd">           </span>
<span class="sd">        :return: Metallicities of the thin-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">f_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha_w</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t01</span><span class="p">))</span><span class="o">**</span><span class="n">r1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">t01</span><span class="p">))</span><span class="o">**</span><span class="n">r1</span> <span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_w</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t02</span><span class="p">))</span><span class="o">**</span><span class="n">r2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">t02</span><span class="p">))</span><span class="o">**</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">FeH</span> <span class="o">=</span> <span class="n">FeH_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">FeH_p</span> <span class="o">-</span> <span class="n">FeH_0</span><span class="p">)</span><span class="o">*</span><span class="n">f_t</span>
        <span class="k">return</span> <span class="n">FeH</span></div>
    
    
<div class="viewcode-block" id="AMR.amrd_global_sj22_custom"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrd_global_sj22_custom">[docs]</a>    <span class="k">def</span> <span class="nf">amrd_global_sj22_custom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AMR from Sysoliatina and Just (2022), Eq. (22) and (23), </span>
<span class="sd">        calculated for the specified Galactocentric distance. Extension of the local parameters </span>
<span class="sd">        to an arbitrary radius is done as explained </span>
<span class="sd">        in Table 2 in Sysoliatina and Just (2022). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param R: Galactocentric distance for which AMR has to be calculated, kpc. </span>
<span class="sd">            Note that the recommended range is 4-14 kpc (see the paper). </span>
<span class="sd">        :type R: scalar</span>
<span class="sd">        :param p: Set of model parameters from the parameter file. </span>
<span class="sd">        :type p: namedtuple</span>
<span class="sd">        </span>
<span class="sd">        :return: Metallicities of the thin-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or ndarray  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">alpha_w</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k_alphaw</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b_alphaw</span>
        
        <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">Rbr1</span><span class="p">:</span> 
            <span class="n">FeH_p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k1_FeHdp</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">Rbr1</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b1_FeHdp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">FeH_p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k1_FeHdp</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b1_FeHdp</span>
        
        <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">Rbr2</span><span class="p">:</span>
            <span class="n">t01</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k1_t01</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b1_t01</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">Rbr3</span><span class="p">:</span>
                <span class="n">t01</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k2_t01</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b2_t01</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t01</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k3_t01</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b3_t01</span>
                
        <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">Rbr1</span><span class="p">:</span>
            <span class="n">t02</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k1_t02</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b1_t02</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">Rbr3</span><span class="p">:</span>
                <span class="n">t02</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k2_t02</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b2_t02</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t02</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">k3_t02</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">b3_t02</span>    
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrd_global_sj22</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t01</span><span class="p">,</span><span class="n">t02</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">rd1</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">rd2</span><span class="p">,</span><span class="n">alpha_w</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">FeHd0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="AMR.amrd_global_sj22_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrd_global_sj22_default">[docs]</a>    <span class="k">def</span> <span class="nf">amrd_global_sj22_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AMR from Sysoliatina and Just (2022), Eq. (22) and (23), </span>
<span class="sd">        calculated for the specified Galactocentric distance with the best parameters (Table 2).  </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param R: Galactocentric distance for which AMR has to be calculated, kpc. </span>
<span class="sd">            Note that the recommended range is 4-14 kpc (see the paper). </span>
<span class="sd">        :type R: scalar</span>
<span class="sd">        :param p: Set of model parameters from the parameter file. </span>
<span class="sd">        :type p: namedtuple</span>
<span class="sd">        </span>
<span class="sd">        :return: Metallicities of the local thin-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or ndarray  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Break radii (kpc) for t01 and t02 AMRd parameters</span>
        <span class="c1"># for Eq. self.amrd_global_sj22. </span>
        <span class="n">R_br1</span> <span class="o">=</span> <span class="mi">6</span> 
        <span class="n">R_br2</span> <span class="o">=</span> <span class="mf">7.5</span> 
        <span class="n">R_br3</span> <span class="o">=</span> <span class="mf">9.75</span> 
        
        <span class="n">r1</span> <span class="o">=</span> <span class="mf">0.5</span> 
        <span class="n">r2</span> <span class="o">=</span> <span class="mf">1.5</span> 
        <span class="n">FeH_0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.81</span>
        <span class="n">alpha_w</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.39</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="mf">0.96</span>
        
        <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">R_br1</span><span class="p">:</span> 
            <span class="n">FeH_p</span> <span class="o">=</span> <span class="mf">0.39</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">FeH_p</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.58</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="mf">0.81</span>

        <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">R_br2</span><span class="p">:</span>
            <span class="n">t01</span> <span class="o">=</span> <span class="mf">2.04</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">-</span> <span class="mf">0.29</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">R_br3</span><span class="p">:</span>
                <span class="n">t01</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.69</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="mf">5.03</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t01</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.49</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="mf">6.7</span> 
                
        <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">R_br1</span><span class="p">:</span>
            <span class="n">t02</span> <span class="o">=</span> <span class="mf">18.06</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">-</span> <span class="mf">6.57</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;=</span> <span class="n">R_br3</span><span class="p">:</span>
                <span class="n">t02</span> <span class="o">=</span> <span class="mf">8.85</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">-</span> <span class="mf">3.65</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t02</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.54</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">+</span> <span class="mf">10.15</span>         
                
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrd_global_sj22</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t01</span><span class="p">,</span><span class="n">t02</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">alpha_w</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="AMR.amrt_sj21"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrt_sj21">[docs]</a>    <span class="k">def</span> <span class="nf">amrt_sj21</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thick-disk AMR from Sysoliatina and Just (2021), Eq. (21) and (22). </span>
<span class="sd">        Applicable to the Solar neighbourhood and other Galactocentric distances </span>
<span class="sd">        (AMR of the thick disk is assumed to be inpedended of radius). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param t0: Time-scale parameter, Gyr. </span>
<span class="sd">        :type t0: scalar</span>
<span class="sd">        :param r: Power index.</span>
<span class="sd">        :type r: scalar</span>
<span class="sd">        :param FeH_0: Initial metallicity of the thick disk in the Solar neighbourhood. </span>
<span class="sd">        :type FeH_0: scalar</span>
<span class="sd">        :param FeH_p: Present-day metallicity of the thick disk in the Solar neighbourhood. </span>
<span class="sd">        :type FeH_p: scalar</span>
<span class="sd">           </span>
<span class="sd">        :return: Metallicities of the thick-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">FeH</span> <span class="o">=</span> <span class="n">FeH_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">FeH_p</span> <span class="o">-</span> <span class="n">FeH_0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">))</span><span class="o">**</span><span class="n">r</span>
        <span class="k">return</span> <span class="n">FeH</span></div>
    
    
<div class="viewcode-block" id="AMR.amrt_sj21_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrt_sj21_default">[docs]</a>    <span class="k">def</span> <span class="nf">amrt_sj21_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thick-disk AMR from Sysoliatina and Just (2021), Eq. (21) and (22), </span>
<span class="sd">        calculated with the best parameters (Table 3). </span>
<span class="sd">                </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">           </span>
<span class="sd">        :return: Metallicities of the thick-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">FeH_0</span><span class="p">,</span> <span class="n">FeH_p</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.94</span><span class="p">,</span> <span class="mf">0.04</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mf">0.77</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.97</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrt_sj21</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="AMR.amrt_sj22"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrt_sj22">[docs]</a>    <span class="k">def</span> <span class="nf">amrt_sj22</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thick-disk AMR from Sysoliatina and Just (2021), Eq. (22) and (23).  </span>
<span class="sd">        Difference from SJ21 is normalization (impact negligible). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param t0: Time-scale parameter, Gyr. </span>
<span class="sd">        :type t0: scalar</span>
<span class="sd">        :param r: Power index.</span>
<span class="sd">        :type r: scalar</span>
<span class="sd">        :param FeH_0: Initial metallicity of the thick disk in the Solar neighbourhood. </span>
<span class="sd">        :type FeH_0: scalar</span>
<span class="sd">        :param FeH_p: Present-day metallicity of the thick disk in the Solar neighbourhood. </span>
<span class="sd">        :type FeH_p: scalar</span>
<span class="sd">           </span>
<span class="sd">        :return: Metallicities of the thick-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">FeH</span> <span class="o">=</span> <span class="n">FeH_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">FeH_p</span> <span class="o">-</span> <span class="n">FeH_0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">))</span><span class="o">**</span><span class="n">r</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">t0</span><span class="p">))</span><span class="o">**</span><span class="n">r</span>
        <span class="k">return</span> <span class="n">FeH</span></div>


<div class="viewcode-block" id="AMR.amrt_sj22_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrt_sj22_default">[docs]</a>    <span class="k">def</span> <span class="nf">amrt_sj22_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thick-disk AMR from Sysoliatina and Just (2021), Eq. (22) and (23), calculated with </span>
<span class="sd">        the best parameters (Table 2). Independent of radius, applicable for Galactocentric distances </span>
<span class="sd">        R = 4-14 kpc. </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">           </span>
<span class="sd">        :return: Metallicities of the local thick-disk populations born at Galactic times **t**.</span>
<span class="sd">        :rtype: float or array-like  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">FeH_0</span><span class="p">,</span> <span class="n">FeH_p</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.89</span><span class="p">,</span> <span class="mf">0.04</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mf">1.04</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="mf">0.96</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrt_sj22</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AMR.amrr"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.amrr">[docs]</a>    <span class="k">def</span> <span class="nf">amrr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AMR across the disk. </span>
<span class="sd">        If ``p.fehkey=0``, AMR is from Sysoliatina and Just (2021), and AMR parameters are assumed </span>
<span class="sd">        to be linear functions of Galactocentric distance (old version of the AMR generalization). </span>
<span class="sd">        If ``p.fehkey=1`` or ``p.fehkey=2``, AMR and its extension approach are as in </span>
<span class="sd">        Sysoliatina and Just (2022). In case of ``p.fehkey=1``, parameters are taken from </span>
<span class="sd">        the parameter file (i.e., custom), and when ``p.fehkey=2``, </span>
<span class="sd">        parameters are default (best from Sysoliatina and Just 2022). </span>
<span class="sd">        </span>
<span class="sd">        :param p: Set of model parameters from the parameter file. </span>
<span class="sd">        :type p: namedtuple</span>
<span class="sd">        :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">        :type a: namedtuple  </span>

<span class="sd">        :return: Thin-disk AMR calculated for the Galactocentric distances ``a.R``, </span>
<span class="sd">            array size is ``(a.Rbins,a.jd)``.</span>
<span class="sd">        :rtype: 2d-array </span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">amrd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">fehkey</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">FeH_0</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHd0</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">k_FeHd0</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>
                <span class="n">FeH_p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHdp</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">k_FeHdp</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">q</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">k_q</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">rd</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">k_rd</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>
                <span class="n">amrd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrd_sj21</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">FeH_0</span><span class="p">,</span><span class="n">FeH_p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">fehkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">amrd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrd_global_sj22_custom</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">fehkey</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">amrd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrd_global_sj22_default</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">amrd</span></div>
    
    
<div class="viewcode-block" id="AMR.get_amr"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.get_amr">[docs]</a>    <span class="k">def</span> <span class="nf">get_amr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fe_ax</span><span class="p">,</span><span class="n">nfe_cum</span><span class="p">,</span><span class="n">t_ax</span><span class="p">,</span><span class="n">nt_cum</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reconstructs AMR from a normalized cumulative metallicity distribution function (CMDF) </span>
<span class="sd">        and a normalized cumulative age distribution function (CADF). The first can be taken from </span>
<span class="sd">        some observational data, the latter is modeled. Both CMDF and CADF correspond to the same </span>
<span class="sd">        stellar population. See Sysoliatina and Just (2021) and Sysoliatina and Just (2022) for </span>
<span class="sd">        the approach description. </span>
<span class="sd">        </span>
<span class="sd">        :param fe_ax: Bin centers of the CMDF metallicity grid, dex.</span>
<span class="sd">        :type fe_ax: array-like</span>
<span class="sd">        :param nfe_cum: CMDF y-values corresponding to fe_ax. </span>
<span class="sd">        :type nfe_cum: array-like</span>
<span class="sd">        :param t_ax: Bin centers of CADF (Galactic time, not age!), Gyr. Length of t_ax does not need </span>
<span class="sd">            to be the same as of fe_ax. </span>
<span class="sd">        :type t_ax: array-like</span>
<span class="sd">        :param nt_cum: CADF y-values corresponding to t_ax.</span>
<span class="sd">        :type nt_cum: array-like</span>
<span class="sd">        :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">        :type a: namedtuple  </span>
<span class="sd">        </span>
<span class="sd">        :return: Metallicity as a function of Galactic time, array corresponds </span>
<span class="sd">            to the time array ``a.t``.</span>
<span class="sd">        :rtype: 1d-array</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">n_cum_common</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">)</span>
        <span class="n">cnv</span> <span class="o">=</span> <span class="n">ConvertAxes</span><span class="p">()</span>
        <span class="n">fe_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">nfe_cum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">nfe_cum</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_fe</span> <span class="o">=</span> <span class="n">cnv</span><span class="o">.</span><span class="n">get_closest</span><span class="p">(</span><span class="n">n_cum_common</span><span class="p">,</span><span class="n">nfe_cum</span><span class="p">[</span><span class="n">fe_range</span><span class="p">],</span><span class="n">fe_ax</span><span class="p">[</span><span class="n">fe_range</span><span class="p">])</span>
        
        <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nt_cum</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_range</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">:</span>
            <span class="n">new_t</span> <span class="o">=</span> <span class="n">cnv</span><span class="o">.</span><span class="n">get_closest</span><span class="p">(</span><span class="n">n_cum_common</span><span class="p">,</span><span class="n">nt_cum</span><span class="p">[</span><span class="n">t_range</span><span class="p">],</span><span class="n">t_ax</span><span class="p">[</span><span class="n">t_range</span><span class="p">])</span>
            <span class="n">derived_amr</span> <span class="o">=</span> <span class="n">cnv</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">new_t</span><span class="p">,</span><span class="n">new_fe</span><span class="p">)[</span><span class="n">t_range</span><span class="p">]</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_range</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">t_range</span><span class="p">)],</span><span class="n">derived_amr</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_range</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">:],</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">amr_end</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t_range</span><span class="p">):]]</span>
            <span class="n">derived_amr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">derived_amr</span><span class="p">,</span><span class="n">amr_end</span><span class="p">),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_t</span> <span class="o">=</span> <span class="n">cnv</span><span class="o">.</span><span class="n">get_closest</span><span class="p">(</span><span class="n">n_cum_common</span><span class="p">,</span><span class="n">nt_cum</span><span class="p">,</span><span class="n">t_ax</span><span class="p">)</span>
            <span class="n">derived_amr</span> <span class="o">=</span> <span class="n">cnv</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">new_t</span><span class="p">,</span><span class="n">new_fe</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">derived_amr</span></div>
    
    
<div class="viewcode-block" id="AMR.chemical_disks"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.chemical_disks">[docs]</a>    <span class="k">def</span> <span class="nf">chemical_disks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">,</span><span class="n">feh_br</span><span class="p">,</span><span class="n">alpha_br</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to separate two populations in :math:`\mathrm{[Fe/H]}\\text{-}\mathrm{[{\\alpha}/Fe]}` plane. </span>
<span class="sd">        Shape of the separating border was chosed based on the APOGEE Red Clump data </span>
<span class="sd">        (may be not optimal for other data samples). Equation defining the border </span>
<span class="sd">        between high-:math:`\\alpha` and low-:math:`\\alpha` populations has the form:</span>
<span class="sd">        :math:`\mathrm{[\\alpha/Fe]} = \mathrm{[\\alpha/Fe]}_1, \  \\text{if} \ \mathrm{[Fe/H]} &lt; \mathrm{[Fe/H]}_1`, </span>
<span class="sd">        :math:`\mathrm{[\\alpha/Fe]} = k \mathrm{[Fe/H]} + b,  \ \\text{if} \ \mathrm{[Fe/H]}_1 &lt; \mathrm{[Fe/H]} &lt; \mathrm{[Fe/H]}_2`, </span>
<span class="sd">        :math:`\mathrm{[\\alpha/Fe]} = \mathrm{[\\alpha/Fe]}_2, \ \\text{if} \ \mathrm{[Fe/H]} &gt; \mathrm{[Fe/H]}_2`</span>
<span class="sd">        </span>
<span class="sd">        :param tab: :math:`\mathrm{[Fe/H]}` and :math:`\mathrm{[\\alpha/Fe]}` data columns.</span>
<span class="sd">        :type tab: list[array-likes]</span>
<span class="sd">        :param feh_br: Break points :math:`\mathrm{[Fe/H]}_1` and :math:`\mathrm{[Fe/H]}_2`.</span>
<span class="sd">        :type feh_br: list</span>
<span class="sd">        :param alpha_br: Parameters :math:`\mathrm{[\\alpha/Fe]}_1` and :math:`\mathrm{[\\alpha/Fe]}_2`. </span>
<span class="sd">        :type alpha_br: list</span>
<span class="sd">            </span>
<span class="sd">        :return: Arrays with indices of **tab** rows corresponding to the low- and </span>
<span class="sd">            high-:math:`\\alpha` populations.</span>
<span class="sd">        :rtype: list[1d-array]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">FeH</span><span class="p">,</span> <span class="n">AlphaFe</span> <span class="o">=</span> <span class="n">tab</span>
        <span class="n">FeH1</span><span class="p">,</span> <span class="n">FeH2</span> <span class="o">=</span> <span class="n">feh_br</span>
        <span class="n">AlphaFe1</span><span class="p">,</span> <span class="n">AlphaFe2</span> <span class="o">=</span> <span class="n">alpha_br</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">AlphaFe2</span> <span class="o">-</span> <span class="n">AlphaFe1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FeH2</span> <span class="o">-</span> <span class="n">FeH1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">AlphaFe2</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">FeH2</span>
        
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FeH</span><span class="p">)</span>
        <span class="n">disk_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">FeH</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">FeH2</span> <span class="ow">and</span> <span class="n">AlphaFe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">AlphaFe2</span><span class="p">:</span>
                <span class="n">disk_flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">FeH</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">FeH2</span> <span class="ow">and</span> <span class="n">FeH</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">FeH1</span> <span class="ow">and</span> <span class="n">AlphaFe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span><span class="o">*</span><span class="n">FeH</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">disk_flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">FeH</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">FeH1</span> <span class="ow">and</span> <span class="n">AlphaFe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">AlphaFe1</span><span class="p">:</span>
                <span class="n">disk_flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                
        <span class="n">low_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">disk_flag</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">high_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">disk_flag</span><span class="o">==</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">low_alpha</span><span class="p">,</span> <span class="n">high_alpha</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="AMR.chemical_disks_sj21"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.chemical_disks_sj21">[docs]</a>    <span class="k">def</span> <span class="nf">chemical_disks_sj21</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as :meth:`jjmodel.funcs.AMR.chemical_disks`, but with the specified separating border </span>
<span class="sd">        location (for the APOGEE RC DR14). Can be not optimal for other data samples </span>
<span class="sd">        (also for other releases of the RC catalogue). </span>
<span class="sd">        </span>
<span class="sd">        :param tab: :math:`\mathrm{[Fe/H]}` and :math:`\mathrm{[\\alpha/Fe]}` data columns.</span>
<span class="sd">        :type tab: list[array-likes]</span>

<span class="sd">        :return: Arrays with indices of **tab** rows corresponding to the low- and </span>
<span class="sd">            high-:math:`\\alpha` populations.</span>
<span class="sd">        :rtype: list[1d-array]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">low_alpha</span><span class="p">,</span> <span class="n">high_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemical_disks</span><span class="p">(</span><span class="n">tab</span><span class="p">,[</span><span class="o">-</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.18</span><span class="p">,</span><span class="mf">0.07</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">low_alpha</span><span class="p">,</span> <span class="n">high_alpha</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="AMR.chemical_disks_mg"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.chemical_disks_mg">[docs]</a>    <span class="k">def</span> <span class="nf">chemical_disks_mg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as :meth:`jjmodel.funcs.AMR.chemical_disks`, but for :math:`\mathrm{[Fe/H]}\\text{-}\mathrm{[Mg/Fe]}`</span>
<span class="sd">        plane. Separating border is adapted for the RAVE DR5, may be not optimal for other data samples. </span>
<span class="sd">        </span>
<span class="sd">        :param tab: :math:`\mathrm{[Fe/H]}` and :math:`\mathrm{[Mg/Fe]}` data columns.</span>
<span class="sd">        :type tab: list[array-likes]</span>

<span class="sd">        :return: Arrays with indices of **tab** rows corresponding to the low- and </span>
<span class="sd">            high-:math:`\\alpha` populations.</span>
<span class="sd">        :rtype: list[1d-array]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">FeH</span><span class="p">,</span> <span class="n">MgFe</span> <span class="o">=</span> <span class="n">tab</span>
        
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FeH</span><span class="p">)</span>
        <span class="n">disk_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">FeH</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span> <span class="ow">and</span> <span class="n">MgFe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
                <span class="n">disk_flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                            
        <span class="n">low_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">disk_flag</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">high_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">disk_flag</span><span class="o">==</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">low_alpha</span><span class="p">,</span> <span class="n">high_alpha</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="AMR.get_metcum"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.get_metcum">[docs]</a>    <span class="k">def</span> <span class="nf">get_metcum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Rlim</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">tab</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>   
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates normalized cumulative metallicity distribution function (CMDF) from the data. </span>
<span class="sd">        </span>
<span class="sd">        :param Rlim: Range of Galactocentric distances, same units as for Galactocentric distance </span>
<span class="sd">            column *R* in the input data **tab**.</span>
<span class="sd">        :type Rlim: list[scalar]</span>
<span class="sd">        :param zlim: Range of heights above the Galactic plane, same units as for column *z* </span>
<span class="sd">            in the input data **tab**.</span>
<span class="sd">        :type zlim: list[scalar]</span>
<span class="sd">        :param tab: Array of the shape *(n,4)*, where *n* is an arbitrary length of all columns. </span>
<span class="sd">                Columns order is *(R,D,z,Fe)*. *R* and *D* are Galactocentric and heliocentric distances </span>
<span class="sd">                (both in the same units, pc or kpc). *z* is distance from the Galactic plane </span>
<span class="sd">                (can be also just absolute value). *Fe* is metallicity. </span>
<span class="sd">        :type tab: ndarray</span>
<span class="sd">        :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">        :type a: namedtuple</span>
<span class="sd">        :param Dmax: Optional, maximal heliocentric distance, same units as in column *D* in **tab**. </span>
<span class="sd">        :type Dmax: scalar         </span>
<span class="sd">        </span>
<span class="sd">        :return: The output list consists of *(FeH_bins, Ncum, Ncum_err, FeH_mean)*. </span>
<span class="sd">                *FeH_bins* is the metallicity grid with bin centers. *Ncum* contains CMDF y-values</span>
<span class="sd">                corresponding to *FeH_bins*. *Ncum_err* is a column of y-errors (Poisson noise in bins). </span>
<span class="sd">                *FeH_mean* is a mean metallicity of the selected sample.</span>
<span class="sd">        :rtype: list[1d-array,1d-array,1d-array,float]            </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">R1</span><span class="p">,</span><span class="n">R2</span> <span class="o">=</span> <span class="n">Rlim</span>
        <span class="n">zlow</span><span class="p">,</span><span class="n">zup</span> <span class="o">=</span> <span class="n">zlim</span>
        <span class="n">R</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">Fe</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">T</span>
        
        <span class="k">if</span> <span class="s1">&#39;Dmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">R</span><span class="o">&gt;=</span><span class="n">R1</span><span class="p">,</span><span class="n">R</span><span class="o">&lt;</span><span class="n">R2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">zlow</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">zup</span><span class="p">,</span>
                                             <span class="n">D</span><span class="o">&lt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Dmax&#39;</span><span class="p">]])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">R</span><span class="o">&gt;=</span><span class="n">R1</span><span class="p">,</span><span class="n">R</span><span class="o">&lt;</span><span class="n">R2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">zlow</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">zup</span><span class="p">])]</span>
        <span class="n">R</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">Fe</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">T</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        
        <span class="n">FeH_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Fe</span><span class="p">)</span>              
        <span class="n">N</span><span class="p">,</span> <span class="n">FeH_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">Fe</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">)</span>      

        <span class="n">dn</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">dn</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">dn</span><span class="p">)),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>   
        <span class="n">N_smoothed</span> <span class="o">=</span> <span class="n">sgn</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">3</span><span class="p">)[</span><span class="n">dn</span><span class="p">:</span><span class="o">-</span><span class="n">dn</span><span class="p">]</span>
        <span class="n">N_smoothed</span><span class="p">[</span><span class="n">N_smoothed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">N_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N_smoothed</span><span class="p">)</span> 
        <span class="n">Ncum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">N_smoothed</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">N_smoothed</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">FeH_bins</span> <span class="o">=</span> <span class="n">FeH_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">FeH_bins</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">Ncum_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">((</span><span class="n">N_noise</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">jd_array</span><span class="p">])</span>
               
        <span class="k">return</span> <span class="p">(</span><span class="n">FeH_bins</span><span class="p">,</span> <span class="n">Ncum</span><span class="p">,</span> <span class="n">Ncum_err</span><span class="p">,</span> <span class="n">FeH_mean</span><span class="p">)</span></div>
          
    
<div class="viewcode-block" id="AMR.conv"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.conv">[docs]</a>    <span class="k">def</span> <span class="nf">conv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analytical convolution of the linear function :math:`(k*x + b)` with a Gaussian kernel. </span>
<span class="sd">        See Eq.(20) in Sysoliatina and Just (2022). </span>
<span class="sd">        </span>
<span class="sd">        :param x: x-coordinates.</span>
<span class="sd">        :type x: array-like</span>
<span class="sd">        :param k: Slope of the linear function.</span>
<span class="sd">        :type k: scalar</span>
<span class="sd">        :param b: Intercept of the linear function.</span>
<span class="sd">        :type b: scalar</span>
<span class="sd">        :param sigma: Standard deviation of the kernel, same units as for **x**.</span>
<span class="sd">        :type sigma: scalar</span>
<span class="sd">        </span>
<span class="sd">        :return: y-coordinates of the convolution corresponding to **x** grid. </span>
<span class="sd">        :rtype: 1d-array  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">erf</span><span class="p">((</span><span class="n">b</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span> 
             <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">erf</span><span class="p">((</span><span class="n">k</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span> 
             <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">sigma</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">k</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
             <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
             <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">erf</span><span class="p">((</span><span class="n">b</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="o">/</span><span class="n">sigma</span><span class="p">))</span>
             <span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="AMR.get_convolved"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.get_convolved">[docs]</a>    <span class="k">def</span> <span class="nf">get_convolved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">ycum</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">y_linpart</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convolution of the normalized cumulative metallicity distribution function (CMDF) </span>
<span class="sd">        with a Gaussian kernel based on :meth:`jjmodel.funcs.AMR.conv`. </span>
<span class="sd">        Only the upper part of CMDF (**ycum** &gt; 0.5) is convolved. </span>
<span class="sd">        </span>
<span class="sd">        :param x: x-coordinates of CMDF (centers of metallicity bins).</span>
<span class="sd">        :type x: array-like</span>
<span class="sd">        :param ycum: y-coordinates of CMDF corresponding to **x**. </span>
<span class="sd">        :type ycum: array-like</span>
<span class="sd">        :param sigma: Standard deviation of the kernel, same units as for **x**.</span>
<span class="sd">        :type sigma: scalar    </span>
<span class="sd">        </span>
<span class="sd">        :return: y-coordinates of the convolved CMDF corresponding to **x** grid. </span>
<span class="sd">        :rtype: 1d-array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">y_linpart</span>       <span class="c1"># Linear part of the NCMD</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.00001</span>
        
        <span class="n">ind1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="n">y1</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="n">y2</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind1</span><span class="p">:</span><span class="n">ind2</span><span class="p">],</span><span class="n">ycum</span><span class="p">[</span><span class="n">ind1</span><span class="p">:</span><span class="n">ind2</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">linear_extrapolation</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">linear_extrapolation</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">linear_extrapolation</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    
        <span class="n">x1min</span><span class="p">,</span> <span class="n">x2max</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">dx</span>
        <span class="n">x1max</span><span class="p">,</span> <span class="n">x2min</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">dx</span>
        <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x2max</span><span class="o">-</span><span class="n">x1min</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x2min</span><span class="o">-</span><span class="n">x1max</span><span class="p">)</span>
        <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">x1min</span><span class="p">,</span> <span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">x1max</span> 
        <span class="n">k</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">])</span>
        
        <span class="n">ind_mean1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ycum_convolved_part</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">sigma</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="n">ind_mean1</span><span class="p">:]]</span>
        <span class="c1">#ycum_convolved_part = [self.conv(i,line[0],line[1],sigma) for i in x[ind_mean1:]]</span>
        <span class="n">ycum_convolved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ycum</span><span class="p">[:</span><span class="n">ind_mean1</span><span class="p">],</span><span class="n">ycum_convolved_part</span><span class="p">),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ycum_convolved</span></div>
        
        
<div class="viewcode-block" id="AMR.get_deconvolved"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.get_deconvolved">[docs]</a>    <span class="k">def</span> <span class="nf">get_deconvolved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">ycum</span><span class="p">,</span><span class="n">y_linpart</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reconstructs &#39;true&#39; normalized cumulative metallicity distribution function (CMDF) </span>
<span class="sd">        assuming that the observed CMDF is a convolution of the &#39;true&#39; distribution with a Gaussian </span>
<span class="sd">        kernel (e.g. related to observational errors). See Sysoliatina and Just (2021) and </span>
<span class="sd">        Sysoliatina and Just (2022) for details. </span>
<span class="sd">        </span>
<span class="sd">        :param x: x-coordinates of CMDF (centers of metallicity bins).</span>
<span class="sd">        :type x: array-like</span>
<span class="sd">        :param ycum: y-coordinates of CMDF corresponding to **x**. </span>
<span class="sd">        :type ycum: array-like</span>
<span class="sd">        :param y_linpart: y-values of the input CMDF giving the range </span>
<span class="sd">                where the distribution is approximately linear.  </span>
<span class="sd">        :type y_linpart: list[scalar]    </span>

<span class="sd">        :return: Output is the list *(ycum_deconvolved,ycum_convolved,sigma)*. </span>
<span class="sd">            *ycum_deconvolved* contains y-coordinates of the reconstructed &#39;true&#39; CMDF.</span>
<span class="sd">            *ycum_convolved* is a convolution of *ycum_deconvolved* with a kernel with </span>
<span class="sd">            the standard deviation *sigma*. Should reasonably reproduce the input CMDF. </span>
<span class="sd">        :rtype: list[1d-array,1d-array,float]        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">y_linpart</span>               <span class="c1"># Linear part of the NCMD</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.00001</span>
        
        <span class="n">ind1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="n">y1</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="n">y2</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind1</span><span class="p">:</span><span class="n">ind2</span><span class="p">],</span><span class="n">ycum</span><span class="p">[</span><span class="n">ind1</span><span class="p">:</span><span class="n">ind2</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">linear_extrapolation</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">linear_extrapolation</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">linear_extrapolation</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    
        <span class="n">x1min</span><span class="p">,</span> <span class="n">x2max</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">dx</span>
        <span class="n">x1max</span><span class="p">,</span> <span class="n">x2min</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">dx</span>
        <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x2max</span><span class="o">-</span><span class="n">x1min</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x2min</span><span class="o">-</span><span class="n">x1max</span><span class="p">)</span>
        <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">x1min</span><span class="p">,</span> <span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="n">x1max</span> 
        <span class="n">k</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">])</span>
    
        <span class="n">ind_mean1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ycum</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">ind_mean1</span><span class="p">:],</span><span class="n">ycum</span><span class="p">[</span><span class="n">ind_mean1</span><span class="p">:],</span>
                              <span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">],[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mf">0.25</span><span class="p">]))</span>                              
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        def conv(x,sigma):</span>
<span class="sd">            return self.conv(x,line[1],line[0],sigma)</span>

<span class="sd">        popt, pcov = curve_fit(conv,x[ind_mean1:],ycum[ind_mean1:],bounds=([0],[0.25]))                              </span>
<span class="sd">        sigma = popt</span>
<span class="sd">        ycum_linear_part = line(x[ind_mean1:])</span>
<span class="sd">        ycum_convolved_part = [conv(i,*popt) for i in x[ind_mean1:]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ycum_linear_part</span> <span class="o">=</span> <span class="p">[</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="n">ind_mean1</span><span class="p">:]]</span>
        <span class="n">ycum_convolved_part</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="o">*</span><span class="n">popt</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="n">ind_mean1</span><span class="p">:]]</span>
        <span class="n">ycum_deconvolved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ycum</span><span class="p">[:</span><span class="n">ind_mean1</span><span class="p">],</span><span class="n">ycum_linear_part</span><span class="p">),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ycum_convolved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ycum</span><span class="p">[:</span><span class="n">ind_mean1</span><span class="p">],</span><span class="n">ycum_convolved_part</span><span class="p">),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">ycum_deconvolved</span><span class="p">[</span><span class="n">ycum_deconvolved</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ycum_deconvolved</span><span class="p">[</span><span class="n">ycum_deconvolved</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">ycum_deconvolved</span><span class="p">,</span> <span class="n">ycum_convolved</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AMR.mass_loss_jj10_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.mass_loss_jj10_default">[docs]</a>    <span class="k">def</span> <span class="nf">mass_loss_jj10_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk mass loss function calculated with the **Chempy** code consistent with the three-slope </span>
<span class="sd">        broken power-law IMF from Rybizki and Just (2015) and AMR from Just and Jahreiss (2010). </span>
<span class="sd">        This mass loss function is close to the one used in Just and Jahreiss (2010). </span>
<span class="sd">        </span>
<span class="sd">        :return: Mass loss as a function of Galactic time ``a.t``.</span>
<span class="sd">        :rtype: 1d-array            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">t</span><span class="p">,</span> <span class="n">gd_jj10_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;mass_loss&#39;</span><span class="p">,</span><span class="s1">&#39;gd_jj10_default.txt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">gd_jj10_default</span></div>


<div class="viewcode-block" id="AMR.mass_loss_sj21_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.mass_loss_sj21_default">[docs]</a>    <span class="k">def</span> <span class="nf">mass_loss_sj21_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk mass loss function calculated with the **Chempy** code consistent with the four-slope </span>
<span class="sd">        broken power-law IMF and AMR from Sysoliatina and Just (2021).</span>
<span class="sd">        </span>
<span class="sd">        :return: Thin-disk mass loss as a function of Galactic time ``a.t`` and </span>
<span class="sd">            thick-disk mass loss as a function of Galactic time ``a.t[:a.jt]``. </span>
<span class="sd">        :rtype: list[1d-array]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">t</span><span class="p">,</span> <span class="n">gd_sj21_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;mass_loss&#39;</span><span class="p">,</span><span class="s1">&#39;gd_sj20_default.txt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">gt_sj21_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;mass_loss&#39;</span><span class="p">,</span><span class="s1">&#39;gt_sj20_default.txt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">gd_sj21_default</span><span class="p">,</span> <span class="n">gt_sj21_default</span><span class="p">)</span></div>
        
    
<div class="viewcode-block" id="AMR.mass_loss"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.mass_loss">[docs]</a>    <span class="k">def</span> <span class="nf">mass_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">FeH</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mass loss for an arbitrary AMR (IMF </span>
<span class="sd">        is a four-slope broken power law from Sysoliatina and Just 2021).         </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr.</span>
<span class="sd">        :type t: array-like</span>
<span class="sd">        :param FeH: Metallicity of stellar populations born at Galactic time **t**.</span>
<span class="sd">        :type FeH: array-like</span>
<span class="sd">        </span>
<span class="sd">        :return: Mass loss function (fraction in stars and remnants) as a function of time **t**. </span>
<span class="sd">        :rtype: 1d-array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">FeH</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in mass_loss()! Lengths of time- and [Fe/H]-array must be equal!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;mass_loss&#39;</span><span class="p">,</span><span class="s1">&#39;g_grid.npy&#39;</span><span class="p">))</span>
        
        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.025</span>              <span class="c1"># Gyr, time step used in the pre-calculated mass loss grid</span>
        <span class="n">fe0</span><span class="p">,</span> <span class="n">dfe</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.02</span>   <span class="c1"># Min metallicity and step used in the pre-calculated mass loss grid</span>
        <span class="n">indt</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">t</span><span class="o">//</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">indfe</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">FeH</span><span class="o">//</span><span class="n">dfe</span> <span class="o">-</span> <span class="n">fe0</span><span class="o">//</span><span class="n">dfe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> 
                
        <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grid</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indt</span><span class="p">,</span><span class="n">indfe</span><span class="p">)])</span>
                
        <span class="k">return</span> <span class="n">g</span>        </div>
        
    
<div class="viewcode-block" id="AMR.z2fe"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.z2fe">[docs]</a>    <span class="k">def</span> <span class="nf">z2fe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to convert mass fraction of metals *Z* into abundance :math:`\mathrm{[Fe/H]}`. </span>
<span class="sd">        Formulae are taken </span>
<span class="sd">        from Choi et al. (2016). The approach adopts a primordial helium abundance *Yp* = 0.249</span>
<span class="sd">        (Planck Collaboration et al. 2015) determined by combining the Planck power spectra, </span>
<span class="sd">        Planck lensing, and a number of &#39;external data&#39; such as baryonic acoustic oscillations. </span>
<span class="sd">        In the equations below, a linear enrichment law to the protosolar helium abundance, </span>
<span class="sd">        *Y_protosolar* = 0.2703 (Asplund et al.2009), is assumed. Once *Y* is computed for a desired </span>
<span class="sd">        value of *Z*, *X* and :math:`\mathrm{[Fe/H]}` is trivial to compute.</span>
<span class="sd">        </span>
<span class="sd">        :param Z: Mass fraction of metals in a star.</span>
<span class="sd">        :type Z: scalar or array-like</span>
<span class="sd">            </span>
<span class="sd">        :return: Chemical abundance of metals, dex. </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">Yp</span> <span class="o">=</span> <span class="mf">0.249</span> 
        <span class="n">Y_protosolar</span><span class="p">,</span> <span class="n">Z_protosolar</span> <span class="o">=</span> <span class="mf">0.2703</span><span class="p">,</span> <span class="mf">0.0142</span>  
        <span class="n">Z_sun</span><span class="p">,</span> <span class="n">X_sun</span> <span class="o">=</span> <span class="mf">0.0152</span><span class="p">,</span> <span class="mf">0.7381</span>   <span class="c1"># Present-day solar abundaces from Asplund et al. (2009)</span>
        
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Yp</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="n">Y_protosolar</span><span class="o">-</span><span class="n">Yp</span><span class="p">)</span><span class="o">/</span><span class="n">Z_protosolar</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span> 
        <span class="n">X</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Y</span> <span class="o">-</span> <span class="n">Z</span>
        <span class="n">FeH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Z_sun</span><span class="o">/</span><span class="n">X_sun</span><span class="p">))</span> 
            
        <span class="k">return</span> <span class="n">FeH</span></div>


<div class="viewcode-block" id="AMR.fe2z"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AMR.fe2z">[docs]</a>    <span class="k">def</span> <span class="nf">fe2z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FeH</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to convert abundance :math:`\mathrm{[Fe/H]}` into mass fraction of metals *Z*. </span>
<span class="sd">        Formulae are taken </span>
<span class="sd">        from Choi et al. (2016). The approach adopts a primordial helium abundance *Yp* = 0.249</span>
<span class="sd">        (Planck Collaboration et al. 2015) determined by combining the Planck power spectra, </span>
<span class="sd">        Planck lensing, and a number of &#39;external data&#39; such as baryonic acoustic oscillations. </span>
<span class="sd">        In the equations below, a linear enrichment law to the protosolar helium abundance, </span>
<span class="sd">        *Y_protosolar* = 0.2703 (Asplund et al.2009), is assumed. </span>
<span class="sd">        </span>
<span class="sd">        :param FeH: Chemical abundance of metals, dex. </span>
<span class="sd">        :type FeH: scalar or array-like</span>

<span class="sd">        :return: Mass fraction of metals in a star.</span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">Yp</span> <span class="o">=</span> <span class="mf">0.249</span> 
        <span class="n">Y_protosolar</span><span class="p">,</span> <span class="n">Z_protosolar</span> <span class="o">=</span> <span class="mf">0.2703</span><span class="p">,</span> <span class="mf">0.0142</span> 
        <span class="n">Z_sun</span><span class="p">,</span> <span class="n">X_sun</span> <span class="o">=</span> <span class="mf">0.0152</span><span class="p">,</span> <span class="mf">0.7381</span>   <span class="c1"># Present-day solar abundaces from Asplund et al. (2009)</span>
    
        <span class="n">up</span> <span class="o">=</span> <span class="n">Z_sun</span><span class="o">/</span><span class="n">X_sun</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">FeH</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Yp</span><span class="p">)</span>
        <span class="n">down</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Z_sun</span><span class="o">/</span><span class="n">X_sun</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">FeH</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Y_protosolar</span> <span class="o">-</span> <span class="n">Yp</span><span class="p">)</span><span class="o">/</span><span class="n">Z_protosolar</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">up</span><span class="o">/</span><span class="n">down</span>
        
        <span class="k">return</span> <span class="n">Z</span></div></div>
    
  
     
<div class="viewcode-block" id="AVR"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AVR">[docs]</a><span class="k">class</span> <span class="nc">AVR</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of methods to work with the age-velocity dispersion relation (AVR). </span>
<span class="sd">    Here velocity dispersion is :math:`\\sigma_\mathrm{W}`, the vertical component. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="AVR.avr_jj10"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AVR.avr_jj10">[docs]</a>    <span class="k">def</span> <span class="nf">avr_jj10</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">sigma_e</span><span class="p">,</span><span class="n">tau0</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AVR in the Solar neighbourhood as defined in Just and Jahreiss (2010).</span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: float or array-like</span>
<span class="sd">        :param tp: Present-day age of the MW disk (i.e., present-day Galactic time), Gyr.</span>
<span class="sd">        :type tp: scalar </span>
<span class="sd">        :param sigma_e: AVR scaling factor, W-velocity dispersion of the oldest thin-disk </span>
<span class="sd">            stellar population in the Solar neighbourhood, :math:`\mathrm{km \ s^{-1}}`.    </span>
<span class="sd">        :type sigma_e: float</span>
<span class="sd">        :param tau0: AVR parameter, Gyr.</span>
<span class="sd">        :type tau0: scalar</span>
<span class="sd">        :param alpha: AVR power index.  </span>
<span class="sd">        :type alpha: scalar </span>
<span class="sd">        </span>
<span class="sd">        :return: Present-day W-velocity dispersion of the thin-disk populations at time **t**, </span>
<span class="sd">            :math:`\mathrm{km \ s^{-1}}`.  </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sigma_W</span> <span class="o">=</span> <span class="n">sigma_e</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">t</span><span class="p">),</span><span class="n">tau0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tau0</span><span class="p">))</span><span class="o">**</span><span class="n">alpha</span>
        <span class="k">return</span> <span class="n">sigma_W</span></div>

    
<div class="viewcode-block" id="AVR.avr_jj10_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.AVR.avr_jj10_default">[docs]</a>    <span class="k">def</span> <span class="nf">avr_jj10_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk AVR in the Solar neighbourhood as defined in Just and Jahreiss (2010) </span>
<span class="sd">        calculated with the best parameters (model A).</span>
<span class="sd">    </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: float or array-like</span>
<span class="sd">        :param stretch: Optional. If True, uses an extended (relative to model A) </span>
<span class="sd">                time scale by setting a present-day age of the MW disk to **tp** = 13 Gyr. </span>
<span class="sd">                By default is False, **tp** = 12 Gyr, as in Just and Jahreiss (2010).</span>
<span class="sd">        :type stretch: boolean </span>
<span class="sd">        </span>
<span class="sd">        :return: Present-day W-velocity dispersion of the thin-disk populations at time **t**, </span>
<span class="sd">            :math:`\mathrm{km \ s^{-1}}`.    </span>
<span class="sd">        :rtype: float or array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sigma_e</span> <span class="o">=</span> <span class="mi">25</span>    <span class="c1"># model A default parameters</span>
        <span class="n">tau0</span> <span class="o">=</span> <span class="mf">0.17</span> 
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.375</span> 
        
        <span class="k">if</span> <span class="s1">&#39;stretch&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;stretch&#39;</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">tp_</span> <span class="o">=</span> <span class="n">tp</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">tp_</span> <span class="o">=</span> <span class="mi">12</span>    
            
        <span class="n">sigma_W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avr_jj10</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tp_</span><span class="p">,</span><span class="n">sigma_e</span><span class="p">,</span><span class="n">tau0</span><span class="p">,</span><span class="n">alpha</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">sigma_W</span></div></div>



<div class="viewcode-block" id="SFR"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR">[docs]</a><span class="k">class</span> <span class="nc">SFR</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class with definitions of the MW disk star formation rate (SFR) function. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="SFR.__init__"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization includes reading several tables with the default mass loss functions, </span>
<span class="sd">        no parameters have to be specified. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g_jj10_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;mass_loss&#39;</span><span class="p">,</span><span class="s1">&#39;gd_jj10_default.txt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd_jj10_default</span> <span class="o">=</span> <span class="n">g_jj10_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gd_jj10_default_stretch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;mass_loss&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;gd_jj10_default_stretch.txt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gd_sj21_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;mass_loss&#39;</span><span class="p">,</span><span class="s1">&#39;gd_sj21_default.txt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gt_sj21_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localpath</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;mass_loss&#39;</span><span class="p">,</span><span class="s1">&#39;gt_sj21_default.txt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="SFR.sfrd_jj10"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrd_jj10">[docs]</a>    <span class="k">def</span> <span class="nf">sfrd_jj10</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin-disk SFR equation as defined in Just and Jahreiss (2010) (model A). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param tp: Present-day age of the MW disk (i.e., present-day Galactic time), Gyr.</span>
<span class="sd">        :type tp: scalar </span>
<span class="sd">        :param t0: SFR parameter, Gyr. </span>
<span class="sd">        :type t0: scalar</span>
<span class="sd">        :param t1: SFR parameter, Gyr. </span>
<span class="sd">        :type t1: scalar </span>
<span class="sd">        :param sigma: Midplane local present-day surface density of the thin disk, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2}}`.      </span>
<span class="sd">        :type sigma: scalar</span>
<span class="sd">        :param g: Optional, mass loss function (same length as **t**). </span>
<span class="sd">        :type g: scalar or array-like</span>
<span class="sd">        </span>
<span class="sd">        :return: Absolute and normalized SFR as functions of **t**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2} \ Gyr^{-1}}`. </span>
<span class="sd">            Normalization factor is the mean SFR </span>
<span class="sd">            (averaged over the whole time range of the disk evolution 0-**tp** Gyr). </span>
<span class="sd">        :rtype: list[1d-array] or list[float]             </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="s1">&#39;g&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">g0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd_jj10_default</span>
                
        <span class="n">normalized_sfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">t1</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> 
        <span class="n">normalized_sfr_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">t1</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> 
        <span class="n">SFR_scale</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g0</span><span class="o">*</span><span class="n">normalized_sfr_full</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">SFR</span> <span class="o">=</span> <span class="n">SFR_scale</span><span class="o">*</span><span class="n">normalized_sfr</span>
        <span class="n">SFR_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SFR</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">SFR</span><span class="p">,</span> <span class="n">SFR</span><span class="o">/</span><span class="n">SFR_mean</span><span class="p">)</span></div>


<div class="viewcode-block" id="SFR.sfrd_jj10_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrd_jj10_default">[docs]</a>    <span class="k">def</span> <span class="nf">sfrd_jj10_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SFR equation from Just and Jahreiss (2010) (model A)  </span>
<span class="sd">        (:meth:`jjmodel.funcs.SFR.sfrd_jj10`) calculated with the best parameters.</span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like</span>
<span class="sd">        :param stretch: Optional. If True, uses an extended (relative to model A) </span>
<span class="sd">                time scale by setting a present-day age of the MW disk to **tp** = 13 Gyr. </span>
<span class="sd">                By default is False, **tp** = 12 Gyr, as in Just and Jahreiss (2010).</span>
<span class="sd">        :type stretch: boolean </span>
<span class="sd">                   </span>
<span class="sd">        :return: Absolute and normalized SFR as a function of **t**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2} \ Gyr^{-1}}`. </span>
<span class="sd">            Normalization factor is the mean SFR </span>
<span class="sd">            (averaged over the whole time range of the disk evolution 0-**tp** Gyr). </span>
<span class="sd">        :rtype: list[1d-array] or list[float]     </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mf">8.2</span>    
        <span class="n">sigma0</span> <span class="o">=</span> <span class="mf">29.4</span> 
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrd_jj10</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">sigma0</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="SFR.sfrd_sj21"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrd_sj21">[docs]</a>    <span class="k">def</span> <span class="nf">sfrd_sj21</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dzeta</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SFR of the thin disk as defined in Sysoliatina and Just (2021).</span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like  </span>
<span class="sd">        :param dzeta: SFR power index. </span>
<span class="sd">        :type dzeta: scalar </span>
<span class="sd">        :param eta: SFR power index. </span>
<span class="sd">        :type eta: scalar </span>
<span class="sd">        :param t1: Parameter defining the SFR initial time-point (by default, **t1** = 0 Gyr, i.e., </span>
<span class="sd">                the thin disk starts to form without a delay). </span>
<span class="sd">        :type t1: scalar </span>
<span class="sd">        :param t2: Parameter controlling the SFR shape. </span>
<span class="sd">        :type t2: scalar </span>
<span class="sd">        :param sigma: Midplane present-day thin-disk surface density, :math:`\mathrm{M_\odot \ pc^{-2}}`.        </span>
<span class="sd">        :type sigma: scalar</span>
<span class="sd">        :param g: Optional, mass loss function (same length as **t**). </span>
<span class="sd">        :type g: scalar or array-like</span>
<span class="sd">            </span>
<span class="sd">        :return: Absolute and normalized SFR as a function of **t**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2} \ Gyr^{-1}}`. Normalization factor </span>
<span class="sd">            is the mean SFR (averaged over the whole time range of the disk evolution 0-**tp** Gyr). </span>
<span class="sd">        :rtype: list[1d-array] or list[float]    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="s1">&#39;g&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd_sj20_default</span>
            
        <span class="n">normalized_sfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">t1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t1</span><span class="p">:</span>
            <span class="n">indt0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">t1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">normalized_sfr</span><span class="p">[</span><span class="n">indt0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
            <span class="n">indt1</span> <span class="o">=</span> <span class="n">indt0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">normalized_sfr</span><span class="p">[</span><span class="n">indt1</span><span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">indt1</span><span class="p">:],</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">t1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="n">dzeta</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">indt1</span><span class="p">:],</span><span class="n">t2</span><span class="p">)</span><span class="o">**</span><span class="n">eta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">normalized_sfr</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">t1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="n">dzeta</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span><span class="o">**</span><span class="n">eta</span>
        <span class="n">SFR_scale</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="n">normalized_sfr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">SFR</span> <span class="o">=</span> <span class="n">SFR_scale</span><span class="o">*</span><span class="n">normalized_sfr</span>
        <span class="n">SFR_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SFR</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">SFR</span><span class="p">,</span> <span class="n">SFR</span><span class="o">/</span><span class="n">SFR_mean</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="SFR.sfrd_sj21_mono_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrd_sj21_mono_default">[docs]</a>    <span class="k">def</span> <span class="nf">sfrd_sj21_mono_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SFR of the thin disk, as defined in Sysoliatina and Just (2021) </span>
<span class="sd">        (:meth:`jjmodel.funcs.SFR.sfrd_sj21`) calculated with </span>
<span class="sd">        the best-fit parameters (model MCMC1).</span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like </span>
<span class="sd">        </span>
<span class="sd">        :return: Absolute and normalized SFR as a function of **t**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2} \ Gyr^{-1}}`. Normalization factor </span>
<span class="sd">            is the mean SFR (averaged over the whole time range of the disk evolution 0-**tp** Gyr). </span>
<span class="sd">        :rtype: list[1d-array] or list[float]    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">dzeta</span><span class="p">,</span> <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">5.6</span>
        <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">7.8</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="mf">29.4</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrd_sj21</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">dzeta</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span></div>


<div class="viewcode-block" id="SFR.sfrd_sj21_multipeak"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrd_sj21_multipeak">[docs]</a>    <span class="k">def</span> <span class="nf">sfrd_sj21_multipeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">tr</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dzeta</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">sigmap</span><span class="p">,</span><span class="n">tpk</span><span class="p">,</span><span class="n">dtp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SFR of the thin disk as defined in Sysoliatina and Just (2021) with any number of extra Gaussian </span>
<span class="sd">        peaks. Also, see Eqs. (7)-(10) in Sysoliatina and Just (2022). </span>
<span class="sd">        </span>
<span class="sd">        :param tp: Present-day age of the MW disk (i.e., present-day Galactic time), Gyr.</span>
<span class="sd">        :type tp: scalar </span>
<span class="sd">        :param tr: Time resolution of the model, Gyr.</span>
<span class="sd">        :type tr: scalar </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like </span>
<span class="sd">        :param dzeta: SFR power index. </span>
<span class="sd">        :type dzeta: scalar </span>
<span class="sd">        :param eta: SFR power index. </span>
<span class="sd">        :type eta: scalar </span>
<span class="sd">        :param t1: Parameter defining the SFR initial time-point (by default, **t1** = 0 Gyr, i.e., </span>
<span class="sd">                the thin disk starts to form without a delay). </span>
<span class="sd">        :type t1: scalar </span>
<span class="sd">        :param t2: Parameter controlling the SFR shape. </span>
<span class="sd">        :type t2: scalar            </span>
<span class="sd">        :param sigma: Midplane present-day thin-disk surface density, :math:`\mathrm{M_\odot \ pc^{-2}}`.        </span>
<span class="sd">        :type sigma: scalar</span>
<span class="sd">        :param sigmap: Amplitude-related parameter(s) of the additional Gaussian peak(s), </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2}}`. </span>
<span class="sd">        :type sigmap: array-like </span>
<span class="sd">        :param tpk: Mean Galactic time(s) of the Gaussian peak(s), Gyr. </span>
<span class="sd">        :type tpk: array-like </span>
<span class="sd">        :param dtp: Dispersion(s) of the Gaussian peak(s), Gyr</span>
<span class="sd">        :type dtp: array-like</span>
<span class="sd">        :param g: Optional, mass loss function (same length as **t**). </span>
<span class="sd">        :type g: array-like</span>
<span class="sd">            </span>
<span class="sd">        :return: Absolute and normalized SFR as a function of **t**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2} \ Gyr^{-1}}`, and ratio of the peaks&#39; contributions</span>
<span class="sd">            to the total SFR. Normalization factor is the mean SFR </span>
<span class="sd">            (averaged over the whole time range of the disk evolution 0-**tp** Gyr). </span>
<span class="sd">        :rtype: [1d-array,1d-array,list[1d-array]] or [float,float,list[float]]    </span>
<span class="sd">        &quot;&quot;&quot;</span>
                
        <span class="k">if</span> <span class="s1">&#39;g&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd_sj21_default</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ind_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">tpk</span><span class="o">-</span><span class="n">t1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ind_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">tpk</span><span class="o">-</span><span class="n">t1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigmap</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ind_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ind_peak</span><span class="p">])</span>
            
        <span class="n">ind_peak_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">ind_peak</span><span class="p">)</span>        <span class="c1"># The youngest peak population</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if ind_peak_max &gt;= jd:                  # Peak center can be outside of the time axis</span>
<span class="sd">            t_max = self.dt*(ind_peak_max+1)</span>
<span class="sd">            t_long = np.arange(t1+self.dt/2,t_max+self.dt/2,self.dt)</span>
<span class="sd">        else: </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">t_long</span> <span class="o">=</span> <span class="n">t</span>
        
        <span class="n">SFR_mono_long</span><span class="p">,</span> <span class="n">normalized_sfr_mono_long</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrd_sj21</span><span class="p">(</span><span class="n">t_long</span><span class="p">,</span><span class="n">dzeta</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">SFR_mono_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">SFR_mono_long</span><span class="p">)</span>
        <span class="n">sfr_at_peak</span> <span class="o">=</span> <span class="n">normalized_sfr_mono_long</span><span class="p">[</span><span class="n">ind_peak</span><span class="p">]</span>
                
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">SFR_mono_max</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">t_long</span><span class="p">,</span><span class="n">l</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                          <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sfr_at_peak</span><span class="p">,</span><span class="n">sigmap</span><span class="p">,</span><span class="n">tpk</span><span class="p">,</span><span class="n">dtp</span><span class="p">)])</span>
        
        <span class="n">normalized_sfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">normalized_sfr_mono_long</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                                
        <span class="n">SFR_scale</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="n">normalized_sfr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">SFR</span> <span class="o">=</span> <span class="n">SFR_scale</span><span class="o">*</span><span class="n">normalized_sfr</span>
        <span class="n">SFR_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SFR</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">SFR</span><span class="p">,</span> <span class="n">SFR</span><span class="o">/</span><span class="n">SFR_mean</span><span class="p">,</span> <span class="n">peaks</span><span class="o">/</span><span class="n">normalized_sfr</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="SFR.sfrd_sj21_multipeak_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrd_sj21_multipeak_default">[docs]</a>    <span class="k">def</span> <span class="nf">sfrd_sj21_multipeak_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>   
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SFR of the thin disk as defined in Sysoliatina and Just (2021) with two extra Gaussian peaks </span>
<span class="sd">        (see :meth:`jjmodel.funcs.SFR.sfrd_sj21_multipeak`). </span>
<span class="sd">        Calculated with the best-fit parameters (model MCMC1). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like               </span>
<span class="sd">             </span>
<span class="sd">        :return: Absolute and normalized SFR as a function of **t**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2} \ Gyr^{-1}}`, and ratio of the peaks&#39; contributions</span>
<span class="sd">            to the total SFR. Normalization factor is the mean SFR </span>
<span class="sd">            (averaged over the whole time range of the disk evolution 0-**tp** Gyr). </span>
<span class="sd">        :rtype: [1d-array,1d-array,list[1d-array]] or [float,float,list[float]]  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">tp_</span><span class="p">,</span> <span class="n">tr_</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="mf">0.025</span> 
        <span class="n">dzeta</span><span class="p">,</span> <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">5.59</span>
        <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">7.8</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="mf">29.3</span>
        <span class="n">sigmap</span><span class="p">,</span> <span class="n">tpk</span><span class="p">,</span> <span class="n">dtp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">1.4</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">12.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrd_sj21_multipeak</span><span class="p">(</span><span class="n">tp_</span><span class="p">,</span><span class="n">tr_</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dzeta</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">sigmap</span><span class="p">,</span><span class="n">tpk</span><span class="p">,</span><span class="n">dtp</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="SFR.sfrt_sj21"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrt_sj21">[docs]</a>    <span class="k">def</span> <span class="nf">sfrt_sj21</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SFR of the thick disk as defined in Sysoliatina and Just (2021), Eq. (7)-(8). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like  </span>
<span class="sd">        :param gamma: SFR power index. </span>
<span class="sd">        :type gamma: scalar</span>
<span class="sd">        :param beta: SFR exponential index. </span>
<span class="sd">        :type beta: scalar</span>
<span class="sd">        :param t1: Parameter defining the star formation rate at the initial time-point, **t** = 0 Gyr.  </span>
<span class="sd">        :type t1: scalar </span>
<span class="sd">        :param t2: Parameter defining the final time-point of the thick-disk formation, Gyr. </span>
<span class="sd">        :type t2: scalar </span>
<span class="sd">        :param sigma: Midplane present-day thick-disk surface density, :math:`\mathrm{M_\odot \ pc^{-2}}`. </span>
<span class="sd">        :type sigma: scalar </span>
<span class="sd">        :param g: Optional, mass loss function (for the time range 0-**t2** Gyr or 0-**tp** Gyr). </span>
<span class="sd">        :type g: scalar or array-like</span>
<span class="sd">        </span>
<span class="sd">        :return: Absolute and normalized SFR as a function of **t**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2} \ Gyr^{-1}}`. </span>
<span class="sd">            Normalization factor  is the mean SFR </span>
<span class="sd">            (averaged over the whole time range of the thick-disk evolution). </span>
<span class="sd">        :rtype: list[1d-array] or list[float]  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="s1">&#39;g&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][:</span><span class="nb">int</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt_sj20_default</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)]</span>
            
        <span class="n">normalized_sfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span><span class="o">**</span><span class="n">gamma</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="n">t</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">t2</span><span class="p">))</span>
        <span class="n">normalized_sfr_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)],</span><span class="n">t1</span><span class="p">)</span><span class="o">**</span><span class="n">gamma</span><span class="o">*</span>\
                             <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">t2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)]))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">t2</span><span class="p">))</span>
        <span class="n">SFR_mean</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="n">normalized_sfr_full</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">SFR</span> <span class="o">=</span> <span class="n">SFR_mean</span><span class="o">*</span><span class="n">normalized_sfr</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">SFR</span><span class="p">,</span> <span class="n">normalized_sfr</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="SFR.sfrt_sj21_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrt_sj21_default">[docs]</a>    <span class="k">def</span> <span class="nf">sfrt_sj21_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thick-disk SFR as defined in Sysoliatina and Just (2021) (:meth:`jjmodel.funcs.SFR.sfrt_sj21`)</span>
<span class="sd">        calculated with best parameters (model MCMC1). </span>
<span class="sd">        </span>
<span class="sd">        :param t: Galactic time, Gyr. </span>
<span class="sd">        :type t: scalar or array-like            </span>
<span class="sd">            </span>
<span class="sd">        :return: Absolute and normalized SFR as a function of **t**, </span>
<span class="sd">            :math:`\mathrm{M_\odot \ pc^{-2} \ Gyr^{-1}}`. Normalization factor </span>
<span class="sd">            is the mean SFR (averaged over the whole time range of the thick-disk evolution). </span>
<span class="sd">        :rtype: list[1d-array] or list[float]  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">4</span> 
        <span class="n">gamma</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">2</span> 
        <span class="n">sigma</span> <span class="o">=</span> <span class="mf">4.9</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrt_sj21</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">gamma</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="SFR.sfrr"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.SFR.sfrr">[docs]</a>    <span class="k">def</span> <span class="nf">sfrr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">gd</span><span class="p">,</span><span class="n">gd0</span><span class="p">,</span><span class="n">gt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin- and thick-disk SFR as functions of Galactocentric distance. </span>
<span class="sd">        </span>
<span class="sd">        :param p: Set of model parameters from the parameter file. </span>
<span class="sd">        :type p: namedtuple</span>
<span class="sd">        :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">        :type a: namedtuple</span>
<span class="sd">        :param gd: Thin-disk mass loss function at a function of ``a.t``, at the different </span>
<span class="sd">            Galactocentric distances ``a.R``.  </span>
<span class="sd">        :type gd: array-like</span>
<span class="sd">        :param gd0: Local thin-disk mass loss function. </span>
<span class="sd">        :param gt: Thick-disk mass loss function corresponding to ``a.t`` or ``a.t[:a.jt]``. </span>
<span class="sd">                Assumed to be the same for all distances ``a.R``. </span>
<span class="sd">        </span>
<span class="sd">        :return: When ``p.pkey=0`` (no extra peaks in the thin-disk SFR), the output has the following structure: </span>
<span class="sd">            *((SFRd,NSFRd,SFRd0,NSFRd0),(SFRt,NSFRt,SFRt0,NSFRt0),(SFRtot,NSFRtot,SFRtot0,NSFRtot0))*. </span>
<span class="sd">            For the thin-disk, thick-disk, and total SFR calculated quantities are absolute and </span>
<span class="sd">            normalized star formation rate at ``a.R`` (array shapes ``(a.Rbins,a.jd)`` or ``(a.Rbins,a.jt)``) </span>
<span class="sd">            and in the Solar neighbourhood. If ``p.pkey=1``, the thin-disk part is </span>
<span class="sd">            *(SFRd,NSFRd,Fp,SFRd0,NSFRd0,Fp0)*, </span>
<span class="sd">            where *Fp* and *Fp0* are the relative contributions of the peaks to the total SFR at each </span>
<span class="sd">            radius and also locally.     </span>
<span class="sd">        :rtype: list[list[1d-array]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">SFRd</span><span class="p">,</span> <span class="n">NSFRd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>        
        <span class="n">SFRt</span><span class="p">,</span> <span class="n">NSFRt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">))</span>        
        <span class="n">SFRtot</span><span class="p">,</span> <span class="n">NSFRtot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>        
        
        <span class="c1"># SFR parameters are power-law functions of R: </span>
        <span class="n">dzeta_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">dzeta</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span><span class="o">**</span><span class="n">p</span><span class="o">.</span><span class="n">k_dzeta</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
        <span class="n">eta_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">eta</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span><span class="o">**</span><span class="n">p</span><span class="o">.</span><span class="n">k_eta</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
        <span class="n">td2_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">td2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span><span class="o">**</span><span class="n">p</span><span class="o">.</span><span class="n">k_td2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
        
        <span class="c1"># Exponential disks: </span>
        <span class="n">sigmad_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">sigmad</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
        <span class="n">sigmat_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">sigmat</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rt</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">SFRd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">NSFRd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrd_sj21</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">dzeta_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">eta_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p</span><span class="o">.</span><span class="n">td1</span><span class="p">,</span>
                                                   <span class="n">td2_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">sigmad_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">g</span><span class="o">=</span><span class="n">gd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                                   <span class="p">)</span>             
            <span class="n">SFRd0</span><span class="p">,</span> <span class="n">NSFRd0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrd_sj21</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dzeta</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">td1</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">td2</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmad</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">gd0</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sigmap_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">sigmap</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">Rp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dRp</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span>\
                            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">Rp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dRp</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>                       
                       
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">SFRd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">NSFRd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fpeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrd_sj21_multipeak</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">tr</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">dzeta_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">eta_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                             <span class="n">p</span><span class="o">.</span><span class="n">td1</span><span class="p">,</span><span class="n">td2_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">sigmad_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                             <span class="n">sigmap_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p</span><span class="o">.</span><span class="n">tpk</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dtp</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">gd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                                             <span class="p">)</span>   
                <span class="n">Fp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpeak</span><span class="p">)</span>
            <span class="n">SFRd0</span><span class="p">,</span> <span class="n">NSFRd0</span><span class="p">,</span> <span class="n">Fp0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrd_sj21_multipeak</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">tr</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dzeta</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">td1</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">td2</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmad</span><span class="p">,</span>
                                                     <span class="n">p</span><span class="o">.</span><span class="n">sigmap</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">tpk</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dtp</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">gd0</span>
                                                     <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">SFRt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">NSFRt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrt_sj21</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">],</span><span class="n">p</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">tt1</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">tt2</span><span class="p">,</span><span class="n">sigmat_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">g</span><span class="o">=</span><span class="n">gt</span><span class="p">)</span>
            
            <span class="n">SFRtot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SFRd</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">],</span><span class="n">SFRt</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">SFRd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">:]),</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">NSFRtot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">SFRtot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SFRtot</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
        
        <span class="n">SFRt0</span><span class="p">,</span> <span class="n">NSFRt0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrt_sj21</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">],</span><span class="n">p</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">tt1</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">tt2</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmat</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">gt</span><span class="p">)</span>
        <span class="n">SFRtot0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SFRd0</span><span class="p">[:</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">],</span><span class="n">SFRt0</span><span class="p">),</span><span class="n">SFRd0</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">:]),</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">NSFRtot0</span> <span class="o">=</span> <span class="n">SFRtot0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SFRtot0</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">SFRd</span><span class="p">,</span><span class="n">NSFRd</span><span class="p">,</span><span class="n">SFRd0</span><span class="p">,</span><span class="n">NSFRd0</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">SFRt</span><span class="p">,</span><span class="n">NSFRt</span><span class="p">,</span><span class="n">SFRt0</span><span class="p">,</span><span class="n">NSFRt0</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">SFRtot</span><span class="p">,</span><span class="n">NSFRtot</span><span class="p">,</span><span class="n">SFRtot0</span><span class="p">,</span><span class="n">NSFRtot0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">SFRd</span><span class="p">,</span><span class="n">NSFRd</span><span class="p">,</span><span class="n">Fp</span><span class="p">,</span><span class="n">SFRd0</span><span class="p">,</span><span class="n">NSFRd0</span><span class="p">,</span><span class="n">Fp0</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">SFRt</span><span class="p">,</span><span class="n">NSFRt</span><span class="p">,</span><span class="n">SFRt0</span><span class="p">,</span><span class="n">NSFRt0</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">SFRtot</span><span class="p">,</span><span class="n">NSFRtot</span><span class="p">,</span><span class="n">SFRtot0</span><span class="p">,</span><span class="n">NSFRtot0</span><span class="p">))</span></div></div>



<div class="viewcode-block" id="IMF"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.IMF">[docs]</a><span class="k">class</span> <span class="nc">IMF</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for defining the initial mass function (IMF).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="IMF.__init__"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.IMF.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mlow</span><span class="p">,</span><span class="n">mup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class instance is initialized by two parameters. </span>
<span class="sd">        </span>
<span class="sd">        :param mlow: Lower limit of the mass range, :math:`\mathrm{M_\odot}`. </span>
<span class="sd">        :type mlow: scalar </span>
<span class="sd">        :param mup: Upper limit of the mass range, :math:`\mathrm{M_\odot}`. </span>
<span class="sd">        :type mup: scalar </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mup</span> <span class="o">=</span> <span class="n">mlow</span><span class="p">,</span> <span class="n">mup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mres</span> <span class="o">=</span> <span class="mf">0.005</span>               <span class="c1"># Msun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="p">,</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">)</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">mres</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span></div>

    
    <span class="k">def</span> <span class="nf">_bpl_4slopes_call_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">ka0</span><span class="p">,</span><span class="n">ka1</span><span class="p">,</span><span class="n">ka2</span><span class="p">,</span><span class="n">ka3</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">):</span>   
        <span class="n">rez</span><span class="o">=</span><span class="mi">0</span>                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlow</span> <span class="o">&lt;=</span> <span class="n">mass</span> <span class="o">&lt;</span> <span class="n">m1</span><span class="p">:</span>
            <span class="n">rez</span> <span class="o">=</span> <span class="n">ka0</span><span class="o">*</span><span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m1</span> <span class="o">&lt;=</span> <span class="n">mass</span> <span class="o">&lt;</span> <span class="n">m2</span><span class="p">:</span>
                <span class="n">rez</span> <span class="o">=</span> <span class="n">ka1</span><span class="o">*</span><span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m2</span> <span class="o">&lt;=</span> <span class="n">mass</span> <span class="o">&lt;</span> <span class="n">m3</span><span class="p">:</span>
                <span class="n">rez</span> <span class="o">=</span> <span class="n">ka2</span><span class="o">*</span><span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m3</span> <span class="o">&lt;=</span> <span class="n">mass</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="p">:</span>
                <span class="n">rez</span> <span class="o">=</span> <span class="n">ka3</span><span class="o">*</span><span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a3</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">rez</span>
    
    
    <span class="k">def</span> <span class="nf">_chabrier03_call_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">ka1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">m1</span><span class="p">):</span>   
        <span class="n">rez</span><span class="o">=</span><span class="mi">0</span>                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlow</span> <span class="o">&lt;=</span> <span class="n">mass</span> <span class="o">&lt;</span> <span class="n">m1</span><span class="p">:</span>
            <span class="n">rez</span> <span class="o">=</span> <span class="mf">0.158</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="n">mass</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.079</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mf">0.69</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rez</span> <span class="o">=</span> <span class="n">ka1</span><span class="o">*</span><span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rez</span>
    
    
    <span class="k">def</span> <span class="nf">_ktg93_3slopes_call_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">ka1</span><span class="p">,</span><span class="n">ka2</span><span class="p">,</span><span class="n">ka3</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">):</span>   
        <span class="n">rez</span><span class="o">=</span><span class="mi">0</span>                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlow</span> <span class="o">&lt;=</span> <span class="n">mass</span> <span class="o">&lt;</span> <span class="n">m1</span><span class="p">:</span>
            <span class="n">rez</span> <span class="o">=</span> <span class="n">ka1</span><span class="o">*</span><span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m1</span> <span class="o">&lt;=</span> <span class="n">mass</span> <span class="o">&lt;</span> <span class="n">m2</span><span class="p">:</span>
                <span class="n">rez</span> <span class="o">=</span> <span class="n">ka2</span><span class="o">*</span><span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m2</span> <span class="o">&lt;=</span> <span class="n">mass</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="p">:</span>
                <span class="n">rez</span> <span class="o">=</span> <span class="n">ka3</span><span class="o">*</span><span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rez</span>
        
    
    <span class="k">def</span> <span class="nf">_dndm_probability_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mass1</span><span class="p">,</span><span class="n">mass2</span><span class="p">,</span><span class="n">Nmdm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the probability of a star to be born with the </span>
<span class="sd">        mass in the given interval. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mass1, mass2 : scalar</span>
<span class="sd">            Mass interval of interest, Msun.  </span>
<span class="sd">        dndm_probability : array_like</span>
<span class="sd">            Full IMF in the form of an array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dndm_probability_m12 : scalar</span>
<span class="sd">            Probability of a star to be born with mass within the </span>
<span class="sd">            given interval [mass1,mass2]. Normalized to unity. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mass1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">:</span>
            <span class="n">mass1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlow</span>
        <span class="k">if</span> <span class="n">mass2</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="p">:</span>
            <span class="n">mass2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mup</span>
        <span class="n">m1_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">mass1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">)</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">mres</span><span class="p">)</span>
        <span class="n">m2_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">mass2</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">)</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">mres</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m1_ind</span><span class="o">==</span><span class="n">m2_ind</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">m2_ind</span> <span class="o">-</span> <span class="n">m1_ind</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">m2_ind</span> <span class="o">=</span> <span class="n">m1_ind</span> <span class="o">+</span> <span class="mi">2</span> 
            <span class="n">weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">mass2</span><span class="o">-</span><span class="n">mass1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">[</span><span class="n">m2_ind</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">[</span><span class="n">m1_ind</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span> 
        <span class="n">dndm_probability_m12</span> <span class="o">=</span> <span class="n">weight</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">dndm_probability_func</span><span class="p">[</span><span class="n">m1_ind</span><span class="p">:</span><span class="n">m2_ind</span><span class="p">],</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">[</span><span class="n">m1_ind</span><span class="p">:</span><span class="n">m2_ind</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dndm_probability_m12</span>
    
    
    <span class="k">def</span> <span class="nf">_number_stars_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mass1</span><span class="p">,</span><span class="n">mass2</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">mass1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">:</span>
            <span class="n">mass1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlow</span>
        <span class="k">if</span> <span class="n">mass2</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="p">:</span>
            <span class="n">mass2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mup</span>
            
        <span class="n">m1_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">mass1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">)</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">mres</span><span class="p">)</span>
        <span class="n">m2_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">mass2</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">)</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">mres</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">m1_ind</span><span class="o">==</span><span class="n">m2_ind</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">m2_ind</span> <span class="o">-</span> <span class="n">m1_ind</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">m2_ind</span> <span class="o">=</span> <span class="n">m1_ind</span> <span class="o">+</span> <span class="mi">2</span> 
            <span class="n">weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">mass2</span><span class="o">-</span><span class="n">mass1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">[</span><span class="n">m2_ind</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">[</span><span class="n">m1_ind</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span> 
        <span class="c1">#cut = np.where(np.logical_and(self.m_lin&gt;=mass1,self.m_lin&lt;mass2))</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nmdm</span><span class="p">[</span><span class="n">m1_ind</span><span class="p">:</span><span class="n">m2_ind</span><span class="p">])</span><span class="o">*</span><span class="n">weight</span>
        <span class="k">return</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    
    
<div class="viewcode-block" id="IMF.number_stars"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.IMF.number_stars">[docs]</a>    <span class="k">def</span> <span class="nf">number_stars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mass1</span><span class="p">,</span><span class="n">mass2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability of a star to have mass in the given interval </span>
<span class="sd">        according to chosen IMF (yes, the method name is misleading, sorry). </span>
<span class="sd">        Should be called after the IMF definition (e.g., :meth:`jjmodel.func.IMF.BPL_4slopes`). </span>
<span class="sd">        </span>
<span class="sd">        :param mass1: Lower mass limit, :math:`\mathrm{M_\odot}`. </span>
<span class="sd">        :type mass1: scalar </span>
<span class="sd">        :param mass2: Upper mass limit, :math:`\mathrm{M_\odot}`. </span>
<span class="sd">        :type mass2: scalar </span>
<span class="sd">        </span>
<span class="sd">        :return: Probability that stellar mass belongs to [**mass1**,**mass2**]. </span>
<span class="sd">        :rtype: scalar </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_stars_</span><span class="p">(</span><span class="n">mass1</span><span class="p">,</span><span class="n">mass2</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="IMF.BPL_4slopes"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.IMF.BPL_4slopes">[docs]</a>    <span class="k">def</span> <span class="nf">BPL_4slopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A four-slope broken power-law (BPL) IMF.</span>
<span class="sd">        </span>
<span class="sd">        :param a0: First IMF slope. </span>
<span class="sd">        :type a0: scalar </span>
<span class="sd">        :param a1: Second IMF slope.  </span>
<span class="sd">        :type a1: scalar </span>
<span class="sd">        :param a2: Third IMF slope.   </span>
<span class="sd">        :type a2: scalar </span>
<span class="sd">        :param a3: Fourth IMF slope. </span>
<span class="sd">        :type a3: scalar </span>
<span class="sd">        :param m1: First break point (slopes **a0**-**a1**), :math:`\mathrm{M_\odot}`.  </span>
<span class="sd">        :type m1: scalar </span>
<span class="sd">        :param m2: Second break point (slopes **a1**-**a2**), :math:`\mathrm{M_\odot}`. </span>
<span class="sd">        :type m2: scalar </span>
<span class="sd">        :param m3: Third break point (slopes **a2**-**a3**), :math:`\mathrm{M_\odot}`. </span>
<span class="sd">        :type m3: scalar         </span>
<span class="sd">        </span>
<span class="sd">        :return: Linear mass grid from **mlow** to **mup** (in :math:`\mathrm{M_\odot}`) and </span>
<span class="sd">                probabilities corresponding to these mass intervals.</span>
<span class="sd">        :rtype: 2d-array</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c1"># if mass2 - mass1 &gt; 3*0.005:</span>
        <span class="c1">#     mres = 0.005</span>
        <span class="c1"># else:</span>
        <span class="c1">#     mres = (mass2-mass1)/3</span>
        <span class="c1">#mres = 0.005</span>
        
        <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a0</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">a0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">term2</span> <span class="o">=</span> <span class="p">(</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">term3</span> <span class="o">=</span> <span class="p">(</span><span class="n">m3</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">term4</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a3</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">m3</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a3</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">a3</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ka0</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="n">term2</span> <span class="o">+</span> 
                 <span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">term3</span> <span class="o">+</span> <span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">m3</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="n">a3</span><span class="p">)</span><span class="o">*</span><span class="n">term4</span><span class="p">)</span> 
        <span class="n">ka1</span> <span class="o">=</span> <span class="n">ka0</span><span class="o">*</span><span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">ka2</span> <span class="o">=</span> <span class="n">ka1</span><span class="o">*</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">ka3</span> <span class="o">=</span> <span class="n">ka2</span><span class="o">*</span><span class="n">m3</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="n">a3</span><span class="p">)</span>
        
        <span class="c1"># frequencies corresponding to masses m_lin</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bpl_4slopes_call_</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ka0</span><span class="p">,</span><span class="n">ka1</span><span class="p">,</span><span class="n">ka2</span><span class="p">,</span><span class="n">ka3</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">]</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nmdm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nmdm</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="IMF.BPL_4slopes_rj15_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.IMF.BPL_4slopes_rj15_default">[docs]</a>    <span class="k">def</span> <span class="nf">BPL_4slopes_rj15_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A four-slope broken power-law (BPL) IMF from Rybizki and Just (2015) and Rybizki (2018) </span>
<span class="sd">        (:meth:`jjmodel.funcs.IMF.BPL_4slopes`)</span>
<span class="sd">        calculated with the best parameters. </span>
<span class="sd">        </span>
<span class="sd">        :return: Linear mass grid from **mlow** to **mup** (in :math:`\mathrm{M_\odot}`) and </span>
<span class="sd">                probabilities corresponding to these mass intervals.</span>
<span class="sd">        :rtype: 2d-array</span>
<span class="sd">        &quot;&quot;&quot;</span>  
        
        <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="mf">1.26</span><span class="p">,</span> <span class="mf">1.49</span><span class="p">,</span> <span class="mf">3.02</span><span class="p">,</span> <span class="mf">2.28</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.39</span><span class="p">,</span> <span class="mi">6</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">BPL_4slopes</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">)</span></div>


<div class="viewcode-block" id="IMF.BPL_4slopes_sj21_default"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.IMF.BPL_4slopes_sj21_default">[docs]</a>    <span class="k">def</span> <span class="nf">BPL_4slopes_sj21_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A four-slope broken power law (BPL) IMF from Sysoliatina and Just (2021) </span>
<span class="sd">        (:meth:`jjmodel.funcs.IMF.BPL_4slopes`) </span>
<span class="sd">        calculated with the best parameters (MCMC1 run). </span>
<span class="sd">        </span>
<span class="sd">        :return: Linear mass grid from **mlow** to **mup** (in :math:`\mathrm{M_\odot}`) and </span>
<span class="sd">                probabilities corresponding to these mass intervals.</span>
<span class="sd">        :rtype: 2d-array</span>
<span class="sd">        &quot;&quot;&quot;</span>  
        
        <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="mf">1.31</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="mf">2.28</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span> <span class="o">=</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">1.43</span><span class="p">,</span> <span class="mi">6</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">BPL_4slopes</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">)</span></div>


<div class="viewcode-block" id="IMF.Chabrier03"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.IMF.Chabrier03">[docs]</a>    <span class="k">def</span> <span class="nf">Chabrier03</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A lognormal + power-law IMF from Chabrier (2003). </span>
<span class="sd">        </span>
<span class="sd">        :return: Linear mass grid from **mlow** to **mup** (in :math:`\mathrm{M_\odot}`) and </span>
<span class="sd">                probabilities corresponding to these mass intervals.</span>
<span class="sd">        :rtype: 2d-array</span>
<span class="sd">        &quot;&quot;&quot;</span>  
        <span class="c1"># if mass2 - mass1 &gt; 3*0.005:</span>
        <span class="c1">#     mres = 0.005</span>
        <span class="c1"># else:</span>
        <span class="c1">#     mres = (mass2-mass1)/5</span>
            
        <span class="n">a1</span> <span class="o">=</span> <span class="mf">2.3</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ka1</span> <span class="o">=</span> <span class="mf">0.158</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="n">m1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.079</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mf">0.69</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="p">)</span>

        <span class="n">m_lin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="p">,</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">)</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">mres</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_chabrier03_call_</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ka1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m_lin</span><span class="p">]</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nmdm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">)</span>
               
        <span class="k">return</span> <span class="p">(</span><span class="n">m_lin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nmdm</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="IMF.KTG93"><a class="viewcode-back" href="../../funcs.html#jjmodel.funcs.IMF.KTG93">[docs]</a>    <span class="k">def</span> <span class="nf">KTG93</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A three-slope broken power law (BPL) IMF from Kroupa et al. (1993).</span>
<span class="sd">        </span>
<span class="sd">        :return: Linear mass grid from **mlow** to **mup** (in :math:`\mathrm{M_\odot}`) and </span>
<span class="sd">                probabilities corresponding to these mass intervals.</span>
<span class="sd">        :rtype: 2d-array</span>
<span class="sd">        &quot;&quot;&quot;</span>  
            
        <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.7</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span>
        
        <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">term2</span> <span class="o">=</span> <span class="p">(</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">term3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a3</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a3</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">a3</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ka1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">term2</span> <span class="o">+</span> <span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="n">a3</span><span class="p">)</span><span class="o">*</span><span class="n">term3</span><span class="p">)</span> 
        <span class="n">ka2</span> <span class="o">=</span> <span class="n">ka1</span><span class="o">*</span><span class="n">m1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">ka3</span> <span class="o">=</span> <span class="n">ka2</span><span class="o">*</span><span class="n">m2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a2</span><span class="o">+</span><span class="n">a3</span><span class="p">)</span> 
        
        <span class="n">m_lin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="p">,</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mup</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mlow</span><span class="p">)</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">mres</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ktg93_3slopes_call_</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ka1</span><span class="p">,</span><span class="n">ka2</span><span class="p">,</span><span class="n">ka3</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m_lin</span><span class="p">]</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nmdm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">m_lin</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">m_lin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nmdm</span><span class="p">)</span></div></div>
    

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">jjmodel</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../funcs.html">Physical functions (input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model_core.html">Radial and vertical MW structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../populations.html">Stellar populations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geometry.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trans.html">Coordinates and velocities (from data)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools.html">Useful tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iof.html">Input/output tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analysis.html">Output analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plotting.html">Plotting tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contacts.html">Authors and contact</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Sysoliatina.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>