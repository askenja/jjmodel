
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>jjmodel.analysis &#8212; jjmodel 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for jjmodel.analysis</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon Feb 20 18:17:18 2017</span>

<span class="sd">@author: Skevja</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erf</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter1d</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">convolve2d</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">fast_histogram</span> <span class="kn">import</span> <span class="n">histogram2d</span>
<span class="kn">from</span> <span class="nn">.control</span> <span class="kn">import</span> <span class="p">(</span><span class="n">CheckIsoInput</span><span class="p">,</span> <span class="n">inpcheck_radius</span><span class="p">,</span> <span class="n">inpcheck_age</span><span class="p">,</span> <span class="n">reduce_kwargs</span><span class="p">,</span>
                     <span class="n">inpcheck_height</span><span class="p">,</span><span class="n">inpcheck_iskwargtype</span><span class="p">,</span><span class="n">inpcheck_kwargs</span><span class="p">,</span><span class="n">inpcheck_mode_comp</span><span class="p">,</span>
                     <span class="n">inpcheck_kwargs_compatibility</span><span class="p">,</span><span class="n">inpcheck_dz</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.iof</span> <span class="kn">import</span> <span class="n">tab_reader</span><span class="p">,</span> <span class="n">hdp_reader</span><span class="p">,</span> <span class="n">tab_sorter</span><span class="p">,</span> <span class="n">TabSaver</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">KM</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">tr</span>
<span class="kn">from</span> <span class="nn">.funcs</span> <span class="kn">import</span> <span class="n">hgr</span><span class="p">,</span> <span class="n">RotCurve</span><span class="p">,</span> <span class="n">RadialPotential</span><span class="p">,</span> <span class="n">AMR</span>
<span class="kn">from</span> <span class="nn">.tools</span> <span class="kn">import</span> <span class="n">rebin_histogram</span><span class="p">,</span> <span class="n">reduce_table</span><span class="p">,</span> <span class="n">_rotation_matrix_</span><span class="p">,</span> <span class="n">gauss_weights</span><span class="p">,</span> <span class="n">convolve2d_gauss</span>
<span class="kn">from</span> <span class="nn">.geometry</span> <span class="kn">import</span> <span class="n">Volume</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># Selection of special populations using stellar parameters &amp; photometry</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="GetPopulations"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations">[docs]</a><span class="k">class</span> <span class="nc">GetPopulations</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for selecting different stellar populations on the  </span>
<span class="sd">    color-magnitude diagram (CMD) and with applying cuts on physical stellar parameters. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="GetPopulations.__init__"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization of the class instance. </span>
<span class="sd">        </span>
<span class="sd">        :param mode_iso: Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        :type mode_iso: str </span>
<span class="sd">        :param R: Galactocentric distance, kpc.</span>
<span class="sd">        :type R: scalar </span>
<span class="sd">        :param p: Set of model parameters from the parameter file. </span>
<span class="sd">        :type p: namedtuple</span>
<span class="sd">        :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">        :type a: namedtuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">CheckIsoInput</span><span class="p">()</span>
        <span class="n">ch</span><span class="o">.</span><span class="n">check_mode_isochrone</span><span class="p">(</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span> <span class="o">=</span> <span class="n">mode_iso</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">inpcheck_radius</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
        
        <span class="n">tab_d</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">),</span><span class="s1">&#39;_d_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span>
        <span class="n">tab_t</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">),</span><span class="s1">&#39;_t_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span>
        <span class="n">tab_sh</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">),</span><span class="s1">&#39;_sh_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="n">tab_d</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="n">tab_t</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span><span class="n">tab_sh</span><span class="p">}</span></div>
        
        
<div class="viewcode-block" id="GetPopulations.custom_population"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.custom_population">[docs]</a>    <span class="k">def</span> <span class="nf">custom_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">column_list</span><span class="p">,</span><span class="n">range_list</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows to select stellar population using custom cuts on the columns</span>
<span class="sd">        of the stellar assemblies table. </span>
<span class="sd">        </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param column_list: List of column names for which the cuts will be applied.</span>
<span class="sd">        :type column_list: list[str]</span>
<span class="sd">        :param range_list: List with ranges of values [*min,max*] corresponding to the columns in **column_list**.</span>
<span class="sd">        :type range_list: list[list] </span>
<span class="sd">        :param save: Optional. If True, the output table is saved (to the output subdirectory ``/pop/tab``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        :param tabname: Name of the population. If not given, the table is saved </span>
<span class="sd">            with the default name &#39;custom_population&#39;.</span>
<span class="sd">        :type tabname: str</span>
<span class="sd">        </span>
<span class="sd">        :return: Selected population.</span>
<span class="sd">        :rtype: astropy table </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;tabname&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span>
                                           <span class="s1">&#39;custom population&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>
        
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">column_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">column_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">colmin</span><span class="p">,</span><span class="n">colmax</span> <span class="o">=</span> <span class="n">range_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">&gt;</span><span class="n">colmin</span><span class="p">,</span><span class="n">tab</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">&lt;</span><span class="n">colmax</span><span class="p">])]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;tabname&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">popname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tabname&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">popname</span> <span class="o">=</span> <span class="s1">&#39;custom_population&#39;</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="n">popname</span><span class="p">)</span>
            <span class="c1">#tabname = tab_sorter(popname,self.p,self.a.T,R=self.R,mode=mode_comp) </span>
            <span class="c1">#tab.write(tabname,overwrite=True)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: &#39;</span><span class="p">,</span><span class="n">popname</span><span class="p">,</span><span class="s1">&#39; sample is empty.&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tab</span> </div>
                                         

<div class="viewcode-block" id="GetPopulations.rc_simple"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.rc_simple">[docs]</a>    <span class="k">def</span> <span class="nf">rc_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects Red Clump (RC) population using simple cuts on </span>
<span class="sd">        *T_eff*, *logg* and *logL*: 4250 K  &lt; *T_eff* &lt; 5250 K &amp;&amp; </span>
<span class="sd">        *logg* &lt; 2.75 &amp;&amp; 1.65 &lt; *logL* &lt; 1.85. </span>
<span class="sd">          </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param save: Optional. If True, the output table is saved (to the output subdirectory ``pop/tab``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        </span>
<span class="sd">        :return: Table of the stellar assemblies which belong to the RC population (contaminatated by HGB stars).</span>
<span class="sd">        :rtype: astropy table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;RC(+HGB) stars&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="o">==</span><span class="s1">&#39;BaSTI&#39;</span><span class="p">:</span>
            <span class="n">rc0</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">4250</span><span class="p">),</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">5250</span><span class="p">),</span>                                 
                                 <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">1.65</span><span class="p">,</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">1.85</span><span class="p">])]</span>                                 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rc0</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">4250</span><span class="p">),</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">5250</span><span class="p">),</span>                                             
                                             <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">1.65</span><span class="p">,</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">1.85</span><span class="p">,</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">2.75</span><span class="p">])]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="c1">#tabname = tab_sorter(&#39;rc+tab&#39;,self.p,self.a.T,R=self.R,mode=mode_comp,mode_pop=&#39;rc+&#39;) </span>
            <span class="c1">#rc0.write(tabname,overwrite=True)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">rc0</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;rc+&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: RC(+RGB) sample is empty.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">rc0</span></div>
    
        
<div class="viewcode-block" id="GetPopulations.rc_clean"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.rc_clean">[docs]</a>    <span class="k">def</span> <span class="nf">rc_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects Red Clump (RC) population in the 3d parameter space *{logT,logg,[Fe/H]}*. </span>
<span class="sd">        This is a cleaner RC selection than the one given by </span>
<span class="sd">        :meth:`jjmodel.analysis.GetPopulations.rc_simple` method. </span>
<span class="sd">        </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param fig: Optional. If True, the selected RC sample is plotted in the 3d-space *{logT,logg,[Fe/H]}*. </span>
<span class="sd">        :type fig: boolean</span>
<span class="sd">        :param close: Optional. If True, the figure is closed after plotting (active only if **fig** is True). </span>
<span class="sd">        :type close: boolean</span>
<span class="sd">        :param save: Optional. If True, the output table (and figure, if plotted) is (are) saved </span>
<span class="sd">            (to the output subdirectory ``pop/tab`` and ``pop/plt``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        </span>
<span class="sd">        :return: Table of the stellar assemblies which belong to the RC population.</span>
<span class="sd">        :rtype: astropy table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;fig&#39;</span><span class="p">,</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;RC stars&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
                    
        <span class="n">rc0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc_simple</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">)</span>
        <span class="n">axis0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="n">theta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
            <span class="c1">#frac_ignore = 0.05 </span>
            <span class="n">ind_ignore</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">dx_large</span><span class="p">,</span> <span class="n">dx_small</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.005</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="n">theta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">dx_large</span><span class="p">,</span> <span class="n">dx_small</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
            <span class="n">theta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">dx_large</span><span class="p">,</span> <span class="n">dx_small</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span>
        
        <span class="c1"># Switch to the normalized axes. </span>
        <span class="n">logtmax</span><span class="p">,</span> <span class="n">logtmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span>
        <span class="n">loggmax</span><span class="p">,</span> <span class="n">loggmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">])</span>
        <span class="n">fehmax</span><span class="p">,</span> <span class="n">fehmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;FeH&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;FeH&#39;</span><span class="p">])</span>
        
        <span class="n">rc_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">logtmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">logtmax</span><span class="o">-</span><span class="n">logtmin</span><span class="p">),</span>
                                              <span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">loggmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">loggmax</span><span class="o">-</span><span class="n">loggmin</span><span class="p">),</span>
                                              <span class="p">(</span><span class="n">rc0</span><span class="p">[</span><span class="s1">&#39;FeH&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">fehmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fehmax</span><span class="o">-</span><span class="n">fehmin</span><span class="p">))]</span>
        
        <span class="c1"># Each (logT,logg,[Fe/H]) vector is rotated around z-axis, such that RC and HGB </span>
        <span class="c1"># stars are better separated in the new X&#39;Z plane. </span>
        <span class="n">rc_list_rotated</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_rotation_matrix_</span><span class="p">(</span><span class="n">axis0</span><span class="p">,</span><span class="n">theta0</span><span class="p">),</span><span class="n">vector</span><span class="p">)</span> <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">rc_list</span><span class="p">]</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # Helpful plot, uncomment if something goes wrong, then try to use this method again.</span>
<span class="sd">        # Shows the pre-selected RC sample in XZ and X&#39;Z planes - before and after rotation. </span>
<span class="sd">        plt.figure()</span>
<span class="sd">        plt.scatter([i[0] for i in rc_list_rotated],</span>
<span class="sd">                    [i[2] for i in rc_list_rotated],s=0.5,c=&#39;b&#39;,label=&#39;Before rotation&#39;)</span>
<span class="sd">        plt.scatter([i[0] for i in rc_list],</span>
<span class="sd">                    [i[2] for i in rc_list],s=0.5,c=&#39;gray&#39;,label=&#39;After rotation&#39;)</span>
<span class="sd">        plt.xlabel(&quot;X or X&#39;&quot;)</span>
<span class="sd">        plt.xlabel(&quot;Z&quot;)</span>
<span class="sd">        plt.legend(loc=1)</span>
<span class="sd">        plt.show()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># Sort the rotated sample by Z-axis ([Fe/H])</span>
        <span class="n">rc_ind</span><span class="p">,</span> <span class="n">rc_compl_ind</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        
        <span class="c1">#rc_list_rotated.sort(key=lambda x: x[2])</span>
        <span class="n">rc_list2</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rc_list_rotated</span><span class="p">]</span>
        
        <span class="c1"># Create Z-grid to slice the sorted sample. Step is smaller for z &gt; 0.9,</span>
        <span class="c1"># because it&#39;s harder to select clean RC there, so finer resolution is needed. </span>
        <span class="n">x_split</span> <span class="o">=</span> <span class="mf">0.9</span>
        <span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x_split</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">x_split</span><span class="o">/</span><span class="n">dx_large</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_split</span><span class="o">+</span><span class="n">dx_small</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">x_split</span><span class="p">)</span><span class="o">/</span><span class="n">dx_small</span><span class="o">+</span><span class="mi">1</span><span class="p">))),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="n">rc_sample</span><span class="p">,</span> <span class="n">rc_compl</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> 
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Select Z-slice</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rc_list2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z_grid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rc_list2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">z_grid</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">z_bin</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rc_list_rotated</span><span class="p">)[</span><span class="n">ind</span><span class="p">])</span>
                <span class="c1"># Sort by X&#39;</span>
                <span class="n">z_bin0</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">z_bin</span><span class="p">]</span>
                <span class="n">indx_original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">z_bin0</span><span class="p">)</span>
                <span class="n">z_bin</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">z_bin0</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">z_bin</span><span class="p">]</span>
                
                <span class="c1"># Calculate the derivative of the sorted sequence. As there is a gap between the RC and</span>
                <span class="c1"># other ginat stars along the X&#39; axis at each Z, there will be a strong peak in the </span>
                <span class="c1"># derivative marking two subsamples&#39; separation. The position of this peak is used </span>
                <span class="c1"># to define RC sample, the rest of stars are stored in a complementary array.  </span>
                <span class="n">xdif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_bin0</span><span class="p">)</span>
                
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                indx = np.arange(len(xdif))</span>
<span class="sd">                plt.figure()</span>
<span class="sd">                plt.plot(indx,xdif,c=&#39;k&#39;)</span>
<span class="sd">                plt.plot(indx[ind_ignore:-ind_ignore],xdif[ind_ignore:-ind_ignore],c=&#39;m&#39;)</span>
<span class="sd">                plt.savefig(&#39;&#39;.join((&#39;z_&#39;,str(z_grid[i]),&#39;-&#39;,str(z_grid[i+1]),&#39;.png&#39;)))</span>
<span class="sd">                plt.close()</span>
<span class="sd">                &#39;&#39;&#39;</span>
                
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
                    <span class="c1">#ind_ignore = int(frac_ignore*len(ind))</span>
                    <span class="n">indbr</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xdif</span><span class="p">[</span><span class="n">ind_ignore</span><span class="p">:</span><span class="o">-</span><span class="n">ind_ignore</span><span class="p">]</span><span class="o">==</span>\
                                      <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xdif</span><span class="p">[</span><span class="n">ind_ignore</span><span class="p">:</span><span class="o">-</span><span class="n">ind_ignore</span><span class="p">]))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ind_ignore</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xdif</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
                        <span class="n">indbr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">indbr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xdif</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xdif</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> 
                       
                <span class="n">rc_sample_rotated</span> <span class="o">=</span> <span class="p">[[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">z_bin</span><span class="p">[</span><span class="n">indbr</span><span class="p">:]]</span>
                <span class="n">rc_compl_rotated</span> <span class="o">=</span> <span class="p">[[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">z_bin</span><span class="p">[:</span><span class="n">indbr</span><span class="p">]]</span>
                <span class="n">rc_ind</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">indx_original</span><span class="p">[</span><span class="n">indbr</span><span class="p">:]])</span>
                <span class="n">rc_compl_ind</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">indx_original</span><span class="p">[:</span><span class="n">indbr</span><span class="p">]])</span>
                
                <span class="c1"># Rotate each vector back to return to X-axis. </span>
                <span class="n">rc_sample_unrotated</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_rotation_matrix_</span><span class="p">(</span><span class="n">axis0</span><span class="p">,</span><span class="o">-</span><span class="n">theta0</span><span class="p">),</span><span class="n">vector</span><span class="p">)</span> <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">rc_sample_rotated</span><span class="p">]</span>
                <span class="n">rc_compl_unrotated</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_rotation_matrix_</span><span class="p">(</span><span class="n">axis0</span><span class="p">,</span><span class="o">-</span><span class="n">theta0</span><span class="p">),</span><span class="n">vector</span><span class="p">)</span> <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">rc_compl_rotated</span><span class="p">]</span>
                <span class="n">rc_sample</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rc_sample_unrotated</span><span class="p">)</span>
                <span class="n">rc_compl</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rc_compl_unrotated</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        
        <span class="n">rc_sample_tab</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
        <span class="n">rc_complm_tab</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rc0</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="n">rc_sample</span><span class="o">!=</span><span class="p">[]:</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            # Un-normalize values and build the output table. </span>
<span class="sd">            rc_sample_logt = np.array([i[0] for i in rc_sample])*(logtmax-logtmin) + logtmin</span>
<span class="sd">            rc_sample_logg = np.array([i[1] for i in rc_sample])*(loggmax-loggmin) + loggmin</span>
<span class="sd">            rc_sample_feh = np.array([i[2] for i in rc_sample])*(fehmax-fehmin) + fehmin</span>
<span class="sd">            </span>
<span class="sd">            rc_ind = [np.where((np.abs(rc0[&#39;logT&#39;]-i)==np.amin(np.abs(rc0[&#39;logT&#39;]-i)))&amp;</span>
<span class="sd">                               (np.abs(rc0[&#39;logg&#39;]-k)==np.amin(np.abs(rc0[&#39;logg&#39;]-k)))&amp;</span>
<span class="sd">                               (np.abs(rc0[&#39;FeH&#39;]-l)==np.amin(np.abs(rc0[&#39;FeH&#39;]-l))))[0][0] for (i,k,l) </span>
<span class="sd">                               in zip(rc_sample_logt,rc_sample_logg,rc_sample_feh)]</span>
<span class="sd">            rc_ind = [np.where(np.abs(rc0[&#39;FeH&#39;]-i)==np.amin(np.abs(rc0[&#39;FeH&#39;]-i)))[0][0] </span>
<span class="sd">                      for i in rc_sample_feh]</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
                <span class="n">rc_sample_tab</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">rc0</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rc_ind</span><span class="p">)]</span>
                <span class="n">rc_complm_tab</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">rc0</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rc_compl_ind</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
                <span class="n">rc_sample_tab</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">rc_complm_tab</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;fig&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            
            <span class="n">ax_orientation</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;d&#39;</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">118</span><span class="p">],</span><span class="s1">&#39;t&#39;</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">105</span><span class="p">],</span><span class="s1">&#39;sh&#39;</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">103</span><span class="p">]}</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">ax_orientation</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">ax_orientation</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>             
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rc_sample</span><span class="p">],</span>
                       <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rc_sample</span><span class="p">],</span>
                       <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rc_sample</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathrm{Selected \ RC \ sample}$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rc_compl</span><span class="p">],</span>
                       <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rc_compl</span><span class="p">],</span>
                       <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rc_compl</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathrm{Complementary \ sample}$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{logT}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm</span><span class="si">{logg}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm{[Fe/H]}$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">lg</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">11</span><span class="p">},</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">lg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">set_sizes</span><span class="p">([</span><span class="mf">6.0</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;$\mathrm{R = }$&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">),</span><span class="s1">&#39;$\mathrm{\ kpc}$&#39;</span><span class="p">)),</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;popplt&#39;</span><span class="p">],</span>
                                   <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;Clean_RC_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">),</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="s1">&#39;.png&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">rc_sample_tab</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;rc&#39;</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">rc_complm_tab</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;rc_compl&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rc_sample_tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: RC sample is empty.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rc_sample_tab</span></div>
            
            
<div class="viewcode-block" id="GetPopulations.a_stars"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.a_stars">[docs]</a>    <span class="k">def</span> <span class="nf">a_stars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects A-type stars using cuts on *T_eff*: 7500 K &lt; *T_eff* &lt; 10000 K.</span>
<span class="sd">        </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param save: Optional. If True, the output table is saved (to the output subdirectory ``pop/tab``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        </span>
<span class="sd">        :return: Table of the stellar assemblies which belong to the A-type stellar population.</span>
<span class="sd">        :rtype: astropy table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;A-type stars&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">7500</span><span class="p">),</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">10000</span><span class="p">)])]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>          
            <span class="c1">#tabname = tab_sorter(&#39;atab&#39;,self.p,self.a.T,R=self.R,mode=mode_comp,mode_pop=&#39;a&#39;) </span>
            <span class="c1">#ast.write(tabname,overwrite=True)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ast</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: A-type stellar sample is empty.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">ast</span></div>
    
    
<div class="viewcode-block" id="GetPopulations.f_stars"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.f_stars">[docs]</a>    <span class="k">def</span> <span class="nf">f_stars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects F-type stars using cuts on *T_eff*: 6000 K &lt; *T_eff* &lt; 7500 K.</span>
<span class="sd">        </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param save: Optional. If True, the output table is saved (to the output subdirectory ``pop/tab``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        </span>
<span class="sd">        :return: Table of the stellar assemblies which belong to the F-type stellar population.</span>
<span class="sd">        :rtype: astropy table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;F stars&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>
        <span class="n">fst</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">6300</span><span class="p">),</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">7500</span><span class="p">)])]</span>
                                         
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>  
            <span class="c1">#tabname = tab_sorter(&#39;ftab&#39;,self.p,self.a.T,R=self.R,mode=mode_comp,mode_pop=&#39;f&#39;) </span>
            <span class="c1">#fst.write(tabname,overwrite=True)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fst</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: F sample is empty.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">fst</span></div>

           
<div class="viewcode-block" id="GetPopulations.g_dwarfs"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.g_dwarfs">[docs]</a>    <span class="k">def</span> <span class="nf">g_dwarfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects G-dwarfs using cuts on *T_eff* and *logg*: 5200 K &lt; *T_eff* &lt; 6000 K &amp;&amp; 4.3 &lt; *logg* &lt; 7.</span>
<span class="sd">         </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param save: Optional. If True, the output table is saved (to the output subdirectory ``pop/tab``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        </span>
<span class="sd">        :return: Table of the stellar assemblies which belong to the G-dwarf population.</span>
<span class="sd">        :rtype: astropy table</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;G dwarfs&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>

        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>    
        <span class="n">gdw</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">5200</span><span class="p">),</span>
                                         <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">6000</span><span class="p">),</span>
                                         <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">,</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">4.3</span><span class="p">])]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>                
            <span class="c1">#tabname = tab_sorter(&#39;gdwtab&#39;,self.p,self.a.T,R=self.R,mode=mode_comp,mode_pop=&#39;gdw&#39;) </span>
            <span class="c1">#gdw.write(tabname,overwrite=True)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">gdw</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;gdw&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdw</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: G-dwarf sample is empty.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">gdw</span></div>
    
    
<div class="viewcode-block" id="GetPopulations.k_dwarfs"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.k_dwarfs">[docs]</a>    <span class="k">def</span> <span class="nf">k_dwarfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects K-dwarfs using cuts on *T_eff* and *logg*: 3700 K &lt; *T_eff* &lt; 5200 K &amp;&amp; 4.3 &lt; *logg* &lt; 7. </span>
<span class="sd">        </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param save: Optional. If True, the output table is saved (to the output subdirectory ``pop/tab``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        </span>
<span class="sd">        :return: Table of the stellar assemblies which belong to the K-dwarf population.</span>
<span class="sd">        :rtype: astropy table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;K dwarfs&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>

        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>
        <span class="n">kdw</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">3700</span><span class="p">),</span>
                                         <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">5200</span><span class="p">),</span>
                                         <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">,</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">4.3</span><span class="p">])]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>  
            <span class="c1">#tabname = tab_sorter(&#39;kdwtab&#39;,self.p,self.a.T,R=self.R,mode=mode_comp,mode_pop=&#39;kdw&#39;) </span>
            <span class="c1">#kdw.write(tabname,overwrite=True)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">kdw</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;kdw&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kdw</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: K-dwarf sample is empty.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">kdw</span> </div>
    
    
<div class="viewcode-block" id="GetPopulations.m_dwarfs"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.m_dwarfs">[docs]</a>    <span class="k">def</span> <span class="nf">m_dwarfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects M-dwarfs using cuts on *T_eff* and *logg*: 2400 K &lt; *T_eff* &lt; 3700 K &amp;&amp; 4 &lt; *logg* &lt; 7. </span>
<span class="sd">        </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param save: Optional. If True, the output table is saved (to the output subdirectory ``pop/tab``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        </span>
<span class="sd">        :return: Table of the stellar assemblies which belong to the M-dwarf population.</span>
<span class="sd">        :rtype: astropy table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;M dwarfs&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>
        <span class="n">mdw</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2400</span><span class="p">),</span>
                                         <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">3700</span><span class="p">),</span>
                                         <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">,</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logg&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">])]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="c1">#tabname = tab_sorter(&#39;mdwtab&#39;,self.p,self.a.T,R=self.R,mode=mode_comp,mode_pop=&#39;mdw&#39;) </span>
            <span class="c1">#mdw.write(tabname,overwrite=True)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">mdw</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;mdw&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdw</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: M-dwarf sample is empty.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">mdw</span>     </div>
    
    <span class="k">def</span> <span class="nf">_rr_lyrae_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Experimental method.</span>
<span class="sd">        Selects RR Lyrae stars. HB stars in the instability strip</span>
<span class="sd">        with pulsation period &lt; 1 day (Marconi et al. 2015). </span>
<span class="sd">        Dy default, these are the fundamental pulsators (RRab </span>
<span class="sd">        stars), but also the first obertone pulsators can be </span>
<span class="sd">        selected (RRc stars). </span>
<span class="sd">            </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode_comp : str</span>
<span class="sd">            &#39;d&#39;, &#39;t&#39; or &#39;sh&#39; (thin disk, thick disk or halo).</span>
<span class="sd">        **kwargs : dict, optional keyord arguments</span>
<span class="sd">            FO   : boolean</span>
<span class="sd">                If True, the first obertone pulsators are selected</span>
<span class="sd">                (RRc stars). </span>
<span class="sd">            save : boolean</span>
<span class="sd">                If True, the RC sample table is saved. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rrl : astropy table</span>
<span class="sd">            Table of the stellar assemblies that belong to the </span>
<span class="sd">            RR Lyrae population.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;RR Lyrae stars&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>
        <span class="c1"># Definition of the instability strip (IS) is uses logZ and logP:</span>
        <span class="n">amr</span> <span class="o">=</span> <span class="n">AMR</span><span class="p">()</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="n">fe2z</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;FeH&#39;</span><span class="p">])</span>
        <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">11.167</span> <span class="o">+</span> <span class="mf">0.822</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.56</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Mf&#39;</span><span class="p">])</span> <span class="o">-</span>\
                          <span class="mf">3.4</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.013</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logZ&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">11.347</span> <span class="o">+</span> <span class="mf">0.860</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.58</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Mf&#39;</span><span class="p">])</span> <span class="o">-</span>\
                          <span class="mf">3.43</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.024</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logZ&#39;</span><span class="p">]</span>
        
        <span class="c1"># Select stars in IS</span>
        <span class="n">rrl</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.080</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.012</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logZ&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">3.957</span><span class="p">,</span>
                                         <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.084</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.012</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logZ&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">3.879</span><span class="p">])]</span>
        <span class="c1"># Stars with pulsation periods &lt; 1 day</span>
        <span class="n">rrl</span> <span class="o">=</span> <span class="n">rrl</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="mi">10</span><span class="o">**</span><span class="n">rrl</span><span class="p">[</span><span class="s1">&#39;logP&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">])]</span>
                                         
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">rrl</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;rrl&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rrl</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: RR Lyrae sample is empty.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">rrl</span>     


<div class="viewcode-block" id="GetPopulations.cepheids_type1"><a class="viewcode-back" href="../../populations.html#jjmodel.analysis.GetPopulations.cepheids_type1">[docs]</a>    <span class="k">def</span> <span class="nf">cepheids_type1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects classical Cepheids. HB stars in the instability strip (IS) with masses</span>
<span class="sd">        in the range 4-20 :math:`\mathrm{M}_\odot`. IS adopted from De Somma et al. (2020)a (mixing length parameter = 1.5,</span>
<span class="sd">        canonical mass-luminosity relation), periods calculated according to De Somma et al. (2020)b.</span>
<span class="sd">        Dy default, these are the fundamental pulsators, but also the first obertone </span>
<span class="sd">        (FO) pulsators can be selected. </span>
<span class="sd">        </span>
<span class="sd">        :param mode_comp: Model component: ``&#39;d&#39;``, ``&#39;t&#39;``, or ``&#39;sh&#39;`` (thin disk, thick disk, or halo).</span>
<span class="sd">        :type mode_comp: str </span>
<span class="sd">        :param FO: Optional. If True, the first obertone pulsators are selected.</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        :param save: Optional. If True, the output table is saved (to the output subdirectory ``pop/tab``).</span>
<span class="sd">        :type save: boolean</span>
<span class="sd">        </span>
<span class="sd">        :return: Table of the stellar assemblies which belong to the Cepheid type I population.</span>
<span class="sd">        :rtype: astropy table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">],</span><span class="s1">&#39;Cepheids type I&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">mode_comp</span><span class="p">]</span>
        <span class="c1"># Definition of the instability strip (IS) is uses logZ and logP:</span>
        <span class="n">amr</span> <span class="o">=</span> <span class="n">AMR</span><span class="p">()</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="n">fe2z</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;FeH&#39;</span><span class="p">])</span>
        <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;FO&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.268</span> <span class="o">-</span> <span class="mf">3.192</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.758</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Mf&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.919</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.595</span> <span class="o">-</span> <span class="mf">3.253</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.621</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Mf&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.804</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span>
        
        <span class="c1"># Select stars in IS</span>
        <span class="n">ceph</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.104</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.023</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">3.667</span><span class="p">,</span>
                                          <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.030</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.018</span><span class="o">*</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;logL&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">3.788</span><span class="p">])]</span>
        <span class="c1"># Stars with 4 &lt; mass/Msun &lt; 20</span>
        <span class="n">ceph</span> <span class="o">=</span> <span class="n">ceph</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">ceph</span><span class="p">[</span><span class="s1">&#39;Mf&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span><span class="n">ceph</span><span class="p">[</span><span class="s1">&#39;Mf&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">])]</span>
                                         
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">poptab_save</span><span class="p">(</span><span class="n">ceph</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_iso</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;ceph&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ceph</span><span class="p">[</span><span class="s1">&#39;logT&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">),</span><span class="s1">&#39;: Cepheid Type I sample is empty.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">ceph</span>     </div></div>





<span class="c1"># =============================================================================</span>
<span class="c1"># Functions not designed for user </span>
<span class="c1"># =============================================================================</span>

<span class="k">def</span> <span class="nf">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates densities of all thin-disk populations at all R and all z. </span>
<span class="sd">    Can work with stellar assemblies table. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">zlow</span><span class="p">,</span><span class="n">zup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
        <span class="n">indz1</span><span class="p">,</span><span class="n">indz2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">zlow</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">zup</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">indz2</span> <span class="o">-</span> <span class="n">indz1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indz1</span><span class="p">,</span><span class="n">indz2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">n</span>
    
    <span class="n">only_local</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">only_local</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Rarray</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]]</span>
            <span class="n">Rindex</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dR</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">Rmin</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dR</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Rarray</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span>
        <span class="n">Rindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="n">Hd0</span><span class="p">,</span><span class="n">Phi0</span><span class="p">,</span><span class="n">AVRd0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hd0&#39;</span><span class="p">,</span><span class="s1">&#39;Phi0&#39;</span><span class="p">,</span><span class="s1">&#39;AVR0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Hd</span><span class="p">,</span><span class="n">Phi</span><span class="p">,</span><span class="n">AVRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hd&#39;</span><span class="p">,</span><span class="s1">&#39;Phi&#39;</span><span class="p">,</span><span class="s1">&#39;AVR&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">Hd0</span><span class="p">,</span><span class="n">Phi0</span><span class="p">,</span><span class="n">AVRd0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hd0&#39;</span><span class="p">,</span><span class="s1">&#39;Phi0&#39;</span><span class="p">,</span><span class="s1">&#39;AVR0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>        
                                                               
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;mode_iso&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">mode_iso</span> <span class="o">=</span> <span class="s1">&#39;Padova&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mode_iso</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">]</span>
                
            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span>
                                   <span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">Rarray</span><span class="p">]</span>  
                <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="n">tab0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tab0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span>
                                  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
                <span class="n">tab0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">tabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]]</span> 
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">tabs</span><span class="p">,</span> <span class="n">tab0</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tabs</span><span class="p">,</span> <span class="n">tab0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;Sigma&#39;</span>
        
        <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">tab0_rd</span> <span class="o">=</span> <span class="n">reduce_table</span><span class="p">(</span><span class="n">tab0</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">tab0_rd</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tabs_rd</span> <span class="o">=</span> <span class="p">[</span><span class="n">reduce_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabs</span><span class="p">]</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabs_rd</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">tab0_rd</span> <span class="o">=</span> <span class="n">reduce_table</span><span class="p">(</span><span class="n">tab0</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
                <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">tab0_rd</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>      
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">SFRd0</span><span class="p">,</span><span class="n">gd0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;SFRd0&#39;</span><span class="p">,</span><span class="s1">&#39;gd0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">SFRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">gd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tr</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">SFRd</span><span class="p">,</span><span class="n">gd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;SFRd&#39;</span><span class="p">,</span><span class="s1">&#39;gd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="p">[</span><span class="n">SFRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">gd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tr</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Rindex</span><span class="p">]</span>

    <span class="c1"># Locally at Rsun.</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">npeak</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">sigp</span><span class="p">,</span> <span class="n">Hdp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">Rarray</span><span class="p">]</span>
            <span class="n">fpr0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subarray</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">subarray</span> <span class="ow">in</span> <span class="n">Fp</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">Fp0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fp0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fp0</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Hdp0</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># If there are extra peaks on the thin-disk SFR, that have special kinematics, </span>
            <span class="c1"># the density profile consists of two terms: standard thin-disk part and peaks. </span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">fp0</span><span class="o">*</span><span class="n">Sigma0</span>
                <span class="n">rho_dp</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fp0</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sigma0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">fp0</span><span class="o">*</span><span class="n">Sigma0</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">rho_dp</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fp0</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sigma0</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hdp0</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)]</span>
            <span class="n">rho_d0_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho_d0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
            <span class="n">rho_dp_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">rho_dp</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]]</span>
                           <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)])</span>
            <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_d0_term</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_dp_term</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Sigma0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Sigma0</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="c1"># All other distances. </span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">),</span><span class="n">nz</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">fpr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">rho_dp</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">fpr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hd</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">rho_dp</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hdp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)]</span>
                <span class="n">rho_d0_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho_d0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVRd</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
                <span class="n">rho_dp_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">rho_dp</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sigp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                                         <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]]</span> 
                                         <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)])</span>
                <span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_d0_term</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_dp_term</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVRd</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hd</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVRd</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]]</span>
    
    <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rho_z0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>                   
            <span class="k">return</span> <span class="p">(</span><span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rho_z</span>


<span class="k">def</span> <span class="nf">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates densities of all thick-disk populations at all R and all z. </span>
<span class="sd">    Can work with stellar assemblies table. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">zlow</span><span class="p">,</span><span class="n">zup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
        <span class="n">indz1</span><span class="p">,</span><span class="n">indz2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">zlow</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">zup</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">indz2</span> <span class="o">-</span> <span class="n">indz1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indz1</span><span class="p">,</span><span class="n">indz2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">n</span>
    
    <span class="n">only_local</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">only_local</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Rarray</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]]</span>
            <span class="n">Rindex</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dR</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">Rmin</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dR</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Rarray</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span>
        <span class="n">Rindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">only_local</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])):</span>
        <span class="n">Ht0</span><span class="p">,</span> <span class="n">AMRt</span><span class="p">,</span> <span class="n">Phi0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Ht0&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">,</span><span class="s1">&#39;Phi0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="n">Ht</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">Sigt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Ht&#39;</span><span class="p">,</span><span class="s1">&#39;Phi&#39;</span><span class="p">,</span><span class="s1">&#39;Sigt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                                                      
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;mode_iso&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">mode_iso</span> <span class="o">=</span> <span class="s1">&#39;Padova&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mode_iso</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
                                   <span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">Rarray</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="n">tab0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tab0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
                <span class="n">tab0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">tabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]]</span> 
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">tabs</span><span class="p">,</span> <span class="n">tab0</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tabs</span><span class="p">,</span> <span class="n">tab0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;Sigma&#39;</span>
        
        <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">tab0_rt</span> <span class="o">=</span> <span class="n">reduce_table</span><span class="p">(</span><span class="n">tab0</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">tab0_rt</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tabs_rt</span> <span class="o">=</span> <span class="p">[</span><span class="n">reduce_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabs</span><span class="p">]</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabs_rt</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">tab0_rt</span> <span class="o">=</span> <span class="n">reduce_table</span><span class="p">(</span><span class="n">tab0</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
                <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">tab0_rt</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>      
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;gt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">SFRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;SFRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="p">[</span><span class="n">SFRt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tr</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Rindex</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">SFRt0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;SFRt0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">SFRt0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tr</span>
            
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="c1"># Locally at Rsun.</span>
        <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">rho0</span> <span class="o">=</span> <span class="n">Sigma0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho0</span> <span class="o">=</span> <span class="n">Sigma0</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Ht0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_z0</span><span class="p">[:,:</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
        
    <span class="c1"># All other distances. </span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">),</span><span class="n">nz</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">rho0</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho0</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Ht</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
                <span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                                             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
    
    <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rho_z0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">rho_z</span><span class="p">,</span><span class="n">rho_z0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rho_z</span>


<span class="k">def</span> <span class="nf">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates densities of stellar halo populations at all R and all z. </span>
<span class="sd">    Can work with stellar assemblies table. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">zlow</span><span class="p">,</span><span class="n">zup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
        <span class="n">indz1</span><span class="p">,</span><span class="n">indz2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">zlow</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">zup</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">indz2</span> <span class="o">-</span> <span class="n">indz1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indz1</span><span class="p">,</span><span class="n">indz2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">n</span>
        
    <span class="n">only_local</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">only_local</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Rarray</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]]</span>
            <span class="n">Rindex</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dR</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">Rmin</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dR</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Rarray</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span>
        <span class="n">Rindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="n">Phi</span><span class="p">,</span> <span class="n">SR</span><span class="p">,</span> <span class="n">Hsh</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Phi&#39;</span><span class="p">,</span><span class="s1">&#39;SR&#39;</span><span class="p">,</span><span class="s1">&#39;Hsh&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="n">Phi0</span><span class="p">,</span> <span class="n">Hsh0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Phi0&#39;</span><span class="p">,</span><span class="s1">&#39;Hsh0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> 
                                            
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;mode_iso&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">mode_iso</span> <span class="o">=</span> <span class="s1">&#39;Padova&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mode_iso</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">Rarray</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="n">tab0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tab0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span>
                                  <span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;mode_pop&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
                <span class="n">tab0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">tabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]]</span> 
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">tabs</span><span class="p">,</span> <span class="n">tab0</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tabs</span><span class="p">,</span> <span class="n">tab0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                            
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;Sigma&#39;</span>
        
        <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">tab0_rsh</span> <span class="o">=</span> <span class="n">reduce_table</span><span class="p">(</span><span class="n">tab0</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">tab0_rsh</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tabs_rsh</span> <span class="o">=</span> <span class="p">[</span><span class="n">reduce_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabs</span><span class="p">]</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabs_rsh</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">tab0_rsh</span> <span class="o">=</span> <span class="n">reduce_table</span><span class="p">(</span><span class="n">tab0</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
                <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">tab0_rsh</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>   
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)):</span>
                <span class="n">Sigma_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>
                <span class="n">Sigma_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">SR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">Sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Sigma_i</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="n">Sigma0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>
            <span class="n">Sigma0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">sigmash</span>
            
    <span class="c1"># Locally at Rsun.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Sigma0</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hsh0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                          <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
    
    <span class="c1"># All other distances. </span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="n">rho_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">),</span><span class="n">nz</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span> 
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">rho0</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho0</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hsh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">rho_sh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Phi</span><span class="p">[</span><span class="n">Rindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]])</span>
            
    <span class="k">if</span> <span class="n">only_local</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rho_sh0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">rho_sh</span><span class="p">,</span> <span class="n">rho_sh0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rho_sh</span>


<span class="k">def</span> <span class="nf">_rhomet_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates thin-disk density of mono-metallicity populations</span>
<span class="sd">    given by mets bins, at distance R. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
    <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">AMR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_indr_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">AMR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">indr</span><span class="p">]</span>
    <span class="n">indt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMR</span><span class="p">,</span><span class="n">mets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indt</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">indt</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rho_z</span>


<span class="k">def</span> <span class="nf">_rhomet_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates thick-disk density of mono-metallicity populations</span>
<span class="sd">    given by mets bins, at distance R. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)</span>
    <span class="n">AMR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">indt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMR</span><span class="p">,</span><span class="n">mets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indt</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">indt</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="n">nage</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rho_z</span>
    

<span class="k">def</span> <span class="nf">_rhomet_sh_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates stellar halo density of mono-metallicity populations</span>
<span class="sd">    given by mets bins, at distance R. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">metmin</span><span class="p">,</span> <span class="n">metmax</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
            <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmin</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmax</span><span class="p">):</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
            <span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_zsh</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">(</span><span class="n">t1</span><span class="p">))</span><span class="o">/</span><span class="n">erf</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>  
    <span class="k">return</span> <span class="n">rho_z</span>


<span class="k">def</span> <span class="nf">_rhometz_d_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates thin-disk density of mono-metallicity populations</span>
<span class="sd">    given by mets bins, in horizontal slice zlim. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
    <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
    <span class="n">AMR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">tables</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="kc">True</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
        <span class="n">indt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMR</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">mets</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indt</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">indt</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">tables</span><span class="p">:</span>
                    <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tables</span><span class="p">:</span>
                    <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rho_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rho_r</span>


<span class="k">def</span> <span class="nf">_rhometz_t_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates thick-disk density of mono-metallicity populations</span>
<span class="sd">    given by mets bins, in horizontal slice zlim. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
    <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
    <span class="n">AMR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">indt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMR</span><span class="p">,</span><span class="n">mets</span><span class="p">)</span>
    
    <span class="n">tables</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="kc">True</span>
        
    <span class="k">if</span> <span class="n">indt</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">indt</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">tables</span><span class="p">:</span>
                    <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tables</span><span class="p">:</span>
                    <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rho_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rho_r</span>
    

<span class="k">def</span> <span class="nf">_rhometz_sh_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates stellar halo density of mono-metallicity populations</span>
<span class="sd">    given by mets bins, in horizontal slice zlim. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
    <span class="n">metmin</span><span class="p">,</span> <span class="n">metmax</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
        <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmin</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmax</span><span class="p">):</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
                <span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
                <span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zsh</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">(</span><span class="n">t1</span><span class="p">))</span><span class="o">/</span><span class="n">erf</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>  
    <span class="k">return</span> <span class="n">rho_r</span>


<span class="k">def</span> <span class="nf">_rhoz_ages_</span><span class="p">(</span><span class="n">rhoz_input</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects vertical density profiles of rhoz_input that correspond </span>
<span class="sd">    to a set of ages given by the indices indt. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indt</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">rhoz_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">indt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">!=-</span><span class="mi">999</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">indt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=-</span><span class="mi">999</span><span class="p">):</span>
                <span class="n">indt1</span><span class="p">,</span> <span class="n">indt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">indt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">indt</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indt1</span><span class="p">,</span><span class="n">indt2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rhoz_input</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i1</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indt_good</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">indt</span><span class="o">!=-</span><span class="mi">999</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">rhoz_input</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">indt</span><span class="p">[</span><span class="n">indt_good</span><span class="p">],:]</span>
    <span class="k">return</span> <span class="n">rho_z</span>


<span class="k">def</span> <span class="nf">_rhor_ages_</span><span class="p">(</span><span class="n">rhor_input</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects radial density profiles of rhoz_input that correspond </span>
<span class="sd">    to a set of ages given by the indices indt. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indt</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">rhor_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">indt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">!=-</span><span class="mi">999</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">indt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=-</span><span class="mi">999</span><span class="p">):</span>
                <span class="n">indt1</span><span class="p">,</span> <span class="n">indt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">indt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">indt</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indt1</span><span class="p">,</span><span class="n">indt2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rhor_input</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i1</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indt_good</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">indt</span><span class="o">!=-</span><span class="mi">999</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">rhor_input</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">indt</span><span class="p">[</span><span class="n">indt_good</span><span class="p">],:]</span>
    <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rho_r</span>


<span class="k">def</span> <span class="nf">_ind_amr2t_</span><span class="p">(</span><span class="n">amr_array</span><span class="p">,</span><span class="n">mets</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns time-indices corresponding to the given set of </span>
<span class="sd">    metallicities mets using the age-metallicity relation amr_array. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metmin</span><span class="p">,</span> <span class="n">metmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">amr_array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">amr_array</span><span class="p">)</span>
    <span class="n">indt</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">metmin</span><span class="o">&lt;=</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmax</span><span class="p">):</span>
            <span class="n">indt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amr_array</span><span class="o">-</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amr_array</span><span class="o">-</span><span class="n">mets</span><span class="p">[</span><span class="n">i</span><span class="p">])))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">)</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            if (mets[i]&gt;metmax) and (mets[i-1]&lt;metmax):</span>
<span class="sd">                indt.append(len(amr_array)-1)</span>
<span class="sd">            else:</span>
<span class="sd">                indt.append(-999)</span>
<span class="sd">            &#39;&#39;&#39;</span>
    <span class="n">indt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indt</span>


<span class="k">def</span> <span class="nf">_meanq_d_</span><span class="p">(</span><span class="n">indr</span><span class="p">,</span><span class="n">indz</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">tab</span><span class="p">,</span><span class="n">Fi</span><span class="p">,</span><span class="n">Hd</span><span class="p">,</span><span class="n">AVR</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean number density of thin-disk populations given by indt</span>
<span class="sd">    indices at R,z given by indr and indz indices. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">weight1</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fp0&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.5</span><span class="o">/</span><span class="n">Hd</span><span class="p">[</span><span class="n">indr</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVR</span><span class="p">[</span><span class="n">indr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">weights2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Fp&#39;</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.5</span><span class="o">/</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Hdp&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">*</span>\
                             <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sigp&#39;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                             <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;npeak&#39;</span><span class="p">])])</span>                    
        <span class="n">Nz_term1</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">weight1</span><span class="p">[</span><span class="n">indt</span><span class="p">]</span>
        <span class="n">Nz_term2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">weights2</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">indt</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;npeak&#39;</span><span class="p">])])</span>
        <span class="n">Nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Nz_term1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_term2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">Nz_term1</span><span class="p">,</span> <span class="n">Nz_term2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">Hd</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indt</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVR</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indt</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Nz</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">weight</span><span class="p">[</span><span class="n">indt</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Nz</span>
    
    
<span class="k">def</span> <span class="nf">_meanq_t_</span><span class="p">(</span><span class="n">indr</span><span class="p">,</span><span class="n">indz</span><span class="p">,</span><span class="n">tab</span><span class="p">,</span><span class="n">Fi</span><span class="p">,</span><span class="n">Ht</span><span class="p">,</span><span class="n">Sigt</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean number density of thick-disk populations at R,z given </span>
<span class="sd">    by indr and indz indices. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">Ht</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indr</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indr</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">weight</span>
    <span class="k">return</span> <span class="n">Nz</span>


<span class="k">def</span> <span class="nf">_meanq_sh_</span><span class="p">(</span><span class="n">indr</span><span class="p">,</span><span class="n">indz</span><span class="p">,</span><span class="n">tab</span><span class="p">,</span><span class="n">Fi</span><span class="p">,</span><span class="n">Hsh</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean number density of halo populations at R,z given </span>
<span class="sd">    by indr and indz indices. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">Hsh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indr</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">weight</span>
    <span class="k">return</span> <span class="n">Nz</span>


<span class="k">def</span> <span class="nf">_fw_hist_d_</span><span class="p">(</span><span class="n">N_d</span><span class="p">,</span><span class="n">sig_d</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns thin-disk |W|-velocity distribution given the number</span>
<span class="sd">    densities of populations N_d and their velocity dispersions</span>
<span class="sd">    sig_d. </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="n">sq2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fw_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wgrid</span><span class="p">)))</span>
    
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">N_d0_term</span><span class="p">,</span> <span class="n">N_dp_term</span> <span class="o">=</span> <span class="n">N_d</span>
        <span class="n">AVR</span><span class="p">,</span> <span class="n">sigp</span> <span class="o">=</span> <span class="n">sig_d</span>
        <span class="n">npeak</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">N_d</span><span class="p">,</span> <span class="n">AVR</span> <span class="o">=</span> <span class="n">N_d</span><span class="p">,</span> <span class="n">sig_d</span>
    <span class="k">if</span> <span class="s1">&#39;indt&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">AVR</span> <span class="o">=</span> <span class="n">AVR</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">N_d0_term</span> <span class="o">=</span> <span class="n">N_d0_term</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]]</span>
            <span class="n">N_dp_term</span> <span class="o">=</span> <span class="p">[</span><span class="n">subtable</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">subtable</span> <span class="ow">in</span> <span class="n">N_dp_term</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N_d</span> <span class="o">=</span> <span class="n">N_d</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]]</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wgrid</span><span class="p">)):</span>
        <span class="n">wi</span> <span class="o">=</span> <span class="n">wgrid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">term0</span> <span class="o">=</span> <span class="n">N_d0_term</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">((</span><span class="n">wi</span><span class="o">+</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">AVR</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">((</span><span class="n">wi</span><span class="o">-</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">AVR</span><span class="p">))</span>
            <span class="n">termp</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">N_dp_term</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">((</span><span class="n">wi</span><span class="o">+</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">sigp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">-</span><span class="n">erf</span><span class="p">((</span><span class="n">wi</span><span class="o">-</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">sigp</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)]</span>
            <span class="n">fw_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">term0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">termp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fw_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">N_d</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">((</span><span class="n">wi</span><span class="o">+</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">AVR</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">((</span><span class="n">wi</span><span class="o">-</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">AVR</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">fw_hist</span>
        

<span class="k">def</span> <span class="nf">_fw_hist_t_</span><span class="p">(</span><span class="n">N_t</span><span class="p">,</span><span class="n">sig_t</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns thick-disk |W|-velocity distribution given the number</span>
<span class="sd">    densities of populations N_t and their velocity dispersion</span>
<span class="sd">    sig_t. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sq2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fw_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wgrid</span><span class="p">)))</span>
    <span class="k">if</span> <span class="s1">&#39;indt&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">N_t</span> <span class="o">=</span> <span class="n">N_t</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wgrid</span><span class="p">)):</span>
        <span class="n">fw_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">N_t</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">sig_t</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">sig_t</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">fw_hist</span>
             
    
<span class="k">def</span> <span class="nf">_fw_hist_sh_</span><span class="p">(</span><span class="n">N_sh</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns halo |W|-velocity distribution given the number</span>
<span class="sd">    densities of populations N_sh.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sq2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fw_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wgrid</span><span class="p">)))</span>
    <span class="k">if</span> <span class="s1">&#39;indt&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">N_sh</span> <span class="o">=</span> <span class="n">N_sh</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]]</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wgrid</span><span class="p">)):</span>
        <span class="n">fw_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">N_sh</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sq2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="p">)))</span> 
    <span class="k">return</span> <span class="n">fw_hist</span>
           

<span class="k">def</span> <span class="nf">_fw_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thin-disk |W|-velocity distribution at R in slice zlim. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">AVR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AVR0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_indr_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">AVR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AVR&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">indr</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">Nz_d</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Nz_d</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">N_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_d</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs_calc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">AMR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AMR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">indr</span><span class="p">]</span>
        <span class="n">inddt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMR</span><span class="p">,</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">inddt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">and</span> <span class="n">inddt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=-</span><span class="mi">999</span><span class="p">:</span>
            <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inddt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metmin</span><span class="p">,</span><span class="n">metmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">AMR</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">AMR</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmin</span> <span class="ow">and</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmin</span><span class="p">)</span> <span class="ow">or</span> 
                <span class="p">(</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmax</span> <span class="ow">and</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmax</span><span class="p">)):</span>
                <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">inddt</span>
                <span class="k">if</span> <span class="n">inddt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==-</span><span class="mi">999</span><span class="p">:</span>
                    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">inddt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==-</span><span class="mi">999</span><span class="p">:</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> 
                <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">sigp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">sigp</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sigp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>                
        <span class="n">fp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fp</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">N_d0_term</span> <span class="o">=</span> <span class="n">N_d</span><span class="o">*</span><span class="n">fp</span>
        <span class="n">N_dp_term</span> <span class="o">=</span> <span class="p">[</span><span class="n">N_d</span><span class="o">*</span><span class="n">subtable</span> <span class="k">for</span> <span class="n">subtable</span> <span class="ow">in</span> <span class="n">Fp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="n">fwhist_d</span> <span class="o">=</span> <span class="n">_fw_hist_d_</span><span class="p">([</span><span class="n">N_d0_term</span><span class="p">,</span><span class="n">N_dp_term</span><span class="p">],[</span><span class="n">AVR</span><span class="p">,</span><span class="n">sigp</span><span class="p">],</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fwhist_d</span> <span class="o">=</span> <span class="n">_fw_hist_d_</span><span class="p">(</span><span class="n">N_d</span><span class="p">,</span><span class="n">AVR</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fwhist_d</span>


<span class="k">def</span> <span class="nf">_fw_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thick-disk |W|-velocity distribution at R in slice zlim. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs_calc</span><span class="p">:</span>
        <span class="n">AMR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">indtt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMR</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">indtt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">and</span> <span class="n">indtt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=-</span><span class="mi">999</span><span class="p">:</span>
            <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indtt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metmin</span><span class="p">,</span><span class="n">metmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">AMR</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">AMR</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmin</span> <span class="ow">and</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmin</span><span class="p">)</span> <span class="ow">or</span> 
                <span class="p">(</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmax</span> <span class="ow">and</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmax</span><span class="p">)):</span>
                <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">indtt</span>
                <span class="k">if</span> <span class="n">indtt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==-</span><span class="mi">999</span><span class="p">:</span>
                    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">indtt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==-</span><span class="mi">999</span><span class="p">:</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">jt</span>
                <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">Nz_t</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Nz_t</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">N_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_t</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">Sigt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">sigt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_indr_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Sigt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Sigt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">indr</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">fwhist_t</span> <span class="o">=</span> <span class="n">_fw_hist_t_</span><span class="p">(</span><span class="n">N_t</span><span class="p">,</span><span class="n">Sigt</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fwhist_t</span>


<span class="k">def</span> <span class="nf">_fw_sh_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Halo |W|-velocity distribution at R in slice zlim. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">Nz_sh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Nz_sh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">N_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_sh</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs_calc</span><span class="p">:</span>
        <span class="n">metmin</span><span class="p">,</span> <span class="n">metmax</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmin</span> <span class="ow">and</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmin</span><span class="p">)</span> <span class="ow">or</span> 
            <span class="p">(</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmax</span> <span class="ow">and</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmax</span><span class="p">)):</span>
            <span class="n">fwhist_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">wgrid</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
            <span class="k">if</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">metmin</span><span class="p">:</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">metmax</span><span class="p">:</span>
                <span class="n">t2</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  
            <span class="n">Nw_sh</span> <span class="o">=</span> <span class="n">N_sh</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">(</span><span class="n">t1</span><span class="p">))</span><span class="o">/</span><span class="n">erf</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">fwhist_sh</span> <span class="o">=</span> <span class="n">_fw_hist_sh_</span><span class="p">(</span><span class="n">Nw_sh</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>         
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fwhist_sh</span> <span class="o">=</span> <span class="n">_fw_hist_sh_</span><span class="p">(</span><span class="n">N_sh</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fwhist_sh</span>


<span class="k">def</span> <span class="nf">_extend_mag_</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">tab</span><span class="p">,</span><span class="n">bands</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenates photometric lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">mag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">mag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">mag</span>


<span class="k">def</span> <span class="nf">_indr_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">Rmin</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">dR</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">Rmax</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">dR</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">indr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R_edges</span> <span class="o">-</span> <span class="n">R</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">indr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;R value is outside of the [Rmin,Rmax] interval.&#39;</span><span class="p">)</span>
    


<span class="c1"># =============================================================================</span>
<span class="c1"># Functions that calculate quantities of interest</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="rhoz_monoage"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.rhoz_monoage">[docs]</a><span class="k">def</span> <span class="nf">rhoz_monoage</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">ages</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vertical profiles of the mono-age subpopulations calculated at a given Galactocentric distance.</span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param R: Galactocentric distance, kpc. </span>
<span class="sd">    :type R: scalar </span>
<span class="sd">    :param ages: Set of age bins, Gyr. </span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.rhoz_monoage_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param between: Optional. If True, the output quantity corresponds to the age intervals </span>
<span class="sd">        specified by parameter **ages**. Otherwise the individual single mono-age subpopulations </span>
<span class="sd">        are returned (i.e., age-bins of width ``tr``, model age resolution).</span>
<span class="sd">    :type between: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;dt&#39;``, **tab** must be organized as a list of tables for the thin and thick disk: </span>
<span class="sd">        [*table_d,table_t*]. If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [*table_d,table_t,table_sh*]. </span>
<span class="sd">    :type tab: astropy table or list[astropy table] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is the spatial number density of stars in :math:`\mathrm{number \ pc^{-3}}`,</span>
<span class="sd">         not matter density in :math:`\mathrm{M_\odot \ pc^{-3}}`. Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">    </span>
<span class="sd">    :return: Array of the shape ``(len(ages),a.n)`` with the densities of the selected mono-age subpopulations </span>
<span class="sd">        in :math:`\mathrm{M_\odot \ pc^{-3}}` or :math:`\mathrm{number \ pc^{-3}}`. </span>
<span class="sd">        Use together with the model vertical grid ``a.z``. </span>
<span class="sd">    :rtype: 2d-array        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;vertical mono-age profiles&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">inpcheck_radius</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ages</span> <span class="o">=</span> <span class="n">inpcheck_age</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">indt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">ages</span><span class="p">)</span><span class="o">//</span><span class="n">tr</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tabd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zsh</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">rhod</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rhot</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhod</span><span class="p">,</span><span class="n">rhot</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">)</span>
                <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabsh</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabsh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
        <span class="n">rhod</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rhot</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rhosh</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rho_zsh</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhod</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhot</span><span class="p">,</span><span class="n">rhosh</span><span class="p">))</span>
        
    <span class="n">rho_z</span><span class="p">[</span><span class="n">rho_z</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">rhoz_monoage_save</span><span class="p">(</span><span class="n">rho_z</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">ages</span><span class="p">)</span>
         
    <span class="k">return</span> <span class="n">rho_z</span></div>


<div class="viewcode-block" id="rhoz_monomet"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.rhoz_monomet">[docs]</a><span class="k">def</span> <span class="nf">rhoz_monomet</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vertical profiles of the mono-metallicity subpopulations calculated at a given Galactocentric distance.</span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param R: Galactocentric distance, kpc.</span>
<span class="sd">    :type R: scalar </span>
<span class="sd">    :param mets: Set of metallicity bins.</span>
<span class="sd">    :type mets: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.rhoz_monomet_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;dt&#39;``, **tab** must be organized as a list of tables for the thin and thick disk: </span>
<span class="sd">        [*table_d,table_t*]. If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [*table_d,table_t,table_sh*]. </span>
<span class="sd">    :type tab: astropy table or list[astropy table] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is the spatial number density of stars in :math:`\mathrm{number \ pc^{-3}}`,</span>
<span class="sd">         not matter density in :math:`\mathrm{M_\odot \ pc^{-3}}`. Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">       </span>
<span class="sd">    :return: Array of the shape ``(len(ages),a.n)`` with the densities of the selected mono-metallicity </span>
<span class="sd">        subpopulations, in :math:`\mathrm{M_\odot \ pc^{-3}}` or :math:`\mathrm{number \ pc^{-3}}`. </span>
<span class="sd">        Each profile corresponds to the model vertical grid ``a.z``.         </span>
<span class="sd">    :rtype: 2d-array  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;vertical mono-metallicity profiles&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>   
        <span class="n">R</span> <span class="o">=</span> <span class="n">inpcheck_radius</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tabd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhomet_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhomet_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhomet_sh_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhomet_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhomet_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tabd</span><span class="o">=</span><span class="n">tabt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhomet_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhomet_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">,</span><span class="n">rho_zt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhomet_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhomet_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">)</span>
            <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhomet_sh_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabsh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhomet_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhomet_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhomet_sh_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">,</span><span class="n">rho_zsh</span><span class="p">))</span>
    <span class="n">rho_z</span><span class="p">[</span><span class="n">rho_z</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                  
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">rhoz_monomet_save</span><span class="p">(</span><span class="n">rho_z</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">mets</span><span class="p">)</span>
         
    <span class="k">return</span> <span class="n">rho_z</span></div>


<div class="viewcode-block" id="agez"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.agez">[docs]</a><span class="k">def</span> <span class="nf">agez</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Age as a function of distance from the Galactic plane calculated at the different radii. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param R: Optional. Galactocentric distance, kpc. Required when parameter **tab** is specified. </span>
<span class="sd">        If not given, age profiles will be calculated for the whole range of modeled radii ``a.R``. </span>
<span class="sd">    :type R: scalar</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.agez_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. If a single Galactocentric distance is modeled with parameter **R**, </span>
<span class="sd">        then *tab* is constructed as [*table_d,table_t,table_sh*] with tables for this radius. </span>
<span class="sd">    :type tab: astropy table or list[astropy table], or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not by matter density in (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: Usually, the output is a list of two arrays:</span>
<span class="sd">        </span>
<span class="sd">        - Age as a function of height z at the different Galactocentric distances ``a.R``. Array shape is ``(a.Rbins,a.n)`` (by default) or ``(a.n)`` (if parameter **R** is given). The profiles has to be used with z-grid ``a.z``. </span>
<span class="sd">        - The same, but for the Solar radius, array of shape ``(a.n)``. </span>
<span class="sd">        </span>
<span class="sd">        If the optional parameter **R** is given and equals to ``p.Rsun``, the output only contains the local vertical age profile. </span>
<span class="sd">        </span>
<span class="sd">    :rtype: [2d-array, 1d-array] or [1d-array, 1d-array], or 1d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;vertical age profiles&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">tabd0</span><span class="p">,</span> <span class="n">tabt0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="n">tabsh0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tabd</span><span class="p">,</span> <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">tabd0</span><span class="p">,</span> <span class="n">tabt0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="n">tabsh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">tabsh0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>    
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">age_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)])</span>
        <span class="n">age_z0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
                <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
                <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="n">age_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="n">age_z0</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="n">age_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">age_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>    
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">age_z0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">age_z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
                      
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd0</span><span class="p">)</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd</span><span class="p">,</span> <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabd</span><span class="p">,</span><span class="n">tabd0</span><span class="p">])</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabt</span><span class="p">,</span><span class="n">tabt0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span><span class="p">,</span> <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">age_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span>\
                              <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)])</span>
        <span class="n">age_z0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zd0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>\
                    <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zd0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd0</span><span class="p">)</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt0</span><span class="p">)</span>
                <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabsh0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd</span><span class="p">,</span> <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabd</span><span class="p">,</span><span class="n">tabd0</span><span class="p">])</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabt</span><span class="p">,</span><span class="n">tabt0</span><span class="p">])</span>
                <span class="n">rho_zsh</span><span class="p">,</span> <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabsh</span><span class="p">,</span><span class="n">tabsh0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span><span class="p">,</span> <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zsh</span><span class="p">,</span> <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">age_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zsh</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span>\
                          <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zsh</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span> 
                          <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)])</span>
        <span class="n">age_z0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zd0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_zsh0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>\
                  <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zd0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zsh0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">age_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">age_z0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
        <span class="n">age_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">age_z</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">agez_save</span><span class="p">(</span><span class="n">age_z0</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">agez_save</span><span class="p">((</span><span class="n">age_z</span><span class="p">,</span><span class="n">age_z0</span><span class="p">),</span><span class="n">mode_comp</span><span class="p">)</span>
                    
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">age_z0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">age_z</span><span class="p">,</span><span class="n">age_z0</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="ager"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.ager">[docs]</a><span class="k">def</span> <span class="nf">ager</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Age as a function of Galactocentric distance. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights to be considered [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.ager_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. </span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not by matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">        </span>
<span class="sd">    :return: Radial age profile, array of length ``a.Rbins``. </span>
<span class="sd">    :rtype: 1d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;radial age profile&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">age_r</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)]</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="n">rho_r</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_r</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">age_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
        <span class="n">age_r</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">age_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">age_r</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>\
                 <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)]</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rsh</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">age_r</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">t</span><span class="o">*</span><span class="n">rho_rsh</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>\
                 <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rsh</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> 
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)]</span>
            
    <span class="n">age_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">age_r</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">ager_save</span><span class="p">(</span><span class="n">age_r</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>
                                                                                
    <span class="k">return</span> <span class="n">age_r</span></div>


<div class="viewcode-block" id="metz"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.metz">[docs]</a><span class="k">def</span> <span class="nf">metz</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metallicity as a function of distance from the Galactic plane. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param R: Optional. Galactocentric distance, kpc. Required when parameter **tab** is specified. </span>
<span class="sd">        If not given, age profiles will be calculated for the whole range of modeled radii ``a.R``. </span>
<span class="sd">    :type R: scalar</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.metz_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. If a single Galactocentric distance is modeled with parameter **R**, </span>
<span class="sd">        then *tab* is constructed as [*table_d,table_t,table_sh*] with tables for this radius. </span>
<span class="sd">    :type tab: astropy table or list[astropy table], or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not by matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">   </span>
<span class="sd">    :return: Usually, the output is a list of two arrays:</span>
<span class="sd">        </span>
<span class="sd">        - Metallicity as a function of height at the different Galactocentric distances ``a.R``. Array shape is ``(a.Rbins,a.n)`` (by default) or ``(a.n)`` (if parameter **R** is given). The profiles has to be used with z-grid ``a.z``. </span>
<span class="sd">        - The same, but for the Solar radius, array of shape ``(a.n)``. </span>
<span class="sd">        </span>
<span class="sd">        If the optional parameter **R** is given and equals to ``p.Rsun``, the output only contains the local metallicity profile. </span>
<span class="sd">        </span>
<span class="sd">    :rtype: [2d-array, 1d-array] or [1d-array, 1d-array], or 1d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;vertical metallicity profiles&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">AMRd0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AMRd</span><span class="p">,</span><span class="n">AMRd0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">,</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">feh_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)])</span>
        <span class="n">feh_z0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>     
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">feh_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">feh_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">feh_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="n">feh_z0</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">feh_z0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">feh_z</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_z</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">feh_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">feh_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">feh_z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="n">feh_z0</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
              <span class="n">feh_z0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">feh_z</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span>
                          
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="n">AMRd0</span><span class="p">,</span><span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="n">AMRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd</span><span class="p">,</span> <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span><span class="p">,</span> <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">feh_z0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_zd0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>\
                    <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zd0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="n">feh_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span>\
                              <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)])</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">AMRd0</span><span class="p">,</span><span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="n">AMRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd</span><span class="p">,</span> <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">rho_zsh</span><span class="p">,</span> <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd</span><span class="p">,</span> <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zsh</span><span class="p">,</span> <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zd0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">feh_z0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_zd0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">*</span><span class="n">rho_zsh0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>\
                    <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zd0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zsh0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="n">feh_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span>  
                                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">*</span><span class="n">rho_zsh</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span>\
                              <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zsh</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]))</span> 
                              <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)])</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">metz_save</span><span class="p">(</span><span class="n">feh_z0</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">metz_save</span><span class="p">((</span><span class="n">feh_z</span><span class="p">,</span><span class="n">feh_z0</span><span class="p">),</span><span class="n">mode_comp</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">feh_z0</span>
    <span class="k">else</span><span class="p">:</span>      
        <span class="k">return</span> <span class="p">(</span><span class="n">feh_z</span><span class="p">,</span><span class="n">feh_z0</span><span class="p">)</span></div>
    
                                                                     
<div class="viewcode-block" id="metr"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.metr">[docs]</a><span class="k">def</span> <span class="nf">metr</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metallicity as a function of Galactocentric distance. </span>
<span class="sd">            </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights to be considered [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.metr_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. </span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not by matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">        </span>
<span class="sd">    :return: Radial metallicity profile, array of length ``a.Rbins``. </span>
<span class="sd">    :rtype: 1d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;radial metallicity profiles&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">AMRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">feh_r</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)]</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">feh_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
        <span class="n">feh_r</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">feh_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">feh_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
        <span class="n">feh_r</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">feh_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="n">AMRd</span><span class="p">,</span><span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">feh_r</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>\
                 <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)]</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">AMRd</span><span class="p">,</span><span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">jt</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rsh</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">feh_r</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AMRt</span><span class="o">*</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">*</span><span class="n">rho_rsh</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>\
                 <span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rsh</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> 
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)]</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">metr_save</span><span class="p">(</span><span class="n">feh_r</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>
                                                                                
    <span class="k">return</span> <span class="n">feh_r</span></div>
                                                

<div class="viewcode-block" id="rhor"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.rhor">[docs]</a><span class="k">def</span> <span class="nf">rhor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Radial density profiles of the Galactic components. </span>
<span class="sd">    </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param sigma: Optional. If True, the result is surface density in :math:`\mathrm{M_\odot \ pc^{-2}}`, </span>
<span class="sd">        otherwise the midplane mass density in :math:`\mathrm{M_\odot \ pc^{-3}}` is calculated. </span>
<span class="sd">    :type sigma: boolean</span>
<span class="sd">    </span>
<span class="sd">    :return: The output consists of two quantities: </span>
<span class="sd">        </span>
<span class="sd">        - The midplane mass density (or surface density up to ``p.zmax``) as a function of Galactocentric distance. Array shape is ``(6,a.Rbins)``, columns correspond to the different model components in the following order: thin disk, molecular gas, atomic gas, thick disk, stellar halo, and DM halo. </span>
<span class="sd">        - The same, but at for the Solar radius ``p.Rsun``, array of length ``(6)``. </span>
<span class="sd">        </span>
<span class="sd">    :rtype: [2d-array, 1d-array]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;sigma&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">SR</span><span class="p">,</span><span class="n">Hdeff</span><span class="p">,</span><span class="n">Ht</span><span class="p">,</span><span class="n">Hdh</span><span class="p">,</span><span class="n">Hsh</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;SR&#39;</span><span class="p">,</span><span class="s1">&#39;Heffd&#39;</span><span class="p">,</span><span class="s1">&#39;Ht&#39;</span><span class="p">,</span><span class="s1">&#39;Hdh&#39;</span><span class="p">,</span><span class="s1">&#39;Hsh&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">(</span><span class="n">hg1</span><span class="p">,</span><span class="n">hg10</span><span class="p">),(</span><span class="n">hg2</span><span class="p">,</span><span class="n">hg20</span><span class="p">)</span> <span class="o">=</span> <span class="n">hgr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">SR</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">rho_r0</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">sigmad</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmag1</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmag2</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmat</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmadh</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmash</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rho_rd</span> <span class="o">=</span> <span class="p">[</span><span class="n">SR</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hdeff</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R_array</span><span class="p">]</span>  
        <span class="n">rho_g1</span> <span class="o">=</span> <span class="p">[</span><span class="n">SR</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">hg1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R_array</span><span class="p">]</span>  
        <span class="n">rho_g2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SR</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">hg2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R_array</span><span class="p">]</span> 
        <span class="n">rho_rt</span> <span class="o">=</span> <span class="p">[</span><span class="n">SR</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Ht</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R_array</span><span class="p">]</span>  
        <span class="n">rho_dh</span> <span class="o">=</span> <span class="p">[</span><span class="n">SR</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hdh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R_array</span><span class="p">]</span> 
        <span class="n">rho_sh</span> <span class="o">=</span> <span class="p">[</span><span class="n">SR</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hsh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R_array</span><span class="p">]</span> 
        <span class="n">Hdeff0</span><span class="p">,</span><span class="n">Ht0</span><span class="p">,</span><span class="n">Hdh0</span><span class="p">,</span><span class="n">Hsh0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Heffd0&#39;</span><span class="p">,</span><span class="s1">&#39;Ht0&#39;</span><span class="p">,</span><span class="s1">&#39;Hdh0&#39;</span><span class="p">,</span><span class="s1">&#39;Hsh0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">rho_r0</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">sigmad</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hdeff0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p</span><span class="o">.</span><span class="n">sigmag1</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">hg10</span><span class="p">,</span>
                  <span class="n">p</span><span class="o">.</span><span class="n">sigmag2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">hg20</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">sigmat</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Ht0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">p</span><span class="o">.</span><span class="n">sigmadh</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hdh0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p</span><span class="o">.</span><span class="n">sigmash</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hsh0</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">rho_rd</span><span class="p">,</span><span class="n">rho_g1</span><span class="p">,</span><span class="n">rho_g2</span><span class="p">,</span><span class="n">rho_rt</span><span class="p">,</span><span class="n">rho_dh</span><span class="p">,</span><span class="n">rho_sh</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="p">(</span><span class="n">rho_r</span><span class="p">,</span> <span class="n">rho_r0</span><span class="p">)</span></div>


<div class="viewcode-block" id="rhor_monoage"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.rhor_monoage">[docs]</a><span class="k">def</span> <span class="nf">rhor_monoage</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">ages</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Radial density profiles of the mono-age subpopulations. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights to be considered [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param ages: Set of age bins, Gyr. </span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.rhor_monoage_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param sigma: Optional. If True, the result is surface density in :math:`\mathrm{M_\odot \ pc^{-2}}`, </span>
<span class="sd">        otherwise the midplane mass density in :math:`\mathrm{M_\odot \ pc^{-3}}` is calculated. </span>
<span class="sd">        In combination with **number** = True, returns the *number* surface density in :math:`\mathrm{number \ pc^{-2}}`.</span>
<span class="sd">    :type sigma: boolean</span>
<span class="sd">    :param between: Optional. If True, the output quantity corresponds to the age intervals </span>
<span class="sd">        specified by parameter **ages**. Otherwise the individual single mono-age subpopulations </span>
<span class="sd">        are returned (i.e., age-bins of width ``tr``, model age resolution).</span>
<span class="sd">    :type between: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. </span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is the spatial number density of stars in :math:`\mathrm{number \ pc^{-3}}`,</span>
<span class="sd">         not matter density in :math:`\mathrm{M_\odot \ pc^{-3}}`. Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: Surface density (stellar mass density integrated within **zlim** interval) in :math:`\mathrm{M_\odot \ pc^{-2}}` </span>
<span class="sd">        or :math:`\mathrm{number \ pc^{-2}}` or mass density in :math:`\mathrm{M_\odot \ pc^{-3}}`</span>
<span class="sd">        or :math:`\mathrm{number \ pc^{-3}}` (summed density within **zlim**) - </span>
<span class="sd">        as a function of Galactocentric distance and age. </span>
<span class="sd">        Array shape is ``(len(ages),a.Rbins)`` or ``(len(ages)-1,a.Rbins)`` if **between** = True. </span>
<span class="sd">    :rtype: 2d-array        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;radial mono-age profiles&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ages</span> <span class="o">=</span> <span class="n">inpcheck_age</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">nage</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span>
                 
    <span class="n">indt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">ages</span><span class="p">)</span><span class="o">//</span><span class="n">tr</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="n">rho_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tabd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rho_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rho_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="n">rho_z</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rho_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rho_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span>\
                       <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                       
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">)</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">)</span>
            <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabsh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_zd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rho_zt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rho_zsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rho_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_zd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span>\
                         <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span>\
                         <span class="n">_rhor_ages_</span><span class="p">(</span><span class="n">rho_zsh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    <span class="n">rho_r</span><span class="p">[</span><span class="n">rho_r</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">rhor_monoage_save</span><span class="p">(</span><span class="n">rho_r</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">ages</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">rho_r</span></div>


<div class="viewcode-block" id="rhor_monomet"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.rhor_monomet">[docs]</a><span class="k">def</span> <span class="nf">rhor_monomet</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Radial density profiles of the mono-metallicity subpopulations. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights to be considered [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param ages: Set of age bins, Gyr. </span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.rhor_monomet_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param sigma: Optional. If True, the result is surface density in :math:`\mathrm{M_\odot \ pc^{-2}}`, </span>
<span class="sd">        otherwise the midplane mass density in :math:`\mathrm{M_\odot \ pc^{-3}}` is calculated. </span>
<span class="sd">        In combination with **number** = True, returns the *number* surface density in :math:`\mathrm{number \ pc^{-2}}`.</span>
<span class="sd">    :type sigma: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. </span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is the spatial number density of stars in :math:`\mathrm{number \ pc^{-3}}`,</span>
<span class="sd">         not matter density in :math:`\mathrm{M_\odot \ pc^{-3}}`. Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: Surface density (stellar mass density integrated within **zlim** interval) in :math:`\mathrm{M_\odot \ pc^{-2}}` </span>
<span class="sd">        or :math:`\mathrm{number \ pc^{-2}}` or mass density in :math:`\mathrm{M_\odot \ pc^{-3}}`</span>
<span class="sd">        or :math:`\mathrm{number \ pc^{-3}}` (summed density within **zlim**) - </span>
<span class="sd">        as a function of Galactocentric distance and age. Array shape is ``(len(mets)-1,a.Rbins)``.         </span>
<span class="sd">    :rtype: 2d-array              </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;radial mono-metallicity profiles&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tabd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">rhomet</span> <span class="o">=</span> <span class="n">_rhometz_d_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">rhomet</span> <span class="o">=</span> <span class="n">_rhometz_t_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="n">rhomet</span> <span class="o">=</span> <span class="n">_rhometz_sh_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rhometd</span> <span class="o">=</span> <span class="n">_rhometz_d_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhomett</span> <span class="o">=</span> <span class="n">_rhometz_t_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rhometd</span> <span class="o">=</span> <span class="n">_rhometz_d_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhomett</span> <span class="o">=</span> <span class="n">_rhometz_t_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rhomet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhometd</span><span class="p">,</span><span class="n">rhomett</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rhometd</span> <span class="o">=</span> <span class="n">_rhometz_d_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhomett</span> <span class="o">=</span> <span class="n">_rhometz_t_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhometsh</span> <span class="o">=</span> <span class="n">_rhometz_sh_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabsh</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rhometd</span> <span class="o">=</span> <span class="n">_rhometz_d_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhomett</span> <span class="o">=</span> <span class="n">_rhometz_t_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhometsh</span> <span class="o">=</span> <span class="n">_rhometz_sh_</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rhomet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhometd</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhomett</span><span class="p">,</span><span class="n">rhometsh</span><span class="p">))</span>        
    <span class="n">rhomet</span><span class="p">[</span><span class="n">rhomet</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">rhor_monomet_save</span><span class="p">(</span><span class="n">rhomet</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">rhomet</span></div>


<div class="viewcode-block" id="agehist"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.agehist">[docs]</a><span class="k">def</span> <span class="nf">agehist</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Age distributions at the different Galactocentric distances. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights to be considered [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.agehist_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. </span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not by matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param sigma_gauss: Optional. Standard deviation of the Gaussian kernel used to smooth</span>
<span class="sd">        the age distributions, Gyr.</span>
<span class="sd">    :type sigma_gauss: scalar</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set.  </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: There are two types of output:</span>
<span class="sd">        </span>
<span class="sd">        - Age distributions at the different Galactocentric distances, array shape is ``(a.Rbins,a.jd)``. </span>
<span class="sd">        - The same, but at the Solar radius, array of length ``(a.jd)``. </span>
<span class="sd">        </span>
<span class="sd">        Distributions are normalized to area and correspond to the model time-grid ``a.t``. </span>
<span class="sd">    :rtype: [2d-array, 1d-array]        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;sigma_gauss&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">],</span>
                    <span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;age distributions&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
        <span class="n">ages_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span> 
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">))</span>
        <span class="n">ages_ar0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">sum_rho0</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> 
                <span class="n">ages_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">sum_rho</span>
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
                <span class="n">rho0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho</span><span class="p">,</span> <span class="n">rho0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
                <span class="n">rho0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho</span><span class="p">,</span> <span class="n">rho0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">sum_rho0</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ages_ar0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">sum_rho0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ages_ar0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>    
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">sum_rho</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">ages_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">sum_rho</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ages_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">jd</span><span class="p">))</span>
                        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span> 
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">))</span>
        <span class="n">ages_ar0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">sum_rho0</span> 
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>    
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">ages_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">sum_rho</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>   
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>          
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">rho_sh</span><span class="p">,</span> <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_sh</span><span class="p">,</span> <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh0</span><span class="p">))</span>
        <span class="n">ages_ar0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">sum_rho0</span>        
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>   
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">agesd_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">agest_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">agessh_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ages_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">agesd_ar</span> <span class="o">+</span> <span class="n">agest_ar</span> <span class="o">+</span> <span class="n">agessh_ar</span><span class="p">)</span><span class="o">/</span><span class="n">sum_rho</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;sigma_gauss&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ages_ar0</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">ages_ar0</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sigma_gauss&#39;</span><span class="p">]</span><span class="o">//</span><span class="n">tr</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;sigma_gauss&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
                <span class="n">ages_ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">ages_ar</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sigma_gauss&#39;</span><span class="p">]</span><span class="o">//</span><span class="n">tr</span><span class="p">)</span>
                      
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">agehist_save</span><span class="p">(</span><span class="n">ages_ar0</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">agehist_save</span><span class="p">((</span><span class="n">ages_ar</span><span class="p">,</span><span class="n">ages_ar0</span><span class="p">),</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ages_ar0</span><span class="p">,</span> <span class="n">sum_rho0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>      
        <span class="k">return</span> <span class="p">(</span><span class="n">ages_ar</span><span class="p">,</span> <span class="n">ages_ar0</span><span class="p">)</span>         </div>
                                              
                                                                           
<div class="viewcode-block" id="methist"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.methist">[docs]</a><span class="k">def</span> <span class="nf">methist</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metallicity distributions at the different Galactocentric distances. </span>

<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights to be considered [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are prescribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.methist_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. </span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not by matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param sigma_gauss: Standard deviation of the Gaussian kernel used to smooth</span>
<span class="sd">        the metallicity distributions, dex.</span>
<span class="sd">    :type sigma_gauss: scalar</span>
<span class="sd">    :param metbins: Optional. Set of metallicity bins. If not given, the grid is -1.1,...,0.8 dex </span>
<span class="sd">        with 0.05 dex step. </span>
<span class="sd">    :type metbins: array-like</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set.  </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: There are two types of output:</span>
<span class="sd">        </span>
<span class="sd">        - Metallicity distributions at the different Galactocentric distances, array shape is ``(a.Rbins,38)`` (default) or ``(a.Rbins,len(metbins)-1)`` if metbins is in *kwargs*. </span>
<span class="sd">        - The same, but at the Solar radius, array of length ``(38)`` or ``(len(metbins)-1)``. </span>
<span class="sd">        </span>
<span class="sd">        Distributions are normalized to area and correspond to the time-grid ``a.t``. </span>
<span class="sd">    :rtype: [2d-array, 1d-array]        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;sigma_gauss&#39;</span><span class="p">,</span><span class="s1">&#39;metbins&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;metallicity distributions&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;metbins&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">metbins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;metbins&#39;</span><span class="p">]</span>
        <span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span> <span class="o">=</span> <span class="n">metbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">metbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dmet</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">metbins</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">metbinsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">dmet</span><span class="o">/</span><span class="mi">2</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">dmet</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.05</span>
        <span class="n">metbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mmin</span><span class="p">,</span><span class="n">mmax</span><span class="o">+</span><span class="n">dmet</span><span class="p">,</span><span class="n">dmet</span><span class="p">)</span>
        <span class="n">metbinsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">dmet</span><span class="o">/</span><span class="mi">2</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="n">jm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metbinsc</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
        <span class="n">metdist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">jm</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">AMRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">))</span>
        <span class="n">AMRd0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">metdist0</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">AMRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">sum_age_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">sum_age_rho</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">sum_rho0</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">metdist0</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metdist0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">jm</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">sum_rho</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">jm</span><span class="p">))</span>
                    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_sh</span><span class="p">,</span> <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">AMRsh_spread</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">n_FeHsh</span><span class="p">)</span>
        <span class="n">wsh</span> <span class="o">=</span> <span class="n">gauss_weights</span><span class="p">(</span><span class="n">AMRsh_spread</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">)</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">sum_rho0</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">metdist0</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">AMRsh_spread</span><span class="p">,</span><span class="n">wsh</span><span class="o">*</span><span class="n">sum_rho0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metdist0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">jm</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">sum_rho</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">AMRsh_spread</span><span class="p">,</span><span class="n">wsh</span><span class="o">*</span><span class="n">sum_rho</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">jm</span><span class="p">))</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>  
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">AMRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">))</span>
        <span class="n">AMRd0</span><span class="p">,</span> <span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">metdist0</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                                   <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>  
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>                                                                           
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">sum_age_rhod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sum_age_rhot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                                      
                <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sum_age_rhod</span><span class="p">,</span><span class="n">sum_age_rhot</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>      
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>   
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">rho_sh</span><span class="p">,</span> <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_d</span><span class="p">,</span> <span class="n">rho_d0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_t</span><span class="p">,</span> <span class="n">rho_t0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_sh</span><span class="p">,</span> <span class="n">rho_sh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">AMRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh0</span><span class="p">))</span>
        <span class="n">AMRd0</span><span class="p">,</span> <span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd0&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">AMRsh_spread</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">n_FeHsh</span><span class="p">)</span>
        <span class="n">wsh</span> <span class="o">=</span> <span class="n">gauss_weights</span><span class="p">(</span><span class="n">AMRsh_spread</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">)</span>
        
        <span class="n">amr_met0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRsh_spread</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">all_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh0</span><span class="p">))</span><span class="o">*</span><span class="n">wsh</span><span class="p">,</span>
                               <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
                               <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">metdist0</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">amr_met0</span><span class="p">,</span><span class="n">all_rho0</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>                                           
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">sum_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">sum_age_rhod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sum_age_rhot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
                <span class="n">sum_age_rhosh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_sh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">wsh</span>      
                <span class="n">amr_met</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRsh_spread</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">all_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sum_age_rhosh</span><span class="p">,</span>
                                          <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sum_age_rhod</span><span class="p">,</span><span class="n">sum_age_rhot</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rebin_histogram</span><span class="p">(</span><span class="n">metbins</span><span class="p">,</span><span class="n">amr_met</span><span class="p">,</span><span class="n">all_rho</span><span class="p">)</span>
    
    <span class="n">sum_rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">metdist0</span><span class="p">)</span><span class="o">*</span><span class="n">dmet</span>
    <span class="k">if</span> <span class="n">sum_rho0</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">metdist0</span> <span class="o">=</span> <span class="n">metdist0</span><span class="o">/</span><span class="n">sum_rho0</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;sigma_gauss&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">metdist0</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">metdist0</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sigma_gauss&#39;</span><span class="p">]</span><span class="o">//</span><span class="n">dmet</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">dmet</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;sigma_gauss&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
                <span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">metdist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sigma_gauss&#39;</span><span class="p">]</span><span class="o">//</span><span class="n">dmet</span><span class="p">)</span>
                          
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">methist_save</span><span class="p">((</span><span class="n">metdist0</span><span class="p">,</span><span class="n">metbinsc</span><span class="p">),</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">methist_save</span><span class="p">((</span><span class="n">metdist</span><span class="p">,</span><span class="n">metdist0</span><span class="p">,</span><span class="n">metbinsc</span><span class="p">),</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">metdist0</span><span class="p">,</span> <span class="n">sum_rho0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">metdist</span><span class="p">,</span> <span class="n">metdist0</span><span class="p">)</span></div>


<div class="viewcode-block" id="hr_monoage"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.hr_monoage">[docs]</a><span class="k">def</span> <span class="nf">hr_monoage</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">ages</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scale heights of the mono-age subpopulations as a function of Galactocentric distance. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param ages: Set of age bins, Gyr.</span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.hr_monoage_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param between: Optional. If True, the output quantity corresponds to the age intervals </span>
<span class="sd">        specified by parameter **ages**. Otherwise the individual single mono-age subpopulations </span>
<span class="sd">        are returned (i.e., age-bins of width ``tr``, model age resolution).</span>
<span class="sd">    :type between: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``</span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: Radial profiles of scale heights for age bins, pc. Array shape is ``(a.Rbins,len(ages))`` </span>
<span class="sd">        or ``(a.Rbins,len(ages)-1)`` if **between** is True.</span>
<span class="sd">    :rtype: 2d-array.         </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;mono-age scale heights&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ages</span> <span class="o">=</span> <span class="n">inpcheck_age</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span>
        
    <span class="n">indt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">ages</span><span class="p">)</span><span class="o">//</span><span class="n">tr</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">nage</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rhod0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmad</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmad</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rhozt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">sigmazt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhozt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rhod0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmad</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rhot0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmat</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhot0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigmad</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigmat</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhot0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rhozt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">sigmazt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rhozsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">sigmazsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhozt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhozsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rhod0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmad</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rhot0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmat</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rhosh0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozsh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmash</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazsh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhot0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhosh0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigmad</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigmat</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigmash</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>\
                            <span class="o">/</span><span class="p">(</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhot0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhosh0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
       
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">hr_monoage_save</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">ages</span><span class="p">)</span>                

    <span class="k">return</span> <span class="n">H</span></div>


<div class="viewcode-block" id="hr_monomet"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.hr_monomet">[docs]</a><span class="k">def</span> <span class="nf">hr_monomet</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scale heights of the mono-metallicity subpopulations as a function of Galactocentric distance. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param mets: Set of metallicity bins.</span>
<span class="sd">    :type mets: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.hr_monomet_save`. </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``</span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">    </span>
<span class="sd">    :return: Radial profiles of scale heights for metallicity bins, pc. Array shape is ``(a.Rbins,len(mets)-1)``. </span>
<span class="sd">    :rtype: 2d-array.         </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;mono-metallicity scale heights&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">nmet</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">nmet</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">AMRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#times = np.zeros((a.Rbins,nmet,a.jd))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">indt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">mets</span><span class="p">)</span>
            <span class="c1">#for k in range(nmet):</span>
            <span class="c1">#    if indt[k]!=-999 and indt[k+1]!=-999:</span>
            <span class="c1">#        times[i][k][indt[k]:indt[k+1]] = np.sum(sigmazd[i],axis=0)[indt[k]:indt[k+1]]</span>
            <span class="n">rhod0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmad</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmet</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmad</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rhozt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">sigmazt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhozt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">AMRd</span><span class="p">,</span> <span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">indtt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">mets</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">inddt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">mets</span><span class="p">)</span>
            <span class="n">rhod0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">inddt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmad</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">inddt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rhot0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indtt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmat</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indtt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmet</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhot0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigmad</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigmat</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhot0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rhozt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">sigmazt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rhozsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">sigmazsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rhozd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazd</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhozt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazt</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rhozsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sigmazsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">AMRd</span><span class="p">,</span> <span class="n">AMRt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">,</span><span class="s1">&#39;AMRt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">indtt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">mets</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">inddt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">mets</span><span class="p">)</span>
            <span class="n">rhod0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">inddt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmad</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">inddt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rhot0</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhozt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indtt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sigmat</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">sigmazt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">indtt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rhosh0</span> <span class="o">=</span> <span class="n">rhozsh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sigmash</span> <span class="o">=</span> <span class="n">sigmazsh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmet</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">):</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
                    <span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
                    <span class="n">rhosh0_ik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rhosh0</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">(</span><span class="n">t1</span><span class="p">))</span><span class="o">/</span><span class="n">erf</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    <span class="n">sigmash_ik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sigmash</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">(</span><span class="n">t1</span><span class="p">))</span><span class="o">/</span><span class="n">erf</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rhosh0_ik</span><span class="p">,</span> <span class="n">sigmash_ik</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhot0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhosh0_ik</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigmad</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigmat</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigmash_ik</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>\
                            <span class="o">/</span><span class="p">(</span><span class="n">rhod0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhot0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhosh0_ik</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
       
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">hr_monomet_save</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">mets</span><span class="p">)</span>                 
    
    <span class="k">return</span> <span class="n">H</span></div>


<div class="viewcode-block" id="sigwz"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.sigwz">[docs]</a><span class="k">def</span> <span class="nf">sigwz</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    W-velocity dispersion as a function of distance from the Galactic plane. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param R: Optional. Galactocentric distance, kpc. Required when parameter **tab** is specified. </span>
<span class="sd">        If not given, velocity dispersion profiles will be calculated for the whole range of modeled radii ``a.R``. </span>
<span class="sd">    :type R: scalar</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.sigwz_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. If a single Galactocentric distance is modeled with parameter **R**, </span>
<span class="sd">        then *tab* is constructed as [*table_d,table_t,table_sh*] with tables for this radius. </span>
<span class="sd">    :type tab: astropy table or list[astropy table], or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not by matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: There are usually two arrays in the output: </span>
<span class="sd">        </span>
<span class="sd">        - Vertical profile of the W-velocity dispersion at ``a.R``, :math:`\mathrm{km \ s^{-1}}`. Array shape is ``(a.Rbins, a.n)`` (by default) or ``(a.n)`` (if parameter **R** is given). The profiles has to be used with z-grid ``a.z``. </span>
<span class="sd">        - Same, but for the Solar radius ``p.Rsun``, array of length ``(a.n)``. </span>
<span class="sd">        </span>
<span class="sd">    If the optional parameter **R** is given and equals to ``p.Rsun``, the output only contains the local vertical </span>
<span class="sd">    W-velocity dispersion profile. </span>
<span class="sd">        </span>
<span class="sd">    :rtype: [2d-array, 1d-array] or [1d-array, 1d-array], or 1d-array   </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;W-velocity dispersion&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">AVRd0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AVR0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
        <span class="n">AVRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AVR&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">Sigt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Sigt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>      
        
        <span class="n">rho_sigw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="n">rho_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>   
    
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">npeak</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">)</span>
        <span class="n">Fp0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fp0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fp0</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="n">sigp</span><span class="p">,</span> <span class="n">Hdp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
            <span class="n">fpr0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subarray</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">subarray</span> <span class="ow">in</span> <span class="n">Fp</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">):</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>   
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">):</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>   
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_z</span><span class="p">,</span> <span class="n">rho_z0</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>   
            
    <span class="n">rho_sum0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z0</span><span class="p">,</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">rho_sigw0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">fp0</span><span class="o">*</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">Fp0</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                      <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)]))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rho_sigw0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_z0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="n">rho_sum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rho_sigw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">fpr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
                             <span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sigp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">Fp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)]))</span>
                             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_sigw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zt</span><span class="p">,</span> <span class="n">rho_zt0</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_sigw0</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho_sigw0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigt</span><span class="o">*</span><span class="n">rho_zt0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
        <span class="n">rho_sum0</span> <span class="o">=</span> <span class="n">rho_sum0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt0</span><span class="p">,</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">rho_sum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_sum</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">rho_sigw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho_sigw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">rho_zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
                                 
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">rho_zsh</span><span class="p">,</span> <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="p">[</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rho_zsh</span><span class="p">,</span> <span class="n">rho_zsh0</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rho_sigw0</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho_sigw0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">*</span><span class="n">rho_zsh0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span> 
        <span class="n">rho_sum0</span> <span class="o">=</span> <span class="n">rho_sum0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zsh0</span><span class="p">,</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
                <span class="n">rho_sum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_sum</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_zsh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">rho_sigw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho_sigw</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">*</span><span class="n">rho_zsh</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="p">)]</span>
            
    <span class="n">sigw_z0</span> <span class="o">=</span> <span class="n">rho_sigw0</span><span class="o">/</span><span class="n">rho_sum0</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">):</span>
        <span class="n">sigw_z</span> <span class="o">=</span> <span class="n">rho_sigw</span><span class="o">/</span><span class="n">rho_sum</span>
                
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">sigwz_save</span><span class="p">(</span><span class="n">sigw_z0</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">)</span>   
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">sigwz_save</span><span class="p">((</span><span class="n">sigw_z</span><span class="p">,</span><span class="n">sigw_z0</span><span class="p">),</span><span class="n">mode_comp</span><span class="p">)</span>   
    
    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sigw_z0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sigw_z</span><span class="p">,</span> <span class="n">sigw_z0</span><span class="p">)</span></div>


<div class="viewcode-block" id="sigwr"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.sigwr">[docs]</a><span class="k">def</span> <span class="nf">sigwr</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    W-velocity dispersion as a function of Galactocentric distance. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.sigwr_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``</span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not by matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: Radial profile of the W-velocity dispersion, :math:`\mathrm{km \ s^{-1}}`. Array of length ``a.Rbins``. </span>
<span class="sd">    :rtype: 1d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;W-velocity dispersion&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">AVRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AVR&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">Sigt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Sigt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">sigp</span><span class="p">,</span> <span class="n">Hdp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
        <span class="n">fpr0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subarray</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">subarray</span> <span class="ow">in</span> <span class="n">Fp</span><span class="p">]</span>
        <span class="n">npeak</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">)</span>
    
    <span class="n">nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zlim</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">indz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zlim</span><span class="p">])</span>
    <span class="n">sigw_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">nz</span><span class="p">))</span>
    
    <span class="n">table</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="n">table</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">rho_rdz</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rho_rdz</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">rho_rtz</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_rtz</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">rho_rshz</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_rshz</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
        <span class="n">rho_rd</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rdz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">indz</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span><span class="n">indz</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sigw_rho</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">fpr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> 
                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sigp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">Fp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)]))</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sigw_rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)]</span>
        <span class="n">rho_sum</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)]</span>
        
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rtz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">indz</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span><span class="n">indz</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)]</span>
            <span class="n">sigw_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sigw_rho</span><span class="p">,[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)])</span>
            <span class="n">rho_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_sum</span><span class="p">,[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)])</span>
            
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">rho_rsh</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rshz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">indz</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span><span class="n">indz</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)]</span>
            <span class="n">sigw_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sigw_rho</span><span class="p">,[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">*</span><span class="n">rho_rsh</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)])</span>
            <span class="n">rho_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rho_sum</span><span class="p">,[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rsh</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">)])</span>

        <span class="n">sigw_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">sigw_rho</span><span class="p">,</span><span class="n">rho_sum</span><span class="p">)</span>            
    
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">sigwr_save</span><span class="p">(</span><span class="n">sigw_r</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>   
                                                                                
    <span class="k">return</span> <span class="n">sigw_r</span></div>
                                                                                
                                                
<div class="viewcode-block" id="sigwr_monoage"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.sigwr_monoage">[docs]</a><span class="k">def</span> <span class="nf">sigwr_monoage</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">ages</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    W-velocity dispersion for the mono-age subpopulations as a function of Galactocentric </span>
<span class="sd">    distance. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param ages: Set of age bins, Gyr.</span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.sigwr_monoage_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param between: Optional. If True, the output quantity corresponds to the age intervals </span>
<span class="sd">        specified by parameter **ages**. Otherwise the individual single mono-age subpopulations </span>
<span class="sd">        are returned (i.e., age-bins of width ``tr``, model age resolution).</span>
<span class="sd">    :type between: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``</span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: Radial profiles of the W-velocity dispersion of mono-age subpopulations, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">        Array shape is ``(a.Rbins,len(ages))`` or ``(a.Rbins,len(ages)-1)`` if **between** is True. </span>
<span class="sd">    :rtype: 2d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;W-velocity dispersion&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ages</span> <span class="o">=</span> <span class="n">inpcheck_age</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>

    <span class="n">AVRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AVR&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>   
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
       <span class="n">Sigt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Sigt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> 
            
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">sigp</span><span class="p">,</span> <span class="n">Hdp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
        <span class="n">fpr0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subarray</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">subarray</span> <span class="ow">in</span> <span class="n">Fp</span><span class="p">]</span>
        <span class="n">npeak</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">)</span>
    
    <span class="n">indt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">ages</span><span class="p">)</span><span class="o">//</span><span class="n">tr</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">nage</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span>
    
    <span class="n">sigw_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">nage</span><span class="p">))</span>
    
    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>   
    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">!=</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
                <span class="n">rhord</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span>
                                 <span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rhord</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span>
                                 <span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rhord</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs_calc</span><span class="p">,</span><span class="s1">&#39;between&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
            <span class="n">kwargs_calc2</span> <span class="o">=</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">kwargs_calc2</span><span class="p">[</span><span class="s1">&#39;between&#39;</span><span class="p">]</span>
            <span class="n">sigw_rho</span><span class="p">,</span> <span class="n">rho_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">))</span> 
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
                <span class="n">indt_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indt</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">indt</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhord</span><span class="p">,</span><span class="n">indt_list</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc2</span><span class="p">)</span>
                <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt_list</span><span class="p">]</span><span class="o">*</span><span class="n">fpr0</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">indt_list</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">)</span> <span class="o">+</span> 
                                   <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sigp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">Fp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt_list</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span> 
                                                  <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt_list</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">)</span>
                <span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhord</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">sigw_rho</span> <span class="o">=</span> <span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt</span><span class="p">]</span><span class="o">*</span><span class="n">fpr0</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">indt</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span> <span class="o">+</span> 
                            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sigp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">Fp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigw_rho</span> <span class="o">=</span> <span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span>
            <span class="n">rho_sum</span> <span class="o">=</span> <span class="n">rho_rd</span>
        
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">rhort</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span>
                                 <span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rhort</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhort</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sigw_rho</span> <span class="o">=</span> <span class="n">sigw_rho</span> <span class="o">+</span> <span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rt</span>
            <span class="n">rho_sum</span> <span class="o">=</span> <span class="n">rho_sum</span> <span class="o">+</span> <span class="n">rho_rt</span>
            
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">rhorsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span>
                                   <span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rhorsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhorsh</span><span class="p">,</span><span class="n">indt</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rsh</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sigw_rho</span> <span class="o">=</span> <span class="n">sigw_rho</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">*</span><span class="n">rho_rsh</span>
            <span class="n">rho_sum</span> <span class="o">=</span> <span class="n">rho_sum</span> <span class="o">+</span> <span class="n">rho_rsh</span>      
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">sigw_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigw_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                              
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">sigwr_monoage_save</span><span class="p">(</span><span class="n">sigw_r</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">ages</span><span class="p">)</span>   
            
    <span class="k">return</span> <span class="n">sigw_r</span></div>
            

<div class="viewcode-block" id="sigwr_monomet"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.sigwr_monomet">[docs]</a><span class="k">def</span> <span class="nf">sigwr_monomet</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    W-velocity dispersion for the mono-metallicity subpoplations as a function </span>
<span class="sd">    of Galactocentric distance.</span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param zlim: Range of heights [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param mets: Set of metallicity bins.</span>
<span class="sd">    :type mets: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.sigwr_monomet_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``</span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>

<span class="sd">    :return: Radial profile of the W-velocity dispersion for the mono-metallicity bins, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">        Array shape is ``(a.Rbins,len(mets)-1)``.   </span>
<span class="sd">    :rtype: 2d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;W-velocity dispersion&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">AMRd</span><span class="p">,</span><span class="n">AVRd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRd&#39;</span><span class="p">,</span><span class="s1">&#39;AVR&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">AMRt</span><span class="p">,</span><span class="n">Sigt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;AMRt&#39;</span><span class="p">,</span><span class="s1">&#39;Sigt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">sigp</span><span class="p">,</span> <span class="n">Hdp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
        <span class="n">fpr0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subarray</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">subarray</span> <span class="ow">in</span> <span class="n">Fp</span><span class="p">]</span>
        <span class="n">npeak</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">)</span>
        
    <span class="n">nage</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mets</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sigw_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
        
    <span class="n">table</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">!=</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
                <span class="n">rhord</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>   
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rhord</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rhord</span> <span class="o">=</span> <span class="n">_rhoz_d_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>    
        <span class="n">inddt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">mets</span><span class="p">)</span>
        <span class="n">sigw_rho</span><span class="p">,</span> <span class="n">rho_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nage</span><span class="p">))</span> 
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
            <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">inddt</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">inddt</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">ind1</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">and</span> <span class="n">ind2</span><span class="o">!=-</span><span class="mi">999</span><span class="p">:</span>
                <span class="n">indt_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span><span class="n">ind2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhord</span><span class="p">,</span><span class="n">indt_list</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">rho_rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt_list</span><span class="p">]</span><span class="o">*</span><span class="n">fpr0</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">indt_list</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">)</span> <span class="o">+</span> 
                                   <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sigp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">Fp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt_list</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span> 
                                                  <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AVRd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">indt_list</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rd</span><span class="p">)</span>
                <span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rd</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
                <span class="n">rhort</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rhort</span> <span class="o">=</span> <span class="n">_rhoz_t_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">indtt</span> <span class="o">=</span> <span class="n">_ind_amr2t_</span><span class="p">(</span><span class="n">AMRt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">mets</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
                <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">indtt</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">indtt</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
                <span class="k">if</span> <span class="n">ind1</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">and</span> <span class="n">ind2</span><span class="o">!=-</span><span class="mi">999</span><span class="p">:</span>
                    <span class="n">indt_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span><span class="n">ind2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                    <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">_rhoz_ages_</span><span class="p">(</span><span class="n">rhort</span><span class="p">,</span><span class="n">indt_list</span><span class="p">,</span><span class="n">this_function</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">rho_rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">rho_rt</span><span class="p">)</span>
                    <span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rt</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
                <span class="n">rhorsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rhorsh</span> <span class="o">=</span> <span class="n">_rhoz_sh_</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span><span class="p">):</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
                    <span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="n">mets</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">FeHsh</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">dFeHsh</span>
                    <span class="n">rho_rsh</span> <span class="o">=</span> <span class="n">rhorsh</span><span class="o">*</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span><span class="o">-</span><span class="n">erf</span><span class="p">(</span><span class="n">t1</span><span class="p">))</span><span class="o">/</span><span class="n">erf</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>  
                    <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">*</span><span class="n">rho_rsh</span><span class="p">)</span>
                    <span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_rsh</span><span class="p">)</span>      

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nage</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">sigw_r</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigw_rho</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">rho_sum</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigw_r</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>                  

    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">sigwr_monomet_save</span><span class="p">(</span><span class="n">sigw_r</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">mets</span><span class="p">)</span>   
                    
    <span class="k">return</span> <span class="n">sigw_r</span></div>


<div class="viewcode-block" id="mean_quantity"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.mean_quantity">[docs]</a><span class="k">def</span> <span class="nf">mean_quantity</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">quantity</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates mean value of some quantity as a function of height z</span>
<span class="sd">    weighted by the spatial number densities of &#39;stellar assemblies&#39;. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param R: Galactocentric distance, kpc.</span>
<span class="sd">    :type R: scalar </span>
<span class="sd">    :param zlim: Range of heights [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param quantity: Name of the column in a stellar assemblies table to which </span>
<span class="sd">        the function has to be applied; for velocity dispersion use ``&#39;sigw&#39;``. </span>
<span class="sd">    :type quantity: str</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param ages: Optional. Set of age bins, Gyr. </span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param mets: Optional. Set of metallicity bins.</span>
<span class="sd">    :type mets: array-like</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.mean_quantity_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table, parameter alternative to **mode_pop**. </span>
<span class="sd">        If mode_comp==&#39;tot&#39;, **tab** must be organized as a list of tables corresponding to this **R**:  </span>
<span class="sd">        [*table_d*,*table_t*,table_sh*]. </span>
<span class="sd">    :type tab: astropy table or list[astropy table] </span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd"> </span>
<span class="sd">    :return: Vertical profile of the given quantity in the selected </span>
<span class="sd">        horizontal slice **zlim**. Array of length ``(zlim[1]-zlim[0])//p.dz``. </span>
<span class="sd">    :rtype: 1d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span><span class="n">quantity</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">inpcheck_height</span><span class="p">(</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">inpcheck_radius</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>   
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">indr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_indr_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">indz1</span><span class="p">,</span> <span class="n">indz2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>
    <span class="n">Q_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">indz2</span><span class="o">-</span><span class="n">indz1</span><span class="p">)))</span>

    <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> 
        <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;FeH&#39;</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">]</span>
    
    <span class="n">Fi</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Phi&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">Hd</span><span class="p">,</span><span class="n">AVR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hd&#39;</span><span class="p">,</span><span class="s1">&#39;AVR&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sigp</span><span class="p">,</span> <span class="n">Hdp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">fp0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fp</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">npeak</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mode_pop&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="s1">&#39;ssp&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
                    <span class="n">tabd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">tabd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="n">ind_sub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tabd</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">&gt;</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">tabd</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">&lt;</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tabd</span> <span class="o">=</span> <span class="n">tabd</span><span class="p">[</span><span class="n">ind_sub</span><span class="p">]</span>
        <span class="n">inddt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">tabd</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])</span><span class="o">//</span><span class="n">tr</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="n">disk_ages</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">t</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">Ht</span><span class="p">,</span><span class="n">Sigt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Ht&#39;</span><span class="p">,</span><span class="s1">&#39;Sigt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mode_pop&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="s1">&#39;ssp&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
                    <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="n">ind_sub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tabt</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">&gt;</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">tabt</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">&lt;</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tabt</span> <span class="o">=</span> <span class="n">tabt</span><span class="p">[</span><span class="n">ind_sub</span><span class="p">]</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">Hsh</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hsh&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;mode_pop&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="s1">&#39;ssp&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">tabsh</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
                    <span class="n">tabsh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">tabsh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="n">ind_sub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tabsh</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">&gt;</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">tabsh</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">&lt;</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">tabsh</span><span class="p">[</span><span class="n">ind_sub</span><span class="p">]</span>
            
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">indz1</span><span class="p">,</span><span class="n">indz2</span><span class="p">):</span>
        <span class="n">weighted_nzsum</span><span class="p">,</span> <span class="n">nzsum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>  
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">Nz_d</span><span class="p">,</span> <span class="n">Nz_term1_d</span><span class="p">,</span> <span class="n">Nz_term2_d</span> <span class="o">=</span> <span class="n">_meanq_d_</span><span class="p">(</span><span class="n">indr</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">inddt</span><span class="p">,</span><span class="n">tabd</span><span class="p">,</span><span class="n">Fi</span><span class="p">,</span><span class="n">Hd</span><span class="p">,</span><span class="n">AVR</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">fp0</span><span class="o">=</span><span class="n">fp0</span><span class="p">,</span>
                                                         <span class="n">Fp</span><span class="o">=</span><span class="n">Fp</span><span class="p">,</span><span class="n">Hdp</span><span class="o">=</span><span class="n">Hdp</span><span class="p">,</span><span class="n">sigp</span><span class="o">=</span><span class="n">sigp</span><span class="p">,</span><span class="n">npeak</span><span class="o">=</span><span class="n">npeak</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Nz_d</span> <span class="o">=</span> <span class="n">_meanq_d_</span><span class="p">(</span><span class="n">indr</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">inddt</span><span class="p">,</span><span class="n">tabd</span><span class="p">,</span><span class="n">Fi</span><span class="p">,</span><span class="n">Hd</span><span class="p">,</span><span class="n">AVR</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="n">nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">Nz_t</span> <span class="o">=</span> <span class="n">_meanq_t_</span><span class="p">(</span><span class="n">indr</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">tabt</span><span class="p">,</span><span class="n">Fi</span><span class="p">,</span><span class="n">Ht</span><span class="p">,</span><span class="n">Sigt</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="n">nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">Nz_sh</span> <span class="o">=</span> <span class="n">_meanq_sh_</span><span class="p">(</span><span class="n">indr</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">tabsh</span><span class="p">,</span><span class="n">Fi</span><span class="p">,</span><span class="n">Hsh</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="n">nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_sh</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">nzsum</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">quantity</span><span class="o">==</span><span class="s1">&#39;sigw&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">weighted_nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_term1_d</span><span class="o">*</span><span class="n">AVR</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">inddt</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npeak</span><span class="p">):</span>
                            <span class="n">weighted_nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_term2_d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">sigp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> 
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">weighted_nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_d</span><span class="o">*</span><span class="n">AVR</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">inddt</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">weighted_nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_t</span><span class="o">*</span><span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indr</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">weighted_nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_sh</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">weighted_nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_d</span><span class="o">*</span><span class="n">tabd</span><span class="p">[</span><span class="n">quantity</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">weighted_nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_t</span><span class="o">*</span><span class="n">tabt</span><span class="p">[</span><span class="n">quantity</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">weighted_nzsum</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_sh</span><span class="o">*</span><span class="n">tabsh</span><span class="p">[</span><span class="n">quantity</span><span class="p">])</span>
            <span class="n">Q_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">weighted_nzsum</span><span class="o">/</span><span class="n">nzsum</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Q_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
           
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">mean_quantity_save</span><span class="p">(</span><span class="n">Q_mean</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">quantity</span><span class="p">)</span>   
                
    <span class="k">return</span> <span class="n">Q_mean</span></div>


<div class="viewcode-block" id="pops_in_volume"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.pops_in_volume">[docs]</a><span class="k">def</span> <span class="nf">pops_in_volume</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the number of stars in a volume.  </span>

<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param R: Galactocentric distance, kpc. </span>
<span class="sd">    :type R: scalar </span>
<span class="sd">    :param volume: </span>
<span class="sd">        If scalar, then volume is the same for all z-bins, e.g. cylinder can be modeled  </span>
<span class="sd">        in this way. If **volume** is an array (must match the model grid ``a.z`` or be consistent with  </span>
<span class="sd">        the assumed **zlim** in *kwargs*, see below), then volumes of the different z-bins can also be different. </span>
<span class="sd">        This is suitable for the modeling of a sphere or a cone. Units are :math:`\mathrm{pc}^3`. Note that if the modeled </span>
<span class="sd">        volume is located at both positive and negative z, **volume** must include their sum, as this function </span>
<span class="sd">        works with the absolute z-values. </span>
<span class="sd">    :type volume: scalar or array-like </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.mean_quantity_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table, parameter alternative to **mode_pop**. </span>
<span class="sd">        If mode_comp==&#39;tot&#39;, **tab** must be organized as a list of tables corresponding to this **R**:  </span>
<span class="sd">        [*table_d*,*table_t*,table_sh*]. </span>
<span class="sd">    :type tab: astropy table or list[astropy table] </span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">    :param zlim: Optional. Range of heights [*zmim,zmax*] to be considered. Note that *zmax*-*zmin* &gt; `p.dz`, </span>
<span class="sd">        the slice cannot be thinner than the model vertical resolution. If **zlim** is given, and **volume** </span>
<span class="sd">        is an array, be sure that length of **volume** equals to ``(zmax-zlim)//p.dz``. If no **zlim** is given, then </span>
<span class="sd">        all heights from 0 to ``p.zmax`` are considered.</span>
<span class="sd">    :type zlim: array-like</span>
<span class="sd">    :param vln: Info about the chosen volume shape. </span>
<span class="sd">    :type vln: str</span>
<span class="sd">    </span>
<span class="sd">    :return: Table. Column ``&#39;Nz&#39;`` contains the number of stars (stellar assembly populations) located </span>
<span class="sd">        in the volume specified by the parameters **R** (where in the disk), **zlim** (range of heights),</span>
<span class="sd">        and **volume** (what are volumes of z-slices - allows to model different shapes). </span>
<span class="sd">    :rtype: astropy table or list[astropy table]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;vln&#39;</span><span class="p">,</span><span class="s1">&#39;zlim&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>                            
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;stellar assemblies number density&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">!=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">inpcheck_radius</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>  
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">popname</span> <span class="o">=</span> <span class="s1">&#39;ssp&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span> 
            <span class="n">tabd</span> <span class="o">=</span> <span class="n">tab</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> 
            <span class="n">tabt</span> <span class="o">=</span> <span class="n">tab</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">tab</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
            <span class="n">tabd</span><span class="p">,</span> <span class="n">tabt</span> <span class="o">=</span> <span class="n">tab</span> 
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabd</span><span class="p">,</span> <span class="n">tabt</span><span class="p">,</span> <span class="n">tabsh</span> <span class="o">=</span> <span class="n">tab</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="k">if</span> <span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">popname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">]</span>        
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabd</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">popname</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">popname</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">(</span><span class="n">popname</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">indz1</span><span class="p">,</span> <span class="n">indz2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span><span class="p">))</span>
        <span class="n">indz1</span><span class="p">,</span> <span class="n">indz2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">indz1</span><span class="p">,</span><span class="n">indz2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indz1</span><span class="p">,</span> <span class="n">indz2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n_array</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
        <span class="n">Fi</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Phi0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">indr</span> <span class="o">=</span> <span class="mi">1</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Fi</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Phi&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">indr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_indr_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">Hd</span><span class="p">,</span> <span class="n">AVR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hd0&#39;</span><span class="p">,</span><span class="s1">&#39;AVR0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sigp</span><span class="p">,</span> <span class="n">Hdp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Hd</span><span class="p">,</span> <span class="n">AVR</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hd&#39;</span><span class="p">,</span><span class="s1">&#39;AVR&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Fp&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sigp</span><span class="p">,</span> <span class="n">Hdp</span> <span class="o">=</span> <span class="n">hdp_reader</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fpr0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fp</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">npeak</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigp</span><span class="p">)</span>
        
            <span class="n">wd0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fpr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hd</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span>\
                            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVR</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">jd_array</span><span class="p">])</span>
            <span class="n">wdp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">Fp</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hdp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span>\
                            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sigp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npeak</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">jd_array</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="o">/</span><span class="n">Hd</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span>\
                           <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">AVR</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">jd_array</span><span class="p">])</span>
            
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">Ht</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Ht0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">wt</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">Ht</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ht</span><span class="p">,</span> <span class="n">Sigt</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Ht&#39;</span><span class="p">,</span><span class="s1">&#39;Sigt&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">wt</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">Ht</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indr</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Sigt</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indr</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">:</span>
            <span class="n">Hsh</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hsh0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">wsh</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">Hsh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Hsh</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hsh&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">wsh</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">Hsh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indr</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Fi</span><span class="p">[</span><span class="n">indr</span><span class="p">][</span><span class="n">indz1</span><span class="p">:</span><span class="n">indz2</span><span class="p">]</span><span class="o">/</span><span class="n">KM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">sigsh</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">)</span> 
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">indt_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span><span class="n">tabd</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])</span><span class="o">//</span><span class="n">tr</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pkey</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sum_Nzd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tabd</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">wd0</span><span class="p">[</span><span class="n">indt_tab</span><span class="p">],</span><span class="n">tabd</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">wdp</span><span class="p">[</span><span class="n">indt_tab</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sum_Nzd</span> <span class="o">=</span> <span class="n">tabd</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">wd</span><span class="p">[</span><span class="n">indt_tab</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">sum_Nzt</span> <span class="o">=</span> <span class="n">tabt</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">wt</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">sum_Nzsh</span> <span class="o">=</span> <span class="n">tabsh</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">wsh</span>
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">sum_Nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nzd</span><span class="p">)</span>
        <span class="n">tabd</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_Nz</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">tabd</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">sum_Nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nzt</span><span class="p">)</span>
        <span class="n">tabt</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_Nz</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">tabt</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="n">sum_Nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nzsh</span><span class="p">)</span>
        <span class="n">tabsh</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_Nz</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">tabsh</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="n">sum_Nz</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nzd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nzt</span><span class="p">))</span>
        <span class="n">tabd</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_Nzd</span>
        <span class="n">tabt</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_Nzt</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="p">(</span><span class="n">tabd</span><span class="p">,</span> <span class="n">tabt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="n">sum_Nz</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nzd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nzt</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nzsh</span><span class="p">))</span>
        <span class="n">tabd</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_Nzd</span>
        <span class="n">tabt</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_Nzt</span>
        <span class="n">tabsh</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_Nzsh</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="p">(</span><span class="n">tabd</span><span class="p">,</span> <span class="n">tabt</span><span class="p">,</span> <span class="n">tabsh</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">pops_in_volume_save</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">popname</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">tab</span></div>


<div class="viewcode-block" id="disk_brightness"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.disk_brightness">[docs]</a><span class="k">def</span> <span class="nf">disk_brightness</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">mode_geom</span><span class="p">,</span><span class="n">bands</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MW as an external galaxy. Function calculates the surface brightness or colour profile of the MW if it is viewed </span>
<span class="sd">    edge-on or face-on (individual model components and stellar populations can be selected). </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total). </span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param mode_geom: Modeled geometry. Disk orientation with respect to the observer: ``&#39;face-on&#39;`` or ``&#39;edge-on&#39;``. </span>
<span class="sd">    :type mode_geom: str</span>
<span class="sd">    :param bands: If a string, this parameter corresponds to the band for the surface brightness profile. </span>
<span class="sd">        If it is a list, then **bands** gives the names of two bands to be used for the color profile - e.g. </span>
<span class="sd">        ``[&#39;U&#39;,&#39;V&#39;]`` for *U-V*.</span>
<span class="sd">    :type bands: str or list</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.disk_brightness_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param zlim: Optional. Range of heights [*zmim,zmax*] to be considered, pc. If not given, </span>
<span class="sd">        all heights up to ``p.zmax`` are taken into account.</span>
<span class="sd">    :type zlim: array-like</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``</span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]] </span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">    </span>
<span class="sd">    :return: Disk surface brightness profile (:math:`\mathrm{mag \ arcsec^{-2}}`) or color </span>
<span class="sd">        profile (mag). Use together with ``a.R`` array. </span>
<span class="sd">    :rtype: 1d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                           <span class="s1">&#39;disk brightness/colour profile&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>

    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;zlim&#39;</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">zmax</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="p">:</span>
        <span class="n">zlim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_geom</span><span class="o">==</span><span class="s1">&#39;face-on&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">this_function</span> <span class="o">+</span> <span class="s2">&quot;: Unnecessary input. Keyword &#39;zlim&#39; &quot;</span><span class="o">+</span>\
                  <span class="s2">&quot;doesn&#39;t work for a &#39;face-on&#39; disk.&quot;</span><span class="p">)</span>   
    <span class="n">mode_iso</span> <span class="o">=</span> <span class="s1">&#39;Padova&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;mode_iso&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">mode_iso</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">]</span>
    <span class="n">Magsun</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;U&#39;</span><span class="p">:</span><span class="mf">5.61</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="mf">5.44</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">:</span><span class="mf">4.81</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">:</span><span class="mf">4.1</span><span class="p">,</span><span class="s1">&#39;K&#39;</span><span class="p">:</span><span class="mf">3.27</span><span class="p">,</span>
              <span class="s1">&#39;GBP_EDR3&#39;</span><span class="p">:</span><span class="mf">5.0</span><span class="p">,</span><span class="s1">&#39;GRP_EDR3&#39;</span><span class="p">:</span><span class="mf">4.18</span><span class="p">,</span><span class="s1">&#39;G_EDR3&#39;</span><span class="p">:</span><span class="mf">4.67</span><span class="p">}</span>
    <span class="n">Lsun_bol</span> <span class="o">=</span> <span class="mi">1</span>            <span class="c1"># In Solar units </span>
    <span class="n">Msun_bol</span> <span class="o">=</span> <span class="mf">4.74</span>         <span class="c1"># In mag </span>
    <span class="n">Lsun</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">Lsun_bol</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="n">Msun_bol</span> <span class="o">-</span> <span class="n">Magsun</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Magsun</span><span class="p">}</span>
    <span class="c1"># look here: http://mips.as.arizona.edu/~cnaw/sun.html</span>
    
    <span class="n">popname</span> <span class="o">=</span> <span class="s1">&#39;ssp&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;mode_pop&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">popname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">!=</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
                <span class="n">tabd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tabd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tabd</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">(</span><span class="n">popname</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span>
                                   <span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span> 
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
            <span class="n">goodd</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabd</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">goodd</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabd</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">!=</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
                <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tabt</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">(</span><span class="n">popname</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
                                   <span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span> 
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
            <span class="n">goodt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabt</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">goodt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabt</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">!=</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
                <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tabt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="p">[</span><span class="n">tab_reader</span><span class="p">(</span><span class="n">popname</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span>
                                   <span class="n">mode_iso</span><span class="o">=</span><span class="n">mode_iso</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">]</span> 
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
            <span class="n">goodsh</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabsh</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">goodsh</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">&gt;-</span><span class="mi">15</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tabsh</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">mode_geom</span><span class="o">==</span><span class="s1">&#39;edge-on&#39;</span><span class="p">:</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Volume</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">zcut</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>
        <span class="n">sum_Nzd</span><span class="p">,</span> <span class="n">sum_Nzt</span><span class="p">,</span> <span class="n">sum_Nzsh</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span> 
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="n">sum_Nzd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">volume</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
                <span class="n">sum_Nzt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">volume</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="n">sum_Nzsh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">volume</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabsh</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
                
    <span class="n">profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
        <span class="n">bands_str</span> <span class="o">=</span> <span class="n">bands</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bands_str</span><span class="p">,</span> <span class="n">bands_str1</span> <span class="o">=</span> <span class="n">bands</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
        <span class="n">Nz_tot</span><span class="p">,</span> <span class="n">tab_tot</span><span class="p">,</span> <span class="n">tab_tot1</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="c1"># FACE-ON</span>
        <span class="c1">#--------------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">mode_geom</span><span class="o">==</span><span class="s1">&#39;face-on&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>        
                <span class="n">Nz_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">][</span><span class="n">goodd</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">tab_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">bands_str</span><span class="p">][</span><span class="n">goodd</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
                    <span class="n">tab_tot1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">bands_str1</span><span class="p">][</span><span class="n">goodd</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>     
                <span class="n">Nz_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">][</span><span class="n">goodt</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">tab_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">bands_str</span><span class="p">][</span><span class="n">goodt</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
                    <span class="n">tab_tot1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">bands_str1</span><span class="p">][</span><span class="n">goodt</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="n">Nz_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabsh</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">][</span><span class="n">goodsh</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">tab_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabsh</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">bands_str</span><span class="p">][</span><span class="n">goodsh</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>  
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
                    <span class="n">tab_tot1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabsh</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">bands_str1</span><span class="p">][</span><span class="n">goodsh</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>  
        <span class="c1"># EDGE-ON</span>
        <span class="c1">#--------------------------------------------------------------------------</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="o">-</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">Nz_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sum_Nzd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">goodd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span>
                    <span class="n">tab_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">bands_str</span><span class="p">][</span><span class="n">goodd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span> 
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
                        <span class="n">tab_tot1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">bands_str1</span><span class="p">][</span><span class="n">goodd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span> 
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
                    <span class="n">Nz_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sum_Nzt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">goodt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span>
                    <span class="n">tab_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">bands_str</span><span class="p">][</span><span class="n">goodt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span> 
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
                        <span class="n">tab_tot1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">bands_str1</span><span class="p">][</span><span class="n">goodt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span> 
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                    <span class="n">Nz_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sum_Nzsh</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">goodsh</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span>
                    <span class="n">tab_tot</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabsh</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">bands_str</span><span class="p">][</span><span class="n">goodsh</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span> 
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
                        <span class="n">tab_tot1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tabsh</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">][</span><span class="n">bands_str1</span><span class="p">][</span><span class="n">goodsh</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">]])</span> 
        <span class="n">Nz_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Nz_tot</span><span class="p">)</span>
        <span class="n">tab_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tab_tot</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
            <span class="c1"># Brightness profile</span>
            <span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Magsun</span><span class="p">[</span><span class="n">bands</span><span class="p">]</span> <span class="o">+</span> <span class="mf">21.572</span> <span class="o">-</span> <span class="mf">2.5</span><span class="o">*</span>\
                         <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_tot</span><span class="o">*</span><span class="n">Lsun</span><span class="p">[</span><span class="n">bands</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">0.4</span><span class="o">*</span><span class="p">(</span><span class="n">Magsun</span><span class="p">[</span><span class="n">bands</span><span class="p">]</span><span class="o">-</span><span class="n">tab_tot</span><span class="p">))))</span>  
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Colour profile</span>
            <span class="n">tab_tot1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tab_tot1</span><span class="p">)</span>
            <span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_tot</span><span class="o">*</span><span class="p">(</span><span class="n">tab_tot</span><span class="o">-</span><span class="n">tab_tot1</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Nz_tot</span><span class="p">)</span>
                                                                                       
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">disk_brightness_save</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">mode_geom</span><span class="p">,</span><span class="n">bands</span><span class="p">)</span>  
        
    <span class="k">return</span> <span class="n">profile</span></div>
  
    
<div class="viewcode-block" id="rz_map"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.rz_map">[docs]</a><span class="k">def</span> <span class="nf">rz_map</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mass (or number) density map in R and z Galactic coordinates. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total).</span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.rz_map_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. </span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]</span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str </span>
<span class="sd">    :param ages: Optional. Set of age bins, Gyr. </span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param mets: Optional. Set of metallicity bins.</span>
<span class="sd">    :type mets: array-like</span>
<span class="sd">    :param dz: Optional. Vertical resolution, pc. </span>
<span class="sd">    :type dz: scalar</span>

<span class="sd">    :return: Map of stellar mass or number density in Galactic coordinates.</span>
<span class="sd">    :rtype: 2d-array        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mets&#39;</span><span class="p">,</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;RZ-density map&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">dz</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># pc</span>
    <span class="k">if</span> <span class="s1">&#39;dz&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span>        
        
    <span class="n">z_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">zmax</span><span class="p">,</span><span class="n">dz</span><span class="p">)</span>
    <span class="n">zbins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_edges</span><span class="p">)</span>
    <span class="n">rz_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">zbins</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">z_coef</span> <span class="o">=</span> <span class="n">dz</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">rhoz</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">rhoz</span> <span class="o">=</span> <span class="n">rhoz_monomet</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">rhoz</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">tp</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                        <span class="n">kwargs_calcd</span><span class="p">,</span> <span class="n">kwargs_calct</span> <span class="o">=</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                            <span class="n">kwargs_calcd</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">kwargs_calct</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">rhozd</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">rhozt</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                        <span class="n">kwargs_calcd</span><span class="p">,</span> <span class="n">kwargs_calct</span> <span class="o">=</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                            <span class="n">kwargs_calcd</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">kwargs_calct</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">rhozd</span> <span class="o">=</span> <span class="n">rhoz_monomet</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">rhozt</span> <span class="o">=</span> <span class="n">rhoz_monomet</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                    <span class="n">kwargs_calcd</span><span class="p">,</span> <span class="n">kwargs_calct</span> <span class="o">=</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                            <span class="n">kwargs_calcd</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">kwargs_calct</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">rhozd</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">tp</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">rhozt</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">tp</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rhozd</span><span class="p">[</span><span class="n">rhozd</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
                <span class="n">rhozt</span><span class="p">[</span><span class="n">rhozt</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
                <span class="n">rhoz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhozd</span><span class="p">,</span><span class="n">rhozt</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s1">&#39;mets&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                        <span class="n">kwargs_calcd</span><span class="p">,</span> <span class="n">kwargs_calct</span><span class="p">,</span> <span class="n">kwargs_calcsh</span> <span class="o">=</span>\
                                <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                            <span class="n">kwargs_calcd</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">kwargs_calct</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">kwargs_calcsh</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">rhozd</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">rhozt</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">rhozsh</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcsh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                        <span class="n">kwargs_calcd</span><span class="p">,</span> <span class="n">kwargs_calct</span><span class="p">,</span> <span class="n">kwargs_calcsh</span> <span class="o">=</span>\
                                <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                            <span class="n">kwargs_calcd</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">kwargs_calct</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">kwargs_calcsh</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">rhozd</span> <span class="o">=</span> <span class="n">rhoz_monomet</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">rhozt</span> <span class="o">=</span> <span class="n">rhoz_monomet</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">rhozsh</span> <span class="o">=</span> <span class="n">rhoz_monomet</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcsh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">])</span>
                    <span class="n">kwargs_calcd</span><span class="p">,</span> <span class="n">kwargs_calct</span><span class="p">,</span> <span class="n">kwargs_calcsh</span> <span class="o">=</span>\
                            <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kwargs_calc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="n">kwargs_calcd</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">kwargs_calct</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">kwargs_calcsh</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">rhozd</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">tp</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">rhozt</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">tp</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">rhozsh</span> <span class="o">=</span> <span class="n">rhoz_monoage</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">tp</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calcsh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rhozd</span><span class="p">[</span><span class="n">rhozd</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
                <span class="n">rhozt</span><span class="p">[</span><span class="n">rhozt</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">rhozsh</span><span class="p">[</span><span class="n">rhozsh</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">rhoz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhozd</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rhozt</span><span class="p">,</span><span class="n">rhozsh</span><span class="p">))</span>
                
        <span class="n">rz_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rhoz</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">z_coef</span><span class="p">):</span><span class="nb">int</span><span class="p">((</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">z_coef</span><span class="p">)])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">zbins</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">rhoz</span><span class="p">[</span><span class="n">rhoz</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">rz_map_save</span><span class="p">(</span><span class="n">rz_grid</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">)</span>  
    
    <span class="k">return</span> <span class="n">rz_grid</span></div>
    

<div class="viewcode-block" id="rz_map_quantity"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.rz_map_quantity">[docs]</a><span class="k">def</span> <span class="nf">rz_map_quantity</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">quantity</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates mean value of some quantity in R and z Galactic coordinates. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total).</span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param quantity: Name of the column in a stellar assemblies table to which </span>
<span class="sd">        the function has to be applied; for velocity dispersion use ``&#39;sigw&#39;``. </span>
<span class="sd">    :type quantity: str</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.rz_map_quantity_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table(s), parameter alternative to **mode_pop**. </span>
<span class="sd">        If **mode_comp** = ``&#39;tot&#39;``, **tab** must be [[*table_d,table_t,table_sh*]_ *rmin*,...,[*table_d,table_t,table_sh*]_ *rmax*], </span>
<span class="sd">        where *rmin* and *rmax* are ``p.Rmin`` and ``p.Rmax``. </span>
<span class="sd">    :type tab: list[astropy table] or list[list[astropy table]</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str     </span>
<span class="sd">    :param ages: Optional. Set of age bins, Gyr. </span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param mets: Optional. Set of metallicity bins.</span>
<span class="sd">    :type mets: array-like</span>
<span class="sd">    :param dz: Vertical resolution, pc. </span>
<span class="sd">    :type dz: scalar</span>

<span class="sd">    :return: Map of the chosen quantity in Galactic coordinates.</span>
<span class="sd">    :rtype: 2d-array        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;ages&#39;</span><span class="p">,</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;RZ-density map&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpcheck_age</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;dz&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">inpcheck_dz</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># pc</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
     
    <span class="n">z_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">zmax</span><span class="p">,</span><span class="n">dz</span><span class="p">)</span>
    <span class="n">zbins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_edges</span><span class="p">)</span>
    <span class="n">rz_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">,</span><span class="n">zbins</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">z_coef</span> <span class="o">=</span> <span class="n">dz</span><span class="o">//</span><span class="n">p</span><span class="o">.</span><span class="n">dz</span>
                
    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span><span class="s1">&#39;mets&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
                    <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kwargs_calc</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">Q_r</span> <span class="o">=</span> <span class="n">mean_quantity</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">zmax</span><span class="p">],</span><span class="n">quantity</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)</span>
        <span class="n">rz_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Q_r</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">z_coef</span><span class="p">):</span><span class="nb">int</span><span class="p">((</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">z_coef</span><span class="p">)])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">zbins</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">rz_map_quantity_save</span><span class="p">(</span><span class="n">rz_grid</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">quantity</span><span class="p">)</span>  
        
    <span class="k">return</span> <span class="n">rz_grid</span></div>

 
<div class="viewcode-block" id="fw_hist"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.fw_hist">[docs]</a><span class="k">def</span> <span class="nf">fw_hist</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    W-velocity distribution function at a given Galactocentric distance. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total).</span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param R: Galactocentric distance, kpc. </span>
<span class="sd">    :type R: scalar </span>
<span class="sd">    :param zlim: Range of heights [*zmin,zmax*], pc. </span>
<span class="sd">    :type zlim: array-like </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.fw_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param tab: Optional. Stellar assemblies table, parameter alternative to **mode_pop**. </span>
<span class="sd">        If mode_comp==&#39;tot&#39;, **tab** must be organized as a list of tables corresponding to this **R**:  </span>
<span class="sd">        [*table_d*,*table_t*,table_sh*]. </span>
<span class="sd">    :type tab: astropy table or list[astropy table] </span>
<span class="sd">    :param number: Optional. If True, calculated quantity is weighted by the spatial number density of stars (:math:`\mathrm{number \ pc^{-3}}`),</span>
<span class="sd">         not matter density (:math:`\mathrm{M_\odot \ pc^{-3}}`). Active only when **mode_pop** or **tab** is given. </span>
<span class="sd">    :type number: boolean</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str     </span>
<span class="sd">    :param ages: Optional. Set of age-bins, Gyr. </span>
<span class="sd">    :type ages: array-like</span>
<span class="sd">    :param mets: Optional. Set of metallicity bins. </span>
<span class="sd">    :type mets: array-like</span>
<span class="sd">    :param wmax: Maximum value of W-velocity, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">    :type wmax: scalar</span>
<span class="sd">    :param dw: Step in W-velocity, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">    :type dw: scalar</span>
<span class="sd">    </span>
<span class="sd">    :return: Normalized on area W-velocity distribution (histogram) and W-grid (bin centers), :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">    :rtype: [1d-array, 1d-array]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;dw&#39;</span><span class="p">,</span><span class="s1">&#39;wmax&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;ages&#39;</span><span class="p">,</span><span class="s1">&#39;mets&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">ln</span><span class="p">,</span> <span class="n">mode_comp</span> <span class="o">=</span> <span class="n">inpcheck_mode_comp</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span>
                                       <span class="s1">&#39;f(|W|) distribution&#39;</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">wmax</span> <span class="o">=</span> <span class="mi">60</span> 
    <span class="k">if</span> <span class="s1">&#39;wmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">wmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;wmax&#39;</span><span class="p">]</span>        
    <span class="k">if</span> <span class="s1">&#39;dw&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">dw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dw&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dw&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dw</span> <span class="o">=</span> <span class="mi">2</span> 
    <span class="n">wgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">wmax</span><span class="o">+</span><span class="n">dw</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">dw</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">-</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">//</span><span class="n">tr</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">-</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">//</span><span class="n">tr</span>
        <span class="n">indt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i2</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;indt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indt</span>
    
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">fwhist</span> <span class="o">=</span> <span class="n">_fw_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">fwhist</span> <span class="o">=</span> <span class="n">_fw_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span><span class="p">:</span>
        <span class="n">fwhist</span> <span class="o">=</span> <span class="n">_fw_sh_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">fwhist_d</span> <span class="o">=</span> <span class="n">_fw_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">fwhist_t</span> <span class="o">=</span> <span class="n">_fw_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fwhist_d</span> <span class="o">=</span> <span class="n">_fw_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fwhist_t</span> <span class="o">=</span> <span class="n">_fw_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fwhist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fwhist_d</span><span class="p">,</span><span class="n">fwhist_t</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;tab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tabs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tab&#39;</span><span class="p">]</span>
            <span class="n">fwhist_d</span> <span class="o">=</span> <span class="n">_fw_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">fwhist_t</span> <span class="o">=</span> <span class="n">_fw_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fwhist_sh</span> <span class="o">=</span> <span class="n">_fw_sh_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fwhist_d</span> <span class="o">=</span> <span class="n">_fw_d_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fwhist_t</span> <span class="o">=</span> <span class="n">_fw_t_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fwhist_sh</span> <span class="o">=</span> <span class="n">_fw_sh_</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="n">wgrid</span><span class="p">,</span><span class="n">dw</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fwhist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fwhist_d</span><span class="p">,</span><span class="n">fwhist_t</span><span class="p">),</span><span class="n">fwhist_sh</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fwhist</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">fwhist</span> <span class="o">=</span> <span class="n">fwhist</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fwhist</span><span class="o">*</span><span class="n">dw</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">fw_save</span><span class="p">((</span><span class="n">fwhist</span><span class="p">,</span><span class="n">wgrid</span><span class="p">),</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">zlim</span><span class="p">)</span>  
      
    <span class="k">return</span> <span class="p">(</span><span class="n">fwhist</span><span class="p">,</span> <span class="n">wgrid</span><span class="p">)</span></div>


<div class="viewcode-block" id="hess_simple"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.hess_simple">[docs]</a><span class="k">def</span> <span class="nf">hess_simple</span><span class="p">(</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">mode_geom</span><span class="p">,</span><span class="n">bands</span><span class="p">,</span><span class="n">mag_range</span><span class="p">,</span><span class="n">mag_step</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hess diagram for the simple volumes. </span>
<span class="sd">    </span>
<span class="sd">    :param mode_comp: Galactic component, can be ``&#39;d&#39;``, ``&#39;t&#39;``, ``&#39;sh&#39;``, ``&#39;dt&#39;``, or ``&#39;tot&#39;`` </span>
<span class="sd">        (thin disk, thick disk, halo, thin+thick disk, or total).</span>
<span class="sd">    :type mode_comp: str</span>
<span class="sd">    :param mode_geom: Modeled geometry. Can be ``&#39;local_sphere&#39;``, ``&#39;local_cylinder&#39;``, or ``&#39;rphiz_box&#39;``. </span>
<span class="sd">    :type mode_geom: str</span>
<span class="sd">    :param bands: List of names of photometric columns. </span>
<span class="sd">        Three column names must be given, e.g. ``[&#39;B&#39;,&#39;V&#39;,&#39;V&#39;]`` for (*B-V*) versus :math:`M_\mathrm{V}`. </span>
<span class="sd">    :type bands: list[str]</span>
<span class="sd">    :param mag_range: Minimal and maximal magnitude along the x- and y-axis of the Hess </span>
<span class="sd">        diagram, [[*x_min,x_max*],[*y_min,y_max*]]. </span>
<span class="sd">    :type mag_range: list[list[scalar]]</span>
<span class="sd">    :param mag_step: Step along the x- and y-axis of the Hess diagram, [*dx,dy*]. </span>
<span class="sd">    :type mag_step: array-like</span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.hess_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param mode_pop: Optional. Name of stellar population. Can be a pre-defined one </span>
<span class="sd">        (``&#39;a&#39;``, ``&#39;f&#39;``, ``&#39;ceph&#39;``, ``&#39;rc&#39;``, ``&#39;rc+&#39;``, ``&#39;gdw&#39;``, ``&#39;kdw&#39;``, ``&#39;mdw&#39;``) or custom </span>
<span class="sd">        (if it was selected and saved as a table in advance). </span>
<span class="sd">    :type mode_pop: str</span>
<span class="sd">    :param mode_iso: Optional. Defines which set of isochrones is used, can be ``&#39;Padova&#39;``, ``&#39;MIST&#39;``, or ``&#39;BaSTI&#39;``. </span>
<span class="sd">        If not specified, Padova is the default isochrone set. </span>
<span class="sd">    :type mode_iso: str</span>
<span class="sd">    :param r_minmax: Optional. Minimal and maximal radius of the spherical shell if **mode_geom** is ``&#39;sphere&#39;`` </span>
<span class="sd">        or minimal and maximal radius of the cylindrical shell if **mode_geom** is ``&#39;cylinder&#39;``, pc.   </span>
<span class="sd">    :type r_minmax: array-like</span>
<span class="sd">    :param R_minmax: Optional. Minimal and maximal Galactocentric distance if **mode_geom** is ``&#39;rphiz_box&#39;``, kpc. </span>
<span class="sd">    :type R_minmax: array-like</span>
<span class="sd">    :param dphi: Optional. Minimal and maximal Galactic angle :math:`\\phi` if **mode_geom** is &#39;rphiz_box&#39;, deg.</span>
<span class="sd">    :type dphi: array-like</span>
<span class="sd">    :param smooth: Optional. Width of the smoothing window in x and y, mag. </span>
<span class="sd">    :type smooth: array-like</span>
<span class="sd">    :param zlim: Optional. Range of heights [*zmim,zmax*] to be considered, pc.</span>
<span class="sd">    :type zlim: array-like</span>

<span class="sd">    :return: Hess diagram. </span>
<span class="sd">    :rtype: 2d-array </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;zlim&#39;</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">,</span><span class="s1">&#39;R_minmax&#39;</span><span class="p">,</span><span class="s1">&#39;dphi&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;smooth&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">inpcheck_kwargs_compatibility</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">this_function</span><span class="p">)</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">zmax</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">zlim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
    <span class="n">mode_iso</span> <span class="o">=</span> <span class="s1">&#39;Padova&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;mode_iso&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">mode_iso</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">]</span>
    
    <span class="n">V</span> <span class="o">=</span> <span class="n">Volume</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode_geom</span><span class="o">==</span><span class="s1">&#39;local_sphere&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">run_mode</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">volume</span><span class="p">,</span> <span class="n">vln</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">local_sphere</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">volume</span><span class="p">,</span> <span class="n">indrs</span><span class="p">,</span> <span class="n">vln</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">local_sphere</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
    <span class="k">if</span> <span class="n">mode_geom</span><span class="o">==</span><span class="s1">&#39;local_cylinder&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">run_mode</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">volume</span><span class="p">,</span> <span class="n">vln</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">local_cylinder</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                           <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">volume</span><span class="p">,</span> <span class="n">indrs</span><span class="p">,</span> <span class="n">vln</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">local_cylinder</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;r_minmax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                  <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">mode_geom</span><span class="o">==</span><span class="s1">&#39;rphiz_box&#39;</span><span class="p">:</span>
        <span class="n">volume</span><span class="p">,</span> <span class="n">indrs</span><span class="p">,</span> <span class="n">vln</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">rphiz_box</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R_minmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R_minmax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dphi&#39;</span><span class="p">],</span>
                                    <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">run_mode</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabd</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                              <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">),</span><span class="s1">&#39;_d_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabt</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">),</span><span class="s1">&#39;_t_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                              <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">),</span><span class="s1">&#39;_sh_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabd</span> <span class="o">=</span> <span class="p">[</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;_d_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">indrs</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabt</span> <span class="o">=</span> <span class="p">[</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;_t_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">indrs</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">tabsh</span> <span class="o">=</span> <span class="p">[</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s1">&#39;poptab&#39;</span><span class="p">],</span>
                      <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;SSP_R&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;_sh_&#39;</span><span class="p">,</span><span class="n">mode_iso</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">))))</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">indrs</span><span class="p">]]</span>        

    <span class="n">sum_Nz</span><span class="p">,</span> <span class="n">mag</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[]]</span>
    <span class="n">kwargs_calc</span> <span class="o">=</span> <span class="n">reduce_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;mode_pop&#39;</span><span class="p">,</span><span class="s1">&#39;mode_iso&#39;</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">run_mode</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">sum_Nz</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">_extend_mag_</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">tabd</span><span class="p">,</span><span class="n">bands</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">sum_Nz</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">_extend_mag_</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">tabt</span><span class="p">,</span><span class="n">bands</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
            <span class="n">sum_Nz</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="n">tabsh</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">_extend_mag_</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">tabsh</span><span class="p">,</span><span class="n">bands</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indrs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="n">sum_Nz</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">indrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">volume</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span>
                                             <span class="n">tab</span><span class="o">=</span><span class="n">tabd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="n">_extend_mag_</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">tabd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">bands</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;dt&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="n">sum_Nz</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">indrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">volume</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span>
                                             <span class="n">tab</span><span class="o">=</span><span class="n">tabt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="n">_extend_mag_</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">tabt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">bands</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;sh&#39;</span> <span class="ow">or</span> <span class="n">mode_comp</span><span class="o">==</span><span class="s1">&#39;tot&#39;</span><span class="p">:</span>
                <span class="n">sum_Nz</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pops_in_volume</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">indrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">volume</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span>
                                             <span class="n">tab</span><span class="o">=</span><span class="n">tabsh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs_calc</span><span class="p">)[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="n">_extend_mag_</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">tabsh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">bands</span><span class="p">)</span>
    <span class="n">sum_Nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sum_Nz</span><span class="p">)</span>
    
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">mag_step</span>
    <span class="n">xlen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">mag_range</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">mag_range</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">mag_step</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">0</span><span class="p">))</span> 
    <span class="n">ylen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">mag_range</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">mag_range</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">mag_step</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="n">hess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xlen</span><span class="p">,</span><span class="n">ylen</span><span class="p">))</span>
    <span class="n">hess</span> <span class="o">=</span> <span class="n">histogram2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">mag</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">mag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">weights</span><span class="o">=</span><span class="n">sum_Nz</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">xlen</span><span class="p">,</span><span class="n">ylen</span><span class="p">],</span><span class="nb">range</span><span class="o">=</span><span class="n">mag_range</span><span class="p">)</span>               
    <span class="k">if</span> <span class="s1">&#39;smooth&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">hess</span> <span class="o">=</span> <span class="n">convolve2d_gauss</span><span class="p">(</span><span class="n">hess</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;smooth&#39;</span><span class="p">],</span><span class="n">mag_range</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">vln</span><span class="o">=</span><span class="n">vln</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">hess_save</span><span class="p">(</span><span class="n">hess</span><span class="p">,</span><span class="n">mode_comp</span><span class="p">,</span><span class="n">mode_geom</span><span class="p">,</span><span class="n">bands</span><span class="p">,</span><span class="n">mag_range</span><span class="p">,</span><span class="n">mag_step</span><span class="p">)</span> 
    
    <span class="k">return</span> <span class="n">hess</span><span class="o">.</span><span class="n">T</span></div>


<div class="viewcode-block" id="fi_iso"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.fi_iso">[docs]</a><span class="k">def</span> <span class="nf">fi_iso</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the normalized vertical gravitational potential as </span>
<span class="sd">    a function of Galactocentric distance.</span>
<span class="sd">    </span>
<span class="sd">    :param ah: DM scaling parameter, kpc. </span>
<span class="sd">    :type ah: scalar </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.fi_iso_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    </span>
<span class="sd">    :return: Total graviatational potential. </span>
<span class="sd">    :rtype: 2d-array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>
    
    <span class="n">Phi</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Phi&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">sigma_r</span><span class="p">,</span> <span class="n">sigma_r0</span> <span class="o">=</span> <span class="n">rhor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rho_r</span><span class="p">,</span> <span class="n">rho_r0</span> <span class="o">=</span> <span class="n">rhor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
    <span class="n">FiR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">))</span>
    
    <span class="n">fi_r</span> <span class="o">=</span> <span class="n">RadialPotential</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
    
    <span class="n">ind_hole_g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rg10</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rg10</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ind_hole_g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rg20</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Rg20</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">FiR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fi_r</span><span class="o">.</span><span class="n">exp_disk</span><span class="p">(</span><span class="n">sigma_r0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rd</span><span class="p">),</span><span class="n">p</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span>
    <span class="n">FiR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fi_r</span><span class="o">.</span><span class="n">exp_disk</span><span class="p">(</span><span class="n">sigma_r0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rt</span><span class="p">),</span><span class="n">p</span><span class="o">.</span><span class="n">Rt</span><span class="p">)</span>
    <span class="n">FiR</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">fi_r</span><span class="o">.</span><span class="n">exp_disk</span><span class="p">(</span><span class="n">sigma_r0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rg1</span><span class="p">),</span><span class="n">p</span><span class="o">.</span><span class="n">Rg1</span><span class="p">)</span>
    <span class="n">FiR</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">fi_r</span><span class="o">.</span><span class="n">exp_disk</span><span class="p">(</span><span class="n">sigma_r0</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">Rg2</span><span class="p">),</span><span class="n">p</span><span class="o">.</span><span class="n">Rg2</span><span class="p">)</span>
    <span class="c1"># No gas in the center</span>
    <span class="n">FiR</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="n">ind_hole_g1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">FiR</span><span class="p">[</span><span class="mi">3</span><span class="p">][:</span><span class="n">ind_hole_g2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">FiR</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">fi_r</span><span class="o">.</span><span class="n">cored_iso_sphere</span><span class="p">(</span><span class="n">rho_r0</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">ah</span><span class="p">)</span>
    <span class="n">FiR</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">fi_r</span><span class="o">.</span><span class="n">pow_law</span><span class="p">(</span><span class="n">rho_r0</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
    <span class="n">FiR_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">FiR</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">Phi</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">FiR_tot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Rbins</span><span class="p">)]</span>
    
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">fi_iso_save</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> 
    
    <span class="k">return</span> <span class="n">Phi</span></div>


<div class="viewcode-block" id="rot_curve"><a class="viewcode-back" href="../../analysis.html#jjmodel.analysis.rot_curve">[docs]</a><span class="k">def</span> <span class="nf">rot_curve</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculatess the circular velocity :math:`\\upsilon_\mathrm{c}` as a function of </span>
<span class="sd">    Galactocentric distance.</span>
<span class="sd">    </span>
<span class="sd">    :param ah: DM scaling parameter, kpc. </span>
<span class="sd">    :type ah: scalar </span>
<span class="sd">    :param p: Set of model parameters from the parameter file. </span>
<span class="sd">    :type p: namedtuple</span>
<span class="sd">    :param a: Collection of the fixed model parameters, useful quantities, and arrays.</span>
<span class="sd">    :type a: namedtuple</span>
<span class="sd">    :param save: Optional. If True, the calculated quantities are saved as tables  </span>
<span class="sd">        to the output directory. The output path and table name are predcribed by </span>
<span class="sd">        :meth:`jjmodel.iof.TabSaver.rot_curve_save`.  </span>
<span class="sd">    :type save: boolean</span>
<span class="sd">    :param R: Radial grid, kpc. </span>
<span class="sd">    :type R: array-like</span>
<span class="sd">    </span>
<span class="sd">    :return: Galactic rotation curve, :math:`\mathrm{km / s^{-1}}`. </span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_function</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inpcheck_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">],</span><span class="n">this_function</span><span class="p">)</span>

    <span class="n">Hdh0</span><span class="p">,</span><span class="n">Hsh0</span> <span class="o">=</span> <span class="n">tab_reader</span><span class="p">([</span><span class="s1">&#39;Hdh0&#39;</span><span class="p">,</span><span class="s1">&#39;Hsh0&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">rhodh0</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">sigmadh</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hdh0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rhosh0</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">sigmash</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">Hsh0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rmax</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> 
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
    
    <span class="n">RC</span> <span class="o">=</span> <span class="n">RotCurve</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span><span class="n">R</span><span class="p">)</span>
    <span class="n">vcd</span> <span class="o">=</span> <span class="n">RC</span><span class="o">.</span><span class="n">vc_disk</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigmad</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rd</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">vct</span> <span class="o">=</span> <span class="n">RC</span><span class="o">.</span><span class="n">vc_disk</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigmat</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rt</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">vcg1</span> <span class="o">=</span> <span class="n">RC</span><span class="o">.</span><span class="n">vc_disk</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigmag1</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rg1</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rg10</span><span class="p">)</span>
    <span class="n">vcg2</span> <span class="o">=</span> <span class="n">RC</span><span class="o">.</span><span class="n">vc_disk</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sigmag2</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rg2</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">Rg20</span><span class="p">)</span>
    <span class="n">vcb</span> <span class="o">=</span> <span class="n">RC</span><span class="o">.</span><span class="n">vc_bulge</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Mb</span><span class="p">)</span>
    <span class="n">vcdh</span> <span class="o">=</span> <span class="n">RC</span><span class="o">.</span><span class="n">vc_halo_cored_iso_sphere</span><span class="p">(</span><span class="n">rhodh0</span><span class="p">,</span><span class="n">ah</span><span class="p">)</span>
    <span class="c1">#vcsh = RC.vc_halo_power_law(rhosh0,-p.a_in)</span>
    
    <span class="n">vc</span> <span class="o">=</span> <span class="n">RC</span><span class="o">.</span><span class="n">vc_tot</span><span class="p">([</span><span class="n">vcb</span><span class="p">,</span><span class="n">vcd</span><span class="p">,</span><span class="n">vct</span><span class="p">,</span><span class="n">vcg1</span><span class="p">,</span><span class="n">vcg2</span><span class="p">,</span><span class="n">vcdh</span><span class="p">])</span>
    <span class="n">vc0</span> <span class="o">=</span> <span class="n">RC</span><span class="o">.</span><span class="n">vc0</span><span class="p">(</span><span class="n">vc</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">inpcheck_iskwargtype</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="n">this_function</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TabSaver</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">rot_curve_save</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">R</span><span class="p">,</span><span class="n">vc</span><span class="p">,</span><span class="n">vcb</span><span class="p">,</span><span class="n">vcd</span><span class="p">,</span><span class="n">vct</span><span class="p">,</span><span class="n">vcg1</span><span class="p">,</span><span class="n">vcg2</span><span class="p">,</span><span class="n">vcdh</span><span class="p">),</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span> 

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="n">vcd</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="n">vct</span><span class="p">,</span><span class="s1">&#39;g1&#39;</span><span class="p">:</span><span class="n">vcg1</span><span class="p">,</span><span class="s1">&#39;g2&#39;</span><span class="p">:</span><span class="n">vcg2</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">vcb</span><span class="p">,</span><span class="s1">&#39;dh&#39;</span><span class="p">:</span><span class="n">vcdh</span><span class="p">,</span>
            <span class="s1">&#39;tot&#39;</span><span class="p">:</span><span class="n">vc</span><span class="p">,</span><span class="s1">&#39;vc0&#39;</span><span class="p">:</span><span class="n">vc0</span><span class="p">}</span></div>
    
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">jjmodel</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../funcs.html">Physical functions (input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model_core.html">Radial and vertical MW structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../populations.html">Stellar populations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geometry.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trans.html">Coordinates and velocities (from data)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools.html">Useful tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iof.html">Input/output tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analysis.html">Output analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plotting.html">Plotting tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contacts.html">Authors and contact</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Sysoliatina.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>