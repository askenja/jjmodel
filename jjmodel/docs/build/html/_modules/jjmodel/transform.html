
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>jjmodel.transform &#8212; jjmodel 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for jjmodel.transform</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Wed Nov 23 14:18:20 2016</span>

<span class="sd">@author: skevja</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">astropy.coordinates</span> <span class="k">as</span> <span class="nn">coord</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>


<div class="viewcode-block" id="XVTrans"><a class="viewcode-back" href="../../trans.html#jjmodel.transform.XVTrans">[docs]</a><span class="k">class</span> <span class="nc">XVTrans</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for coordinate transformation and calculation of Galactocentric distances and velocities </span>
<span class="sd">    from astrometric parameters and radial velocities. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="XVTrans.__init__"><a class="viewcode-back" href="../../trans.html#jjmodel.transform.XVTrans.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">fileformat</span><span class="p">,</span><span class="n">gframe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization of the class instance is performed with reading the data table </span>
<span class="sd">        and specifying parameters of the Galactic coordinate system. </span>
<span class="sd">        </span>
<span class="sd">        :param filename: Name of the data file.  </span>
<span class="sd">        :type filename: str </span>
<span class="sd">        :param fileformat: Format of the file. </span>
<span class="sd">        :type fileformat: str </span>
<span class="sd">        :param gframe: Parameters describing the Galactic frame. Keys to specify are: </span>
<span class="sd">            </span>
<span class="sd">            - ``&#39;Rsun&#39;``: Solar radius, kpc</span>
<span class="sd">            - ``&#39;Zsun&#39;``: Solar distance from the Galactic plane, pc</span>
<span class="sd">            - ``&#39;Usun&#39;``, ``&#39;Vsun&#39;``, ``&#39;Wsun&#39;``: Cartesian components of the Solar peculiar velocity, :math:`\mathrm{km \ s^{-1}}` </span>
<span class="sd">            - ``&#39;eRsun&#39;``: Uncertainty of the Solar radius, kpc</span>
<span class="sd">            - ``&#39;eZsun&#39;``: Uncertainty of the Solar distance from the Galactic plane, pc</span>
<span class="sd">            - ``&#39;eUsun&#39;``, ``&#39;eVsun&#39;``, ``&#39;eWsun&#39;``: Uncertainties of the Solar peculiar velocity components, :math:`\mathrm{km \ s^{-1}}`</span>
<span class="sd">            - ``&#39;pm_sgrA&#39;``: Sgr A* proper motion, :math:`\mathrm{mas \ yr^{-1}}`</span>
<span class="sd">            - ``&#39;epm_sgrA&#39;``: Uncertainty of Sgr A* proper motion, :math:`\mathrm{mas \ yr^{-1}}`.</span>
<span class="sd">              </span>
<span class="sd">        :type gframe: dict </span>

<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            In all methods of this class the input quantities must be in the following units:</span>
<span class="sd">                </span>
<span class="sd">                - (ra, dec, era, edec) = [deg]</span>
<span class="sd">                - (pmra, pmdec, epmra, epmdec) = [mas/yr]</span>
<span class="sd">                - (par, epar) = [mas]</span>
<span class="sd">                - (vr, evr) = km/s</span>
<span class="sd">                - d = [pc]</span>
<span class="sd">                - (Usun, Vsun, Wsun, Vtsun) and their errors = km/s </span>
<span class="sd">                - (Rsun, eRsun) = [kpc] </span>
<span class="sd">                - (Zsun, eZsun) = [pc]</span>
<span class="sd">                </span>
<span class="sd">            Units of the output: </span>
<span class="sd">                </span>
<span class="sd">                - (l, b, phi, ephi) = [deg]</span>
<span class="sd">                - (X, Y, Z, eX, eY, eZ) = [pc] </span>
<span class="sd">                - (R, eR) = [kpc] </span>
<span class="sd">                - (U, V, W, eU, eV, eW, Vr, Vphi, eVr, eVphi) = [km/s] </span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileformat</span> <span class="o">=</span> <span class="n">fileformat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Usun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eRsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eZsun</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">eUsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eVsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eWsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm_sgrA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epm_sgrA</span> <span class="o">=</span> \
            <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;Rsun&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;Zsun&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;Usun&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;Vsun&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;Wsun&#39;</span><span class="p">],</span> \
            <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;eRsun&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;eZsun&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;eUsun&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;eVsun&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;eWsun&#39;</span><span class="p">],</span> \
            <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;pm_sgrA&#39;</span><span class="p">],</span> <span class="n">gframe</span><span class="p">[</span><span class="s1">&#39;epm_sgrA&#39;</span><span class="p">]</span>
        <span class="c1"># Calculation of tangential solar velocity from given Sgr A* proper motion and </span>
        <span class="c1"># solar Galactocentric distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vtsun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="mf">3.08</span><span class="o">*</span><span class="mf">1e16</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm_sgrA</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">/</span><span class="mi">31536000</span><span class="o">/</span><span class="mi">3600</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eVtsun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eRsun</span><span class="o">*</span><span class="mf">3.08</span><span class="o">*</span><span class="mf">1e16</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm_sgrA</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">/</span><span class="mi">31536000</span><span class="o">/</span><span class="mi">3600</span><span class="p">)))</span><span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> \
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="mf">3.08</span><span class="o">*</span><span class="mf">1e16</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm_sgrA</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">/</span><span class="mi">31536000</span><span class="o">/</span><span class="mi">3600</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epm_sgrA</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">/</span><span class="mi">31536000</span><span class="o">/</span><span class="mi">3600</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_sun</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">CartesianDifferential</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Usun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vsun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wsun</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Input parameters:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">gframe</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Reading data...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileformat</span><span class="p">)),</span><span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileformat</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileformat</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ok.</span><span class="se">\n\n</span><span class="s1">Table columns:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span></div>


<div class="viewcode-block" id="XVTrans.calc_3d_gal"><a class="viewcode-back" href="../../trans.html#jjmodel.transform.XVTrans.calc_3d_gal">[docs]</a>    <span class="k">def</span> <span class="nf">calc_3d_gal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates Galactic coordinates (Cartesian and cylindrical). </span>
<span class="sd">        If parallax column is used, distances are calculated as 1/parallax. </span>
<span class="sd">        </span>
<span class="sd">        :param names: Names of columns for the following quantities: </span>
<span class="sd">            </span>
<span class="sd">            - ``&#39;ra&#39;``: right ascention, deg </span>
<span class="sd">            - ``&#39;dec&#39;``: declination, deg</span>
<span class="sd">            - ``&#39;dpc&#39;`` or ``&#39;dkpc&#39;``: heliocentric distance, pc or kpc </span>
<span class="sd">            - ``&#39;parallax&#39;``: parallax, can be given instead of the distance column, mas.</span>
<span class="sd">            </span>
<span class="sd">        :type names: dict</span>
<span class="sd">            </span>
<span class="sd">        :return: None. </span>
<span class="sd">            </span>
<span class="sd">            Adds columns to the table:  </span>
<span class="sd">            </span>
<span class="sd">            - ``&#39;d&#39;``: Heliocentric distance (if parallax column is given as an input). </span>
<span class="sd">            - (``&#39;l&#39;``, ``&#39;b&#39;``): Galactic longitude and latitude </span>
<span class="sd">            - (``&#39;x&#39;``, ``&#39;y&#39;``, ``&#39;z&#39;``): 3d Cartesian coordinates in a frame located at the Solar position </span>
<span class="sd">              (projected on the midplane), x-axis points to the Galactic center, y corresponds to l=90 deg, </span>
<span class="sd">              z-axis points to the northern Galactic pole</span>
<span class="sd">            - (``&#39;rg&#39;``, ``&#39;phi&#39;``): Galactocentric cylindrical coordinates </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculation of Galactic coordinates:&#39;</span><span class="p">)</span>
        <span class="c1"># Define Galactic frame from the given solar position {Rsun,Zsun}</span>
        <span class="k">with</span> <span class="n">coord</span><span class="o">.</span><span class="n">galactocentric_frame_defaults</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;v4.0&#39;</span><span class="p">):</span>
            <span class="n">gc_frame</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">Galactocentric</span><span class="p">(</span><span class="n">galcen_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span> <span class="n">z_sun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Zsun</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;dpc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;dkpc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;parallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;dpc&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dpc&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;dkpc&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dkpc&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mi">1000</span>
            <span class="k">if</span> <span class="s1">&#39;parallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;parallax&#39;</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: give helio_distance[pc or kpc] or parallax[mas] column!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">ICRS coords array...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">c_icrs1</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">ICRS</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>\
               <span class="n">dec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span><span class="n">distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span>
              
        <span class="n">c_icrs2</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> \
                                                <span class="n">distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">created. </span><span class="se">\n\t</span><span class="s1">Transformation to Galactic...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        
        <span class="n">c_gal1</span> <span class="o">=</span> <span class="n">c_icrs1</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">gc_frame</span><span class="p">)</span>
        <span class="n">c_gal2</span> <span class="o">=</span> <span class="n">c_icrs2</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">gc_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">c_gal2</span><span class="o">.</span><span class="n">galactic</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">c_gal2</span><span class="o">.</span><span class="n">galactic</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">c_gal1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">c_gal1</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">c_gal1</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">value</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">done. </span><span class="se">\n\t</span><span class="s1">Transformation to cylindrical...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="c1"># in kpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1"># output to the table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span>
        <span class="k">if</span> <span class="s1">&#39;parallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">/</span><span class="mi">1000</span> <span class="c1"># in kpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="XVTrans.calc_6d_gal"><a class="viewcode-back" href="../../trans.html#jjmodel.transform.XVTrans.calc_6d_gal">[docs]</a>    <span class="k">def</span> <span class="nf">calc_6d_gal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates Galactic coordinates (Cartesian and cylindrical). </span>
<span class="sd">        If parallax column is used, distances are calculated as 1/parallax. </span>
<span class="sd">        </span>
<span class="sd">        :param names: Names of columns for the following quantities: </span>
<span class="sd">            </span>
<span class="sd">            - ``&#39;ra&#39;``: right ascention, deg </span>
<span class="sd">            - ``&#39;dec&#39;``: declination, deg</span>
<span class="sd">            - ``&#39;dpc&#39;`` or ``&#39;dkpc&#39;``: heliocentric distance, pc or kpc </span>
<span class="sd">            - ``&#39;parallax&#39;``: parallax, can be given instead of the distance column, mas</span>
<span class="sd">            - ``&#39;pmra&#39;``: proper motion in right ascention, :math:`\mathrm{mas \ yr^{-1}}`</span>
<span class="sd">            - ``&#39;pmdec&#39;``: proper motion in right declination, :math:`\mathrm{mas \ yr^{-1}}`</span>
<span class="sd">            - ``&#39;vr&#39;``: radial velocity, :math:`\mathrm{km \ s^{-1}}`. </span>
<span class="sd">            </span>
<span class="sd">        :type names: dict</span>
<span class="sd">        </span>
<span class="sd">        :return: None. </span>
<span class="sd">        </span>
<span class="sd">            Adds columns to the table:  </span>
<span class="sd">            </span>
<span class="sd">            - ``&#39;d&#39;``: Heliocentric distance (if parallax column is given as an input). </span>
<span class="sd">            - (``&#39;l&#39;``, ``&#39;b&#39;``): Galactic longitude and latitude </span>
<span class="sd">            - (``&#39;x&#39;``, ``&#39;y&#39;``, ``&#39;z&#39;``): 3d Cartesian coordinates in a frame located at the Solar position </span>
<span class="sd">              (projected on the midplane), x-axis points to the Galactic center, y corresponds to l=90 deg, </span>
<span class="sd">              z-axis points to the northern Galactic pole</span>
<span class="sd">            - (``&#39;rg&#39;``, ``&#39;phi&#39;``): Galactocentric cylindrical coordinates </span>
<span class="sd">            - (``&#39;U&#39;``, ``&#39;V&#39;``, ``&#39;W&#39;``): 3d Cartesian velocity components (relative to LSR)</span>
<span class="sd">            - (``&#39;Vr&#39;``, ``&#39;Vphi&#39;``): Galactocentric velocities in cylindrical coordinates (the 3-rd component is W)</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculation of Galactic coordinates and velocities:&#39;</span><span class="p">)</span>
        <span class="c1"># Define Galactic frame from the given solar position {Rsun,Zsun}, </span>
        <span class="c1"># solar peculiar motion(relative to LSR) and solar tangential velocity (SgrA* proper motion)</span>
        <span class="k">with</span> <span class="n">coord</span><span class="o">.</span><span class="n">galactocentric_frame_defaults</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;v4.0&#39;</span><span class="p">):</span>
            <span class="n">gc_frame</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">Galactocentric</span><span class="p">(</span><span class="n">galcen_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span> <span class="n">z_sun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Zsun</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span>
                                        <span class="n">galcen_v_sun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">v_sun</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;dpc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;dkpc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;parallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;dpc&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dpc&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;dkpc&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dkpc&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mi">1000</span>
            <span class="k">if</span> <span class="s1">&#39;parallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;parallax&#39;</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: give helio_distance[pc or kpc] or parallax[mas] column!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">ICRS coords array...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">c_icrs1</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">ICRS</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
               <span class="n">dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
               <span class="n">distance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span>
               <span class="n">pm_ra_cosdec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;pmra&#39;</span><span class="p">]])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
               <span class="n">pm_dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;pmdec&#39;</span><span class="p">]])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
               <span class="n">radial_velocity</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">c_icrs2</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> 
                                 <span class="n">dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> 
                                 <span class="n">distance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span><span class="n">frame</span><span class="o">=</span><span class="s1">&#39;icrs&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">created. </span><span class="se">\n\t</span><span class="s1">Transformation to Galactic...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        
        <span class="n">c_gal1</span> <span class="o">=</span> <span class="n">c_icrs1</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">gc_frame</span><span class="p">)</span>
        <span class="n">c_gal2</span> <span class="o">=</span> <span class="n">c_icrs2</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">gc_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">c_gal2</span><span class="o">.</span><span class="n">galactic</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">c_gal2</span><span class="o">.</span><span class="n">galactic</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">c_gal1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">c_gal1</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">c_gal1</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">c_gal1</span><span class="o">.</span><span class="n">v_x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">c_gal1</span><span class="o">.</span><span class="n">v_y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">c_gal1</span><span class="o">.</span><span class="n">v_z</span><span class="o">.</span><span class="n">value</span>   
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">done. </span><span class="se">\n\t</span><span class="s1">Transformation to cylindrical...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="c1"># in kpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Vtsun</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Vtsun</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1"># output to the table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span>
        <span class="k">if</span> <span class="s1">&#39;parallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">/</span><span class="mi">1000</span> <span class="c1"># in kpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Vr&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Vphi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Vphi</span></div>


<div class="viewcode-block" id="XVTrans.calc_3d_err"><a class="viewcode-back" href="../../trans.html#jjmodel.transform.XVTrans.calc_3d_err">[docs]</a>    <span class="k">def</span> <span class="nf">calc_3d_err</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculation of the coordinate errors. </span>
<span class="sd">        Should be called only after :meth:`jjmodel.transform.XVTrans.calc_3d_gal` or </span>
<span class="sd">        :meth:`jjmodel.transform.XVTrans.calc_6d_gal`.</span>
<span class="sd">        </span>
<span class="sd">        :param names: Names of columns for the following quantities: </span>
<span class="sd">            </span>
<span class="sd">            - ``&#39;ra&#39;``: right ascention, deg </span>
<span class="sd">            - ``&#39;dec&#39;``: declination, deg</span>
<span class="sd">            - ``&#39;dpc&#39;`` or ``&#39;dkpc&#39;``: heliocentric distance, pc or kpc </span>
<span class="sd">            - ``&#39;parallax&#39;``: parallax, can be given instead of the distance column, mas</span>
<span class="sd">            - ``&#39;era&#39;``: error in right ascention, deg </span>
<span class="sd">            - ``&#39;edec&#39;``: error in declination, deg</span>
<span class="sd">            - ``&#39;edpc&#39;`` or ``&#39;edkpc&#39;``: error in heliocentric distance, pc or kpc </span>
<span class="sd">            - ``&#39;eparallax&#39;``: parallax error, can be given instead of the distance error column, mas.</span>
<span class="sd">            </span>
<span class="sd">        :type names: dict</span>
<span class="sd">            </span>
<span class="sd">        :return: None.  </span>
<span class="sd">            </span>
<span class="sd">            Adds columns to the table:  </span>
<span class="sd">            </span>
<span class="sd">            - ``&#39;ed&#39;``: Distance error (if parallax and parallax error are given)</span>
<span class="sd">            - (``&#39;ex&#39;``, ``&#39;ey&#39;``, ``&#39;ez&#39;``): Errors of 3d Cartesian coordinates </span>
<span class="sd">            - (``&#39;erg&#39;``, ``&#39;ephi&#39;``): Errors of Galactocentric cylindrical coordinates </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculation of the Galactic coordinate errors:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;edpc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;edkpc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;eparallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;edpc&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;edpc&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;edkpc&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;edkpc&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mi">1000</span>
            <span class="k">if</span> <span class="s1">&#39;eparallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;parallax&#39;</span><span class="p">]])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;eparallax&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: give errors of helio_distance[pc or kpc] or parallax[mas]!&#39;</span><span class="p">)</span>
                    
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Distance errors...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>        
        <span class="n">l1</span><span class="p">,</span><span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">eZsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="mf">1e3</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l1</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eRsun</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
                    <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l1</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-3</span> <span class="c1"># in kpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">*</span>\
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eR</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span><span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span><span class="o">//</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>    
        
        <span class="c1"># output to the table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ey&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eY</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eZ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;erg&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ephi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eR</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;eparallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edist</span></div>

       
<div class="viewcode-block" id="XVTrans.calc_6d_err"><a class="viewcode-back" href="../../trans.html#jjmodel.transform.XVTrans.calc_6d_err">[docs]</a>    <span class="k">def</span> <span class="nf">calc_6d_err</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">names</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculation of the coordinate and velocity errors. </span>
<span class="sd">        Should be called only after calc_6d_gal.</span>
<span class="sd">        </span>
<span class="sd">        :param names: Names of columns for the following quantities: </span>
<span class="sd">            </span>
<span class="sd">            - ``&#39;ra&#39;``: right ascention, deg </span>
<span class="sd">            - ``&#39;dec&#39;``: declination, deg</span>
<span class="sd">            - ``&#39;dpc&#39;`` or ``&#39;dkpc&#39;``: heliocentric distance, pc or kpc </span>
<span class="sd">            - ``&#39;parallax&#39;``: parallax, can be given instead of the distance column, mas</span>
<span class="sd">            - ``&#39;pmra&#39;``: proper motion in right ascention, :math:`\mathrm{mas \ yr^{-1}}`</span>
<span class="sd">            - ``&#39;pmdec&#39;``: proper motion in right declination, :math:`\mathrm{mas \ yr^{-1}}`</span>
<span class="sd">            - ``&#39;vr&#39;``: radial velocity, :math:`\mathrm{km \ s^{-1}}`</span>
<span class="sd">            - ``&#39;era&#39;``: error in right ascention, deg </span>
<span class="sd">            - ``&#39;edec&#39;``: error in declination, deg</span>
<span class="sd">            - ``&#39;edpc&#39;`` or ``&#39;edkpc&#39;``: error in heliocentric distance, pc or kpc </span>
<span class="sd">            - ``&#39;eparallax&#39;``: parallax error, can be given instead of the distance error column, mas</span>
<span class="sd">            - ``&#39;epmra&#39;``: error in proper motion in right ascention, :math:`\mathrm{mas \ yr^{-1}}`</span>
<span class="sd">            - ``&#39;epmdec&#39;``: error in proper motion in right declination, :math:`\mathrm{mas \ yr^{-1}}`</span>
<span class="sd">            - ``&#39;evr&#39;``: error in radial velocity, :math:`\mathrm{km \ s^{-1}}`.</span>
<span class="sd">            </span>
<span class="sd">        :type names: dict</span>
<span class="sd">        </span>
<span class="sd">        :param cov_matrix: Optional, correlation coefficients for the error calculation. </span>
<span class="sd">            There can be maximum 10 coefficients: ``&#39;c12&#39;``, ``&#39;c13&#39;``, ``&#39;c14&#39;``, ``&#39;c15&#39;``, ``&#39;c23&#39;``, ``&#39;c24&#39;``, ``&#39;c25&#39;``, </span>
<span class="sd">            ``&#39;c34&#39;``, ``&#39;c35&#39;``, ``&#39;c45&#39;``. Indices correspond to the correlated quantities in the following way: </span>
<span class="sd">            (*ra,dec,pmra,pmdec,parallax*) = (1,2,3,4,5). Don&#39;t mess it up. Have fun:)</span>
<span class="sd">            Here we assume that there is no correlation between 5 astrometric parameters and </span>
<span class="sd">            radial velocity as they are obtained via measurements by the different instruments. </span>
<span class="sd">            Remember that terms (``&#39;c15&#39;``, ``&#39;c25&#39;``, ``&#39;c35&#39;``, ``&#39;c45&#39;``) should not be taken into account  </span>
<span class="sd">            if distances are not simple inverted parallaxes. </span>
<span class="sd">        :type cov_matrix: dict</span>
<span class="sd">        </span>
<span class="sd">        :return: None. </span>
<span class="sd">        </span>
<span class="sd">            Adds columns to the table:  </span>
<span class="sd">        </span>
<span class="sd">            - ``&#39;ed&#39;``: Distance error (if parallax and parallax error are given)</span>
<span class="sd">            - (``&#39;ex&#39;``, ``&#39;ey&#39;``, ``&#39;ez&#39;``): Errors of 3d Cartesian coordinates </span>
<span class="sd">            - (``&#39;erg&#39;``, ``&#39;ephi&#39;``): Errors of Galactocentric cylindrical coordinates </span>
<span class="sd">            - (``&#39;eU&#39;``, ``&#39;eV&#39;``, ``&#39;eW&#39;``): Errors of the 3d Cartesian velocity components</span>
<span class="sd">            - (``&#39;eUc&#39;``, ``&#39;eVc&#39;``, ``&#39;eWc&#39;``): Random errors of the 3d Cartesian velocity components (calculated only when covarience matrix is given to check the impact of correlations). </span>
<span class="sd">            - (``&#39;eVr&#39;``, ``&#39;eVphi&#39;``): Errors of Galactocentric velocities in cylindrical coordinates</span>
<span class="sd">              </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculation of the Galactic coordinate and velocity errors:&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;edpc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;edkpc&#39;</span> <span class="ow">or</span> <span class="s1">&#39;eparallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;edpc&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;edpc&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;edkpc&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;edkpc&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mi">1000</span>
            <span class="k">if</span> <span class="s1">&#39;eparallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edist</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;parallax&#39;</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;eparallax&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: give errors of helio_distance[pc or kpc] or parallax[mas]!&#39;</span><span class="p">)</span>
 
        <span class="c1"># Galactic frame, manual definition</span>
        <span class="n">ra_ngp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">192.25</span><span class="p">)</span>
        <span class="n">dec_ngp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">27.4</span><span class="p">)</span>
        <span class="n">teta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
        <span class="c1"># conversion factor for proper motions</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mf">4.74</span> 
        
        <span class="c1"># Transformation matrix T </span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">teta0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">teta0</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">teta0</span><span class="p">),</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">teta0</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec_ngp</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec_ngp</span><span class="p">)],[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec_ngp</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec_ngp</span><span class="p">)]])</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra_ngp</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra_ngp</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra_ngp</span><span class="p">),</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra_ngp</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">t1</span><span class="o">*</span><span class="n">t2</span><span class="o">*</span><span class="n">t3</span>

        <span class="c1"># functions and columns for simplification of calculation, index i corresponds to velocity component </span>
        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]])</span>
        <span class="n">pmra</span><span class="p">,</span> <span class="n">pmdec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;pmra&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;pmdec&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mf">1e-3</span>
        <span class="k">if</span> <span class="s1">&#39;era&#39;</span> <span class="ow">and</span> <span class="s1">&#39;edec&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">era</span><span class="p">,</span><span class="n">edec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;era&#39;</span><span class="p">]]),</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;edec&#39;</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">era</span><span class="p">,</span><span class="n">edec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]]))),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]])))</span>
        <span class="n">epmra</span><span class="p">,</span> <span class="n">epmdec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;epmra&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;epmdec&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mf">1e-3</span>
        
        <span class="n">a</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">+</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">+</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">+</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">+</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>
        <span class="n">da_dra</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">+</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>
        <span class="n">db_dra</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">))</span>
        <span class="n">dc_dra</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>
        <span class="n">da_ddec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">+</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>
        <span class="n">dc_ddec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>
                    
        <span class="k">def</span> <span class="nf">sigma_uvw_norm</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="c1"># Velocity error (random component)</span>
            
            <span class="n">s01</span> <span class="o">=</span> <span class="p">(</span><span class="n">da_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">db_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">+</span><span class="n">dc_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span><span class="n">era</span>
            <span class="n">s02</span> <span class="o">=</span> <span class="p">(</span><span class="n">da_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">dc_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span><span class="n">edec</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;evr&#39;</span><span class="p">]]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">epmra</span>
            <span class="n">s3</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">epmdec</span>
            <span class="n">s4</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmra</span> <span class="o">+</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="n">s01</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s02</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s3</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s4</span><span class="o">**</span><span class="mi">2</span>

            <span class="k">return</span> <span class="n">ss</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Velocity errors...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="c1"># random velocity errors squared</span>
        <span class="n">eU_norm2</span><span class="p">,</span> <span class="n">eV_norm2</span><span class="p">,</span> <span class="n">eW_norm2</span> <span class="o">=</span> <span class="n">sigma_uvw_norm</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">sigma_uvw_norm</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sigma_uvw_norm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;cov_matrix&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># total velocity errors if correlations are neglected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eU_norm2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eUsun</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>\
                                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eV_norm2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eVsun</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>\
                                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eW_norm2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eWsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">done.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cov_matrix&#39;</span><span class="p">]</span>
            <span class="k">def</span> <span class="nf">sigma_uvw_cov</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="c1"># Velocity error (component from correlations)</span>
                
                <span class="n">t1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c12&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">era</span><span class="o">*</span><span class="n">edec</span><span class="o">*</span>\
                    <span class="p">(</span><span class="n">da_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">db_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">+</span><span class="n">dc_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span>\
                    <span class="p">(</span><span class="n">da_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">dc_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
                <span class="n">t2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c13&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">era</span><span class="o">*</span><span class="n">epmra</span><span class="o">*</span>\
                    <span class="p">(</span><span class="n">da_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">db_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">+</span><span class="n">dc_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span>\
                    <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span>
                <span class="n">t3</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c14&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">era</span><span class="o">*</span><span class="n">epmdec</span><span class="o">*</span>\
                    <span class="p">(</span><span class="n">da_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">db_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">+</span><span class="n">dc_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span>\
                    <span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span>                
                <span class="n">t5</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c23&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">edec</span><span class="o">*</span><span class="n">epmra</span><span class="o">*</span>\
                    <span class="p">(</span><span class="n">da_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">dc_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span>
                <span class="n">t6</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c24&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">edec</span><span class="o">*</span><span class="n">epmdec</span><span class="o">*</span>\
                    <span class="p">(</span><span class="n">da_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">dc_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span>
                <span class="n">t8</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c34&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">epmra</span><span class="o">*</span><span class="n">epmdec</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">+</span> <span class="n">t3</span> <span class="o">+</span> <span class="n">t5</span> <span class="o">+</span> <span class="n">t6</span> <span class="o">+</span> <span class="n">t8</span>
                <span class="c1"># terms t4, t7, t9, t10 should not be added to the final sum </span>
                <span class="c1"># if distances are not simple inverted parallaxes. </span>
                
                <span class="k">if</span> <span class="s1">&#39;c25&#39;</span> <span class="ow">and</span> <span class="s1">&#39;c25&#39;</span> <span class="ow">and</span> <span class="s1">&#39;c35&#39;</span><span class="ow">and</span> <span class="s1">&#39;c45&#39;</span> <span class="ow">in</span> <span class="n">cov_matrix</span> <span class="ow">and</span> <span class="s1">&#39;eparallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>     
                    <span class="n">epar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;eparallax&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mf">1e-3</span> <span class="c1"># in arcsec</span>
                    <span class="n">t4</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c15&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">era</span><span class="o">*</span><span class="n">epar</span><span class="o">*</span>\
                        <span class="p">(</span><span class="n">da_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">db_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmra</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">+</span><span class="n">dc_dra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span>\
                        <span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">pmra</span><span class="o">-</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">pmdec</span><span class="p">)</span>
                    <span class="n">t7</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c25&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">edec</span><span class="o">*</span><span class="n">epar</span><span class="o">*</span>\
                        <span class="p">(</span><span class="n">da_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">dc_ddec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">pmdec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span><span class="o">*</span>\
                        <span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">pmra</span><span class="o">-</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">pmdec</span><span class="p">)</span>
                    <span class="n">t9</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c35&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">epmra</span><span class="o">*</span><span class="n">epar</span><span class="o">*</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">pmra</span><span class="o">-</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">pmdec</span><span class="p">)</span>
                    <span class="n">t10</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">cov_matrix</span><span class="p">[</span><span class="s1">&#39;c45&#39;</span><span class="p">]]</span><span class="o">*</span><span class="n">epmdec</span><span class="o">*</span><span class="n">epar</span><span class="o">*</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">pmra</span><span class="o">-</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">pmdec</span><span class="p">)</span>
                    <span class="n">ss</span> <span class="o">=</span> <span class="n">ss</span> <span class="o">+</span> <span class="n">t4</span> <span class="o">+</span> <span class="n">t7</span> <span class="o">+</span> <span class="n">t9</span> <span class="o">+</span> <span class="n">t10</span>                        
                <span class="k">return</span> <span class="n">ss</span>
            
            <span class="c1"># squared velocity error components associated with quantities&#39; correlations </span>
            <span class="n">eU_cov2</span><span class="p">,</span> <span class="n">eV_cov2</span><span class="p">,</span> <span class="n">eW_cov2</span> <span class="o">=</span> <span class="n">sigma_uvw_cov</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">sigma_uvw_cov</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sigma_uvw_cov</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># total velocity errors (with correlations)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eU_norm2</span> <span class="o">+</span> <span class="n">eU_cov2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eUsun</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>\
                                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eV_norm2</span> <span class="o">+</span> <span class="n">eV_cov2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eVsun</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>\
                                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eW_norm2</span> <span class="o">+</span> <span class="n">eW_cov2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eWsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># In some cases, e(U,V,W)_cov2 &lt; 0 (not sure why; wrong correlation coefficients?)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">done.</span><span class="se">\n\t</span><span class="s1">Percentage of (U,V,W), where uncertainties with correlations cannot be estimated:&#39;</span><span class="p">,</span>
                  <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                  <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                  <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eW</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eW</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eW</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            
            <span class="c1"># If this happens, the correlation part in the velocity errors is ignored </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eU_norm2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eUsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eV_norm2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eVsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eW</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eW</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eW_norm2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eW</span><span class="o">*</span><span class="mi">0</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eWsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Distance errors...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>    
        <span class="n">l1</span><span class="p">,</span><span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">eZsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="mf">1e3</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l1</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eRsun</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
                    <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rsun</span><span class="o">*</span><span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l1</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-3</span> <span class="c1"># in kpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">*</span>\
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edist</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eR</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span><span class="o">//</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eVr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
                    <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Vtsun</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
                    <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eVtsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eVphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Vtsun</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eVtsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>       
        
        <span class="c1"># output to the table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ey&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eY</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eZ</span>
        <span class="k">if</span> <span class="s1">&#39;eparallax&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edist</span>
        <span class="k">if</span> <span class="s1">&#39;cov_matrix&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eU&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eV&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eW</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># errors without correlations </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eU_norm2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eUsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eV_norm2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eVsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eW_norm2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eWsun</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># errors with correlations taken into account (but sometimes e(U,V,W)c==e(U,V,W))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eUc&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eVc&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eWc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eU</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eV</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eW</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;erg&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ephi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eR</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ePhi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eVr&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;eVphi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eVr</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eVphi</span></div>
        

<div class="viewcode-block" id="XVTrans.save_result"><a class="viewcode-back" href="../../trans.html#jjmodel.transform.XVTrans.save_result">[docs]</a>    <span class="k">def</span> <span class="nf">save_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the data table with the new columns. </span>
<span class="sd">        Save directory is constructed as ``filename+&#39;_trans.&#39;+fileformat``. </span>
<span class="sd">        </span>
<span class="sd">        :return: None. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing output...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;_trans.&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileformat</span><span class="p">)),</span><span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileformat</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span> </div></div>


</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">jjmodel</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../funcs.html">Physical functions (input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model_core.html">Radial and vertical MW structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../populations.html">Stellar populations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geometry.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trans.html">Coordinates and velocities (from data)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools.html">Useful tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iof.html">Input/output tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analysis.html">Output analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plotting.html">Plotting tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contacts.html">Authors and contact</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Sysoliatina.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>